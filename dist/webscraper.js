/*! For license information please see webscraper.js.LICENSE.txt */
(()=>{"use strict";var t={};t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}();const e=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let i=t.charCodeAt(r);i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=63&i|128):55296==(64512&i)&&r+1<t.length&&56320==(64512&t.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&t.charCodeAt(++r)),e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=63&i|128):(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=63&i|128)}return e},n={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let e=0;e<t.length;e+=3){const i=t[e],s=e+1<t.length,o=s?t[e+1]:0,a=e+2<t.length,c=a?t[e+2]:0,u=i>>2,h=(3&i)<<4|o>>4;let l=(15&o)<<2|c>>6,d=63&c;a||(d=64,s||(l=64)),r.push(n[u],n[h],n[l],n[d])}return r.join("")},encodeString(t,n){return this.HAS_NATIVE_SUPPORT&&!n?btoa(t):this.encodeByteArray(e(t),n)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){const e=[];let n=0,r=0;for(;n<t.length;){const i=t[n++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=t[n++];e[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){const s=((7&i)<<18|(63&t[n++])<<12|(63&t[n++])<<6|63&t[n++])-65536;e[r++]=String.fromCharCode(55296+(s>>10)),e[r++]=String.fromCharCode(56320+(1023&s))}else{const s=t[n++],o=t[n++];e[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&o)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let e=0;e<t.length;){const s=n[t.charAt(e++)],o=e<t.length?n[t.charAt(e)]:0;++e;const a=e<t.length?n[t.charAt(e)]:64;++e;const c=e<t.length?n[t.charAt(e)]:64;if(++e,null==s||null==o||null==a||null==c)throw new r;const u=s<<2|o>>4;if(i.push(u),64!==a){const t=o<<4&240|a>>2;if(i.push(t),64!==c){const t=a<<6&192|c;i.push(t)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class r extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const i=function(t){return function(t){const r=e(t);return n.encodeByteArray(r,!0)}(t).replace(/\./g,"")};const s=()=>{try{return function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==t.g)return t.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if("undefined"==typeof process||void 0===process.env)return;const t=process.env.__FIREBASE_DEFAULTS__;return t?JSON.parse(t):void 0})()||(()=>{if("undefined"==typeof document)return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(t){return}const e=t&&function(t){try{return n.decodeString(t,!0)}catch(t){console.error("base64Decode failed: ",t)}return null}(t[1]);return e&&JSON.parse(e)})()}catch(t){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`)}},o=()=>{var t;return null===(t=s())||void 0===t?void 0:t.config};class a{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}wrapCallback(t){return(e,n)=>{e?this.reject(e):this.resolve(n),"function"==typeof t&&(this.promise.catch((()=>{})),1===t.length?t(e):t(e,n))}}}function c(t){return t.endsWith(".cloudworkstations.dev")}const u={};let h=!1;function l(t,e){if("undefined"==typeof window||"undefined"==typeof document||!c(window.location.host)||u[t]===e||u[t]||h)return;function n(t){return`__firebase__banner__${t}`}u[t]=e;const r="__firebase__banner",i=function(){const t={prod:[],emulator:[]};for(const e of Object.keys(u))u[e]?t.emulator.push(e):t.prod.push(e);return t}().prod.length>0;function s(){const t=function(t){let e=document.getElementById(t),n=!1;return e||(e=document.createElement("div"),e.setAttribute("id",t),n=!0),{created:n,element:e}}(r),e=n("text"),s=document.getElementById(e)||document.createElement("span"),o=n("learnmore"),a=document.getElementById(o)||document.createElement("a"),c=n("preprendIcon"),u=document.getElementById(c)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(t.created){const e=t.element;!function(t){t.style.display="flex",t.style.background="#7faaf0",t.style.position="fixed",t.style.bottom="5px",t.style.left="5px",t.style.padding=".5em",t.style.borderRadius="5px",t.style.alignItems="center"}(e),function(t,e){t.setAttribute("id",e),t.innerText="Learn more",t.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",t.setAttribute("target","__blank"),t.style.paddingLeft="5px",t.style.textDecoration="underline"}(a,o);const n=function(){const t=document.createElement("span");return t.style.cursor="pointer",t.style.marginLeft="16px",t.style.fontSize="24px",t.innerHTML=" &times;",t.onclick=()=>{h=!0,function(){const t=document.getElementById(r);t&&t.remove()}()},t}();!function(t,e){t.setAttribute("width","24"),t.setAttribute("id",e),t.setAttribute("height","24"),t.setAttribute("viewBox","0 0 24 24"),t.setAttribute("fill","none"),t.style.marginLeft="-6px"}(u,c),e.append(u,s,a,n),document.body.appendChild(e)}i?(s.innerText="Preview backend disconnected.",u.innerHTML='<g clip-path="url(#clip0_6013_33858)">\n<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6013_33858">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>'):(u.innerHTML='<g clip-path="url(#clip0_6083_34804)">\n<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6083_34804">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>',s.innerText="Preview backend running in this workspace."),s.setAttribute("id",e)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",s):s()}function d(){return!function(){var e;const n=null===(e=s())||void 0===e?void 0:e.forceEnvironment;if("node"===n)return!0;if("browser"===n)return!1;try{return"[object process]"===Object.prototype.toString.call(t.g.process)}catch(t){return!1}}()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}class f extends Error{constructor(t,e,n){super(e),this.code=t,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,f.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,g.prototype.create)}}class g{constructor(t,e,n){this.service=t,this.serviceName=e,this.errors=n}create(t,...e){const n=e[0]||{},r=`${this.service}/${t}`,i=this.errors[t],s=i?function(t,e){return t.replace(p,((t,n)=>{const r=e[n];return null!=r?String(r):`<${n}?>`}))}(i,n):"Error",o=`${this.serviceName}: ${s} (${r}).`;return new f(r,o,n)}}const p=/\{\$([^}]+)}/g;function m(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const i of n){if(!r.includes(i))return!1;const n=t[i],s=e[i];if(y(n)&&y(s)){if(!m(n,s))return!1}else if(n!==s)return!1}for(const t of r)if(!n.includes(t))return!1;return!0}function y(t){return null!==t&&"object"==typeof t}function v(t){return t&&t._delegate?t._delegate:t}class w{constructor(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}const E="[DEFAULT]";class b{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const t=new a;if(this.instancesDeferred.set(e,t),this.isInitialized(e)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:e});n&&t.resolve(n)}catch(t){}}return this.instancesDeferred.get(e).promise}getImmediate(t){var e;const n=this.normalizeInstanceIdentifier(null==t?void 0:t.identifier),r=null!==(e=null==t?void 0:t.optional)&&void 0!==e&&e;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(t){if(r)return null;throw t}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,this.shouldAutoInitialize()){if(function(t){return"EAGER"===t.instantiationMode}(t))try{this.getOrInitializeService({instanceIdentifier:E})}catch(t){}for(const[t,e]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(t);try{const t=this.getOrInitializeService({instanceIdentifier:n});e.resolve(t)}catch(t){}}}}clearInstance(t=E){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter((t=>"INTERNAL"in t)).map((t=>t.INTERNAL.delete())),...t.filter((t=>"_delete"in t)).map((t=>t._delete()))])}isComponentSet(){return null!=this.component}isInitialized(t=E){return this.instances.has(t)}getOptions(t=E){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,n=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:e});for(const[t,e]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(t)&&e.resolve(r);return r}onInit(t,e){var n;const r=this.normalizeInstanceIdentifier(e),i=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;i.add(t),this.onInitCallbacks.set(r,i);const s=this.instances.get(r);return s&&t(s,r),()=>{i.delete(t)}}invokeOnInitCallbacks(t,e){const n=this.onInitCallbacks.get(e);if(n)for(const r of n)try{r(t,e)}catch(t){}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let n=this.instances.get(t);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=t,r===E?void 0:r),options:e}),this.instances.set(t,n),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(n,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,n)}catch(t){}var r;return n||null}normalizeInstanceIdentifier(t=E){return this.component?this.component.multipleInstances?t:E:t}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class _{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new b(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}const T=[];var C;!function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"}(C||(C={}));const I={debug:C.DEBUG,verbose:C.VERBOSE,info:C.INFO,warn:C.WARN,error:C.ERROR,silent:C.SILENT},S=C.INFO,A={[C.DEBUG]:"log",[C.VERBOSE]:"log",[C.INFO]:"info",[C.WARN]:"warn",[C.ERROR]:"error"},D=(t,e,...n)=>{if(e<t.logLevel)return;const r=(new Date).toISOString(),i=A[e];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`);console[i](`[${r}]  ${t.name}:`,...n)};class N{constructor(t){this.name=t,this._logLevel=S,this._logHandler=D,this._userLogHandler=null,T.push(this)}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in C))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel="string"==typeof t?I[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,C.DEBUG,...t),this._logHandler(this,C.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,C.VERBOSE,...t),this._logHandler(this,C.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,C.INFO,...t),this._logHandler(this,C.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,C.WARN,...t),this._logHandler(this,C.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,C.ERROR,...t),this._logHandler(this,C.ERROR,...t)}}let k,x;const R=new WeakMap,L=new WeakMap,O=new WeakMap,M=new WeakMap,P=new WeakMap;let V={get(t,e,n){if(t instanceof IDBTransaction){if("done"===e)return L.get(t);if("objectStoreNames"===e)return t.objectStoreNames||O.get(t);if("store"===e)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return U(t[e])},set:(t,e,n)=>(t[e]=n,!0),has:(t,e)=>t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t};function F(t){return"function"==typeof t?(e=t)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(x||(x=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(B(this),t),U(R.get(this))}:function(...t){return U(e.apply(B(this),t))}:function(t,...n){const r=e.call(B(this),t,...n);return O.set(r,t.sort?t.sort():[t]),U(r)}:(t instanceof IDBTransaction&&function(t){if(L.has(t))return;const e=new Promise(((e,n)=>{const r=()=>{t.removeEventListener("complete",i),t.removeEventListener("error",s),t.removeEventListener("abort",s)},i=()=>{e(),r()},s=()=>{n(t.error||new DOMException("AbortError","AbortError")),r()};t.addEventListener("complete",i),t.addEventListener("error",s),t.addEventListener("abort",s)}));L.set(t,e)}(t),n=t,(k||(k=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some((t=>n instanceof t))?new Proxy(t,V):t);var e,n}function U(t){if(t instanceof IDBRequest)return function(t){const e=new Promise(((e,n)=>{const r=()=>{t.removeEventListener("success",i),t.removeEventListener("error",s)},i=()=>{e(U(t.result)),r()},s=()=>{n(t.error),r()};t.addEventListener("success",i),t.addEventListener("error",s)}));return e.then((e=>{e instanceof IDBCursor&&R.set(e,t)})).catch((()=>{})),P.set(e,t),e}(t);if(M.has(t))return M.get(t);const e=F(t);return e!==t&&(M.set(t,e),P.set(e,t)),e}const B=t=>P.get(t),j=["get","getKey","getAll","getAllKeys","count"],q=["put","add","delete","clear"],$=new Map;function z(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!=typeof e)return;if($.get(e))return $.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,i=q.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!i&&!j.includes(n))return;const s=async function(t,...e){const s=this.transaction(t,i?"readwrite":"readonly");let o=s.store;return r&&(o=o.index(e.shift())),(await Promise.all([o[n](...e),i&&s.done]))[0]};return $.set(e,s),s}var G;G=V,V={...G,get:(t,e,n)=>z(t,e)||G.get(t,e,n),has:(t,e)=>!!z(t,e)||G.has(t,e)};class H{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map((t=>{if(function(t){const e=t.getComponent();return"VERSION"===(null==e?void 0:e.type)}(t)){const e=t.getImmediate();return`${e.library}/${e.version}`}return null})).filter((t=>t)).join(" ")}}const K="@firebase/app",Q="0.13.0",W=new N("@firebase/app"),X="@firebase/app-compat",Y="@firebase/analytics-compat",J="@firebase/analytics",Z="@firebase/app-check-compat",tt="@firebase/app-check",et="@firebase/auth",nt="@firebase/auth-compat",rt="@firebase/database",it="@firebase/data-connect",st="@firebase/database-compat",ot="@firebase/functions",at="@firebase/functions-compat",ct="@firebase/installations",ut="@firebase/installations-compat",ht="@firebase/messaging",lt="@firebase/messaging-compat",dt="@firebase/performance",ft="@firebase/performance-compat",gt="@firebase/remote-config",pt="@firebase/remote-config-compat",mt="@firebase/storage",yt="@firebase/storage-compat",vt="@firebase/firestore",wt="@firebase/ai",Et="@firebase/firestore-compat",bt="firebase",_t="[DEFAULT]",Tt={[K]:"fire-core",[X]:"fire-core-compat",[J]:"fire-analytics",[Y]:"fire-analytics-compat",[tt]:"fire-app-check",[Z]:"fire-app-check-compat",[et]:"fire-auth",[nt]:"fire-auth-compat",[rt]:"fire-rtdb",[it]:"fire-data-connect",[st]:"fire-rtdb-compat",[ot]:"fire-fn",[at]:"fire-fn-compat",[ct]:"fire-iid",[ut]:"fire-iid-compat",[ht]:"fire-fcm",[lt]:"fire-fcm-compat",[dt]:"fire-perf",[ft]:"fire-perf-compat",[gt]:"fire-rc",[pt]:"fire-rc-compat",[mt]:"fire-gcs",[yt]:"fire-gcs-compat",[vt]:"fire-fst",[Et]:"fire-fst-compat",[wt]:"fire-vertex","fire-js":"fire-js",[bt]:"fire-js-all"},Ct=new Map,It=new Map,St=new Map;function At(t,e){try{t.container.addComponent(e)}catch(n){W.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function Dt(t){const e=t.name;if(St.has(e))return W.debug(`There were multiple attempts to register component ${e}.`),!1;St.set(e,t);for(const e of Ct.values())At(e,t);for(const e of It.values())At(e,t);return!0}const Nt=new g("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class kt{constructor(t,e,n){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},e),this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new w("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw Nt.create("app-deleted",{appName:this._name})}}function xt(t,e={}){let n=t;"object"!=typeof e&&(e={name:e});const r=Object.assign({name:_t,automaticDataCollectionEnabled:!0},e),i=r.name;if("string"!=typeof i||!i)throw Nt.create("bad-app-name",{appName:String(i)});if(n||(n=o()),!n)throw Nt.create("no-options");const s=Ct.get(i);if(s){if(m(n,s.options)&&m(r,s.config))return s;throw Nt.create("duplicate-app",{appName:i})}const a=new _(i);for(const t of St.values())a.addComponent(t);const c=new kt(n,r,a);return Ct.set(i,c),c}function Rt(t,e,n){var r;let i=null!==(r=Tt[t])&&void 0!==r?r:t;n&&(i+=`-${n}`);const s=i.match(/\s|\//),o=e.match(/\s|\//);if(s||o){const t=[`Unable to register library "${i}" with version "${e}":`];return s&&t.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&o&&t.push("and"),o&&t.push(`version name "${e}" contains illegal characters (whitespace or "/")`),void W.warn(t.join(" "))}Dt(new w(`${i}-version`,(()=>({library:i,version:e})),"VERSION"))}const Lt="firebase-heartbeat-store";let Ot=null;function Mt(){return Ot||(Ot=function(t,e,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){const o=indexedDB.open(t,e),a=U(o);return r&&o.addEventListener("upgradeneeded",(t=>{r(U(o.result),t.oldVersion,t.newVersion,U(o.transaction),t)})),n&&o.addEventListener("blocked",(t=>n(t.oldVersion,t.newVersion,t))),a.then((t=>{s&&t.addEventListener("close",(()=>s())),i&&t.addEventListener("versionchange",(t=>i(t.oldVersion,t.newVersion,t)))})).catch((()=>{})),a}("firebase-heartbeat-database",1,{upgrade:(t,e)=>{if(0===e)try{t.createObjectStore(Lt)}catch(t){console.warn(t)}}}).catch((t=>{throw Nt.create("idb-open",{originalErrorMessage:t.message})}))),Ot}async function Pt(t,e){try{const n=(await Mt()).transaction(Lt,"readwrite"),r=n.objectStore(Lt);await r.put(e,Vt(t)),await n.done}catch(t){if(t instanceof f)W.warn(t.message);else{const e=Nt.create("idb-set",{originalErrorMessage:null==t?void 0:t.message});W.warn(e.message)}}}function Vt(t){return`${t.name}!${t.options.appId}`}class Ft{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new Bt(e),this._heartbeatsCachePromise=this._storage.read().then((t=>(this._heartbeatsCache=t,t)))}async triggerHeartbeat(){var t,e;try{const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=Ut();if(null==(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)&&(this._heartbeatsCache=await this._heartbeatsCachePromise,null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)))return;if(this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some((t=>t.date===r)))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats.length>30){const t=function(t){if(0===t.length)return-1;let e=0,n=t[0].date;for(let r=1;r<t.length;r++)t[r].date<n&&(n=t[r].date,e=r);return e}(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(t,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(t){W.warn(t)}}async getHeartbeatsHeader(){var t;try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const e=Ut(),{heartbeatsToSend:n,unsentEntries:r}=function(t,e=1024){const n=[];let r=t.slice();for(const i of t){const t=n.find((t=>t.agent===i.agent));if(t){if(t.dates.push(i.date),jt(n)>e){t.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),jt(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),s=i(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(t){return W.warn(t),""}}}function Ut(){return(new Date).toISOString().substring(0,10)}class Bt{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!function(){try{return"object"==typeof indexedDB}catch(t){return!1}}()&&new Promise(((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var t;e((null===(t=i.error)||void 0===t?void 0:t.message)||"")}}catch(t){e(t)}})).then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const t=await async function(t){try{const e=(await Mt()).transaction(Lt),n=await e.objectStore(Lt).get(Vt(t));return await e.done,n}catch(t){if(t instanceof f)W.warn(t.message);else{const e=Nt.create("idb-get",{originalErrorMessage:null==t?void 0:t.message});W.warn(e.message)}}}(this.app);return(null==t?void 0:t.heartbeats)?t:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return Pt(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:t.heartbeats})}}async add(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return Pt(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...t.heartbeats]})}}}function jt(t){return i(JSON.stringify({version:2,heartbeats:t})).length}Dt(new w("platform-logger",(t=>new H(t)),"PRIVATE")),Dt(new w("heartbeat",(t=>new Ft(t)),"PRIVATE")),Rt(K,Q,""),Rt(K,Q,"esm2017"),Rt("fire-js",""),Rt("firebase","11.8.0","app");var qt,$t,zt="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},Gt={};(function(){var t;function e(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}function n(t,e,n){n||(n=0);var r=Array(16);if("string"==typeof e)for(var i=0;16>i;++i)r[i]=e.charCodeAt(n++)|e.charCodeAt(n++)<<8|e.charCodeAt(n++)<<16|e.charCodeAt(n++)<<24;else for(i=0;16>i;++i)r[i]=e[n++]|e[n++]<<8|e[n++]<<16|e[n++]<<24;e=t.g[0],n=t.g[1],i=t.g[2];var s=t.g[3],o=e+(s^n&(i^s))+r[0]+3614090360&4294967295;o=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=n+(o<<7&4294967295|o>>>25))+((o=s+(i^e&(n^i))+r[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(e^n))+r[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^i&(s^e))+r[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^n&(i^s))+r[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^e&(n^i))+r[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(e^n))+r[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^i&(s^e))+r[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^n&(i^s))+r[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^e&(n^i))+r[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(e^n))+r[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^i&(s^e))+r[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^n&(i^s))+r[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^e&(n^i))+r[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(e^n))+r[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^i&(s^e))+r[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=e+(i^s&(n^i))+r[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(e^n))+r[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^n&(s^e))+r[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^e&(i^s))+r[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=e+(i^s&(n^i))+r[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(e^n))+r[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^n&(s^e))+r[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^e&(i^s))+r[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=e+(i^s&(n^i))+r[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(e^n))+r[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^n&(s^e))+r[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^e&(i^s))+r[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=e+(i^s&(n^i))+r[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(e^n))+r[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^n&(s^e))+r[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^e&(i^s))+r[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=e+(n^i^s)+r[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^n^i)+r[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^n)+r[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^e)+r[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^i^s)+r[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^n^i)+r[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^n)+r[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^e)+r[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^i^s)+r[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^n^i)+r[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^n)+r[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^e)+r[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^i^s)+r[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^n^i)+r[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^n)+r[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^e)+r[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=e+(i^(n|~s))+r[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(e|~i))+r[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=i+(e^(s|~n))+r[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~e))+r[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=e+(i^(n|~s))+r[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(e|~i))+r[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=i+(e^(s|~n))+r[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~e))+r[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=e+(i^(n|~s))+r[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(e|~i))+r[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=i+(e^(s|~n))+r[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~e))+r[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((s=(e=n+((o=e+(i^(n|~s))+r[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(e|~i))+r[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((i=s+((o=i+(e^(s|~n))+r[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~e))+r[9]+3951481745&4294967295,t.g[0]=t.g[0]+e&4294967295,t.g[1]=t.g[1]+(i+(o<<21&4294967295|o>>>11))&4294967295,t.g[2]=t.g[2]+i&4294967295,t.g[3]=t.g[3]+s&4294967295}function r(t,e){this.h=e;for(var n=[],r=!0,i=t.length-1;0<=i;i--){var s=0|t[i];r&&s==e||(n[i]=s,r=!1)}this.g=n}!function(t,e){function n(){}n.prototype=e.prototype,t.D=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.C=function(t,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return e.prototype[n].apply(t,i)}}(e,(function(){this.blockSize=-1})),e.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},e.prototype.u=function(t,e){void 0===e&&(e=t.length);for(var r=e-this.blockSize,i=this.B,s=this.h,o=0;o<e;){if(0==s)for(;o<=r;)n(this,t,o),o+=this.blockSize;if("string"==typeof t){for(;o<e;)if(i[s++]=t.charCodeAt(o++),s==this.blockSize){n(this,i),s=0;break}}else for(;o<e;)if(i[s++]=t[o++],s==this.blockSize){n(this,i),s=0;break}}this.h=s,this.o+=e},e.prototype.v=function(){var t=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);t[0]=128;for(var e=1;e<t.length-8;++e)t[e]=0;var n=8*this.o;for(e=t.length-8;e<t.length;++e)t[e]=255&n,n/=256;for(this.u(t),t=Array(16),e=n=0;4>e;++e)for(var r=0;32>r;r+=8)t[n++]=this.g[e]>>>r&255;return t};var i={};function s(t){return-128<=t&&128>t?function(t){var e=i;return Object.prototype.hasOwnProperty.call(e,t)?e[t]:e[t]=function(t){return new r([0|t],0>t?-1:0)}(t)}(t):new r([0|t],0>t?-1:0)}function o(t){if(isNaN(t)||!isFinite(t))return a;if(0>t)return d(o(-t));for(var e=[],n=1,i=0;t>=n;i++)e[i]=t/n|0,n*=4294967296;return new r(e,0)}var a=s(0),c=s(1),u=s(16777216);function h(t){if(0!=t.h)return!1;for(var e=0;e<t.g.length;e++)if(0!=t.g[e])return!1;return!0}function l(t){return-1==t.h}function d(t){for(var e=t.g.length,n=[],i=0;i<e;i++)n[i]=~t.g[i];return new r(n,~t.h).add(c)}function f(t,e){return t.add(d(e))}function g(t,e){for(;(65535&t[e])!=t[e];)t[e+1]+=t[e]>>>16,t[e]&=65535,e++}function p(t,e){this.g=t,this.h=e}function m(t,e){if(h(e))throw Error("division by zero");if(h(t))return new p(a,a);if(l(t))return e=m(d(t),e),new p(d(e.g),d(e.h));if(l(e))return e=m(t,d(e)),new p(d(e.g),e.h);if(30<t.g.length){if(l(t)||l(e))throw Error("slowDivide_ only works with positive integers.");for(var n=c,r=e;0>=r.l(t);)n=y(n),r=y(r);var i=v(n,1),s=v(r,1);for(r=v(r,2),n=v(n,2);!h(r);){var u=s.add(r);0>=u.l(t)&&(i=i.add(n),s=u),r=v(r,1),n=v(n,1)}return e=f(t,i.j(e)),new p(i,e)}for(i=a;0<=t.l(e);){for(n=Math.max(1,Math.floor(t.m()/e.m())),r=48>=(r=Math.ceil(Math.log(n)/Math.LN2))?1:Math.pow(2,r-48),u=(s=o(n)).j(e);l(u)||0<u.l(t);)u=(s=o(n-=r)).j(e);h(s)&&(s=c),i=i.add(s),t=f(t,u)}return new p(i,t)}function y(t){for(var e=t.g.length+1,n=[],i=0;i<e;i++)n[i]=t.i(i)<<1|t.i(i-1)>>>31;return new r(n,t.h)}function v(t,e){var n=e>>5;e%=32;for(var i=t.g.length-n,s=[],o=0;o<i;o++)s[o]=0<e?t.i(o+n)>>>e|t.i(o+n+1)<<32-e:t.i(o+n);return new r(s,t.h)}(t=r.prototype).m=function(){if(l(this))return-d(this).m();for(var t=0,e=1,n=0;n<this.g.length;n++){var r=this.i(n);t+=(0<=r?r:4294967296+r)*e,e*=4294967296}return t},t.toString=function(t){if(2>(t=t||10)||36<t)throw Error("radix out of range: "+t);if(h(this))return"0";if(l(this))return"-"+d(this).toString(t);for(var e=o(Math.pow(t,6)),n=this,r="";;){var i=m(n,e).g,s=((0<(n=f(n,i.j(e))).g.length?n.g[0]:n.h)>>>0).toString(t);if(h(n=i))return s+r;for(;6>s.length;)s="0"+s;r=s+r}},t.i=function(t){return 0>t?0:t<this.g.length?this.g[t]:this.h},t.l=function(t){return l(t=f(this,t))?-1:h(t)?0:1},t.abs=function(){return l(this)?d(this):this},t.add=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],i=0,s=0;s<=e;s++){var o=i+(65535&this.i(s))+(65535&t.i(s)),a=(o>>>16)+(this.i(s)>>>16)+(t.i(s)>>>16);i=a>>>16,o&=65535,a&=65535,n[s]=a<<16|o}return new r(n,-2147483648&n[n.length-1]?-1:0)},t.j=function(t){if(h(this)||h(t))return a;if(l(this))return l(t)?d(this).j(d(t)):d(d(this).j(t));if(l(t))return d(this.j(d(t)));if(0>this.l(u)&&0>t.l(u))return o(this.m()*t.m());for(var e=this.g.length+t.g.length,n=[],i=0;i<2*e;i++)n[i]=0;for(i=0;i<this.g.length;i++)for(var s=0;s<t.g.length;s++){var c=this.i(i)>>>16,f=65535&this.i(i),p=t.i(s)>>>16,m=65535&t.i(s);n[2*i+2*s]+=f*m,g(n,2*i+2*s),n[2*i+2*s+1]+=c*m,g(n,2*i+2*s+1),n[2*i+2*s+1]+=f*p,g(n,2*i+2*s+1),n[2*i+2*s+2]+=c*p,g(n,2*i+2*s+2)}for(i=0;i<e;i++)n[i]=n[2*i+1]<<16|n[2*i];for(i=e;i<2*e;i++)n[i]=0;return new r(n,0)},t.A=function(t){return m(this,t).h},t.and=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],i=0;i<e;i++)n[i]=this.i(i)&t.i(i);return new r(n,this.h&t.h)},t.or=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],i=0;i<e;i++)n[i]=this.i(i)|t.i(i);return new r(n,this.h|t.h)},t.xor=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],i=0;i<e;i++)n[i]=this.i(i)^t.i(i);return new r(n,this.h^t.h)},e.prototype.digest=e.prototype.v,e.prototype.reset=e.prototype.s,e.prototype.update=e.prototype.u,$t=Gt.Md5=e,r.prototype.add=r.prototype.add,r.prototype.multiply=r.prototype.j,r.prototype.modulo=r.prototype.A,r.prototype.compare=r.prototype.l,r.prototype.toNumber=r.prototype.m,r.prototype.toString=r.prototype.toString,r.prototype.getBits=r.prototype.i,r.fromNumber=o,r.fromString=function t(e,n){if(0==e.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==e.charAt(0))return d(t(e.substring(1),n));if(0<=e.indexOf("-"))throw Error('number format error: interior "-" character');for(var r=o(Math.pow(n,8)),i=a,s=0;s<e.length;s+=8){var c=Math.min(8,e.length-s),u=parseInt(e.substring(s,s+c),n);8>c?(c=o(Math.pow(n,c)),i=i.j(c).add(o(u))):i=(i=i.j(r)).add(o(u))}return i},qt=Gt.Integer=r}).apply(void 0!==zt?zt:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var Ht,Kt,Qt,Wt,Xt,Yt,Jt,Zt,te="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},ee={};(function(){var t,e="function"==typeof Object.defineProperties?Object.defineProperty:function(t,e,n){return t==Array.prototype||t==Object.prototype||(t[e]=n.value),t},n=function(t){t=["object"==typeof globalThis&&globalThis,t,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof te&&te];for(var e=0;e<t.length;++e){var n=t[e];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);!function(t,r){if(r)t:{var i=n;t=t.split(".");for(var s=0;s<t.length-1;s++){var o=t[s];if(!(o in i))break t;i=i[o]}(r=r(s=i[t=t[t.length-1]]))!=s&&null!=r&&e(i,t,{configurable:!0,writable:!0,value:r})}}("Array.prototype.values",(function(t){return t||function(){return function(t,e){t instanceof String&&(t+="");var n=0,r=!1,i={next:function(){if(!r&&n<t.length){var i=n++;return{value:e(0,t[i]),done:!1}}return r=!0,{done:!0,value:void 0}}};return i[Symbol.iterator]=function(){return i},i}(this,(function(t,e){return e}))}}));var r=r||{},i=this||self;function s(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function o(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}function a(t,e,n){return t.call.apply(t.bind,arguments)}function c(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function u(t,e,n){return(u=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?a:c).apply(null,arguments)}function h(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function l(t,e){function n(){}n.prototype=e.prototype,t.aa=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.Qb=function(t,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return e.prototype[n].apply(t,i)}}function d(t){const e=t.length;if(0<e){const n=Array(e);for(let r=0;r<e;r++)n[r]=t[r];return n}return[]}function f(t,e){for(let e=1;e<arguments.length;e++){const n=arguments[e];if(s(n)){const e=t.length||0,r=n.length||0;t.length=e+r;for(let i=0;i<r;i++)t[e+i]=n[i]}else t.push(n)}}function g(t){return/^[\s\xa0]*$/.test(t)}function p(){var t=i.navigator;return t&&(t=t.userAgent)?t:""}function m(t){return m[" "](t),t}m[" "]=function(){};var y=!(-1==p().indexOf("Gecko")||-1!=p().toLowerCase().indexOf("webkit")&&-1==p().indexOf("Edge")||-1!=p().indexOf("Trident")||-1!=p().indexOf("MSIE")||-1!=p().indexOf("Edge"));function v(t,e,n){for(const r in t)e.call(n,t[r],r,t)}function w(t){const e={};for(const n in t)e[n]=t[n];return e}const E="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function b(t,e){let n,r;for(let e=1;e<arguments.length;e++){for(n in r=arguments[e],r)t[n]=r[n];for(let e=0;e<E.length;e++)n=E[e],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function _(t){var e=1;t=t.split(":");const n=[];for(;0<e&&t.length;)n.push(t.shift()),e--;return t.length&&n.push(t.join(":")),n}function T(t){i.setTimeout((()=>{throw t}),0)}function C(){var t=N;let e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}var I=new class{constructor(t,e){this.i=t,this.j=e,this.h=0,this.g=null}get(){let t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t}}((()=>new S),(t=>t.reset()));class S{constructor(){this.next=this.g=this.h=null}set(t,e){this.h=t,this.g=e,this.next=null}reset(){this.next=this.g=this.h=null}}let A,D=!1,N=new class{constructor(){this.h=this.g=null}add(t,e){const n=I.get();n.set(t,e),this.h?this.h.next=n:this.g=n,this.h=n}},k=()=>{const t=i.Promise.resolve(void 0);A=()=>{t.then(x)}};var x=()=>{for(var t;t=C();){try{t.h.call(t.g)}catch(t){T(t)}var e=I;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}D=!1};function R(){this.s=this.s,this.C=this.C}function L(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}R.prototype.s=!1,R.prototype.ma=function(){this.s||(this.s=!0,this.N())},R.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},L.prototype.h=function(){this.defaultPrevented=!0};var O=function(){if(!i.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{const t=()=>{};i.addEventListener("test",t,e),i.removeEventListener("test",t,e)}catch(t){}return t}();function M(t,e){if(L.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(y){t:{try{m(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:P[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&M.aa.h.call(this)}}l(M,L);var P={2:"touch",3:"pen",4:"mouse"};M.prototype.h=function(){M.aa.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var V="closure_listenable_"+(1e6*Math.random()|0),F=0;function U(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ha=i,this.key=++F,this.da=this.fa=!1}function B(t){t.da=!0,t.listener=null,t.proxy=null,t.src=null,t.ha=null}function j(t){this.src=t,this.g={},this.h=0}function q(t,e){var n=e.type;if(n in t.g){var r,i=t.g[n],s=Array.prototype.indexOf.call(i,e,void 0);(r=0<=s)&&Array.prototype.splice.call(i,s,1),r&&(B(e),0==t.g[n].length&&(delete t.g[n],t.h--))}}function $(t,e,n,r){for(var i=0;i<t.length;++i){var s=t[i];if(!s.da&&s.listener==e&&s.capture==!!n&&s.ha==r)return i}return-1}j.prototype.add=function(t,e,n,r,i){var s=t.toString();(t=this.g[s])||(t=this.g[s]=[],this.h++);var o=$(t,e,r,i);return-1<o?(e=t[o],n||(e.fa=!1)):((e=new U(e,this.src,s,!!r,i)).fa=n,t.push(e)),e};var z="closure_lm_"+(1e6*Math.random()|0),G={};function H(t,e,n,r,i){if(r&&r.once)return Q(t,e,n,r,i);if(Array.isArray(e)){for(var s=0;s<e.length;s++)H(t,e[s],n,r,i);return null}return n=et(n),t&&t[V]?t.K(e,n,o(r)?!!r.capture:!!r,i):K(t,e,n,!1,r,i)}function K(t,e,n,r,i,s){if(!e)throw Error("Invalid event type");var a=o(i)?!!i.capture:!!i,c=Z(t);if(c||(t[z]=c=new j(t)),(n=c.add(e,n,r,a,s)).proxy)return n;if(r=function(){const t=J;return function e(n){return t.call(e.src,e.listener,n)}}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)O||(i=a),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Y(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function Q(t,e,n,r,i){if(Array.isArray(e)){for(var s=0;s<e.length;s++)Q(t,e[s],n,r,i);return null}return n=et(n),t&&t[V]?t.L(e,n,o(r)?!!r.capture:!!r,i):K(t,e,n,!0,r,i)}function W(t,e,n,r,i){if(Array.isArray(e))for(var s=0;s<e.length;s++)W(t,e[s],n,r,i);else r=o(r)?!!r.capture:!!r,n=et(n),t&&t[V]?(t=t.i,(e=String(e).toString())in t.g&&-1<(n=$(s=t.g[e],n,r,i))&&(B(s[n]),Array.prototype.splice.call(s,n,1),0==s.length&&(delete t.g[e],t.h--))):t&&(t=Z(t))&&(e=t.g[e.toString()],t=-1,e&&(t=$(e,n,r,i)),(n=-1<t?e[t]:null)&&X(n))}function X(t){if("number"!=typeof t&&t&&!t.da){var e=t.src;if(e&&e[V])q(e.i,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Y(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Z(e))?(q(n,t),0==n.h&&(n.src=null,e[z]=null)):B(t)}}}function Y(t){return t in G?G[t]:G[t]="on"+t}function J(t,e){if(t.da)t=!0;else{e=new M(e,this);var n=t.listener,r=t.ha||t.src;t.fa&&X(t),t=n.call(r,e)}return t}function Z(t){return(t=t[z])instanceof j?t:null}var tt="__closure_events_fn_"+(1e9*Math.random()>>>0);function et(t){return"function"==typeof t?t:(t[tt]||(t[tt]=function(e){return t.handleEvent(e)}),t[tt])}function nt(){R.call(this),this.i=new j(this),this.M=this,this.F=null}function rt(t,e){var n,r=t.F;if(r)for(n=[];r;r=r.F)n.push(r);if(t=t.M,r=e.type||e,"string"==typeof e)e=new L(e,t);else if(e instanceof L)e.target=e.target||t;else{var i=e;b(e=new L(r,t),i)}if(i=!0,n)for(var s=n.length-1;0<=s;s--){var o=e.g=n[s];i=it(o,r,!0,e)&&i}if(i=it(o=e.g=t,r,!0,e)&&i,i=it(o,r,!1,e)&&i,n)for(s=0;s<n.length;s++)i=it(o=e.g=n[s],r,!1,e)&&i}function it(t,e,n,r){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();for(var i=!0,s=0;s<e.length;++s){var o=e[s];if(o&&!o.da&&o.capture==n){var a=o.listener,c=o.ha||o.src;o.fa&&q(t.i,o),i=!1!==a.call(c,r)&&i}}return i&&!r.defaultPrevented}function st(t,e,n){if("function"==typeof t)n&&(t=u(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=u(t.handleEvent,t)}return 2147483647<Number(e)?-1:i.setTimeout(t,e||0)}function ot(t){t.g=st((()=>{t.g=null,t.i&&(t.i=!1,ot(t))}),t.l);const e=t.h;t.h=null,t.m.apply(null,e)}l(nt,R),nt.prototype[V]=!0,nt.prototype.removeEventListener=function(t,e,n,r){W(this,t,e,n,r)},nt.prototype.N=function(){if(nt.aa.N.call(this),this.i){var t,e=this.i;for(t in e.g){for(var n=e.g[t],r=0;r<n.length;r++)B(n[r]);delete e.g[t],e.h--}}this.F=null},nt.prototype.K=function(t,e,n,r){return this.i.add(String(t),e,!1,n,r)},nt.prototype.L=function(t,e,n,r){return this.i.add(String(t),e,!0,n,r)};class at extends R{constructor(t,e){super(),this.m=t,this.l=e,this.h=null,this.i=!1,this.g=null}j(t){this.h=arguments,this.g?this.i=!0:ot(this)}N(){super.N(),this.g&&(i.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ct(t){R.call(this),this.h=t,this.g={}}l(ct,R);var ut=[];function ht(t){v(t.g,(function(t,e){this.g.hasOwnProperty(e)&&X(t)}),t),t.g={}}ct.prototype.N=function(){ct.aa.N.call(this),ht(this)},ct.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var lt=i.JSON.stringify,dt=i.JSON.parse,ft=class{stringify(t){return i.JSON.stringify(t,void 0)}parse(t){return i.JSON.parse(t,void 0)}};function gt(){}function pt(t){return t.h||(t.h=t.i())}function mt(){}gt.prototype.h=null;var yt={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function vt(){L.call(this,"d")}function wt(){L.call(this,"c")}l(vt,L),l(wt,L);var Et={},bt=null;function _t(){return bt=bt||new nt}function Tt(t){L.call(this,Et.La,t)}function Ct(t){const e=_t();rt(e,new Tt(e))}function It(t,e){L.call(this,Et.STAT_EVENT,t),this.stat=e}function St(t){const e=_t();rt(e,new It(e,t))}function At(t,e){L.call(this,Et.Ma,t),this.size=e}function Dt(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return i.setTimeout((function(){t()}),e)}function Nt(){this.g=!0}function kt(t,e,n,r){t.info((function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<i.length;o++)i[o]=""}}}return lt(n)}catch(t){return e}}(t,n)+(r?" "+r:"")}))}Et.La="serverreachability",l(Tt,L),Et.STAT_EVENT="statevent",l(It,L),Et.Ma="timingevent",l(At,L),Nt.prototype.xa=function(){this.g=!1},Nt.prototype.info=function(){};var xt,Rt={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Lt={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function Ot(){}function Mt(t,e,n,r){this.j=t,this.i=e,this.l=n,this.R=r||1,this.U=new ct(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Pt}function Pt(){this.i=null,this.g="",this.h=!1}l(Ot,gt),Ot.prototype.g=function(){return new XMLHttpRequest},Ot.prototype.i=function(){return{}},xt=new Ot;var Vt={},Ft={};function Ut(t,e,n){t.L=1,t.v=be(me(e)),t.m=n,t.P=!0,Bt(t,null)}function Bt(t,e){t.F=Date.now(),$t(t),t.A=me(t.v);var n=t.A,r=t.R;Array.isArray(r)||(r=[String(r)]),Me(n.i,"t",r),t.C=0,n=t.j.J,t.h=new Pt,t.g=Tn(t.j,n?e:null,!t.m),0<t.O&&(t.M=new at(u(t.Y,t,t.g),t.O)),e=t.U,n=t.g,r=t.ca;var i="readystatechange";Array.isArray(i)||(i&&(ut[0]=i.toString()),i=ut);for(var s=0;s<i.length;s++){var o=H(n,i[s],r||e.handleEvent,!1,e.h||e);if(!o)break;e.g[o.key]=o}e=t.H?w(t.H):{},t.m?(t.u||(t.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ea(t.A,t.u,t.m,e)):(t.u="GET",t.g.ea(t.A,t.u,null,e)),Ct(),function(t,e,n,r,i,s){t.info((function(){if(t.g)if(s)for(var o="",a=s.split("&"),c=0;c<a.length;c++){var u=a[c].split("=");if(1<u.length){var h=u[0];u=u[1];var l=h.split("_");o=2<=l.length&&"type"==l[1]?o+(h+"=")+u+"&":o+(h+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+"\n"+n+"\n"+o}))}(t.i,t.u,t.A,t.l,t.R,t.m)}function jt(t){return!!t.g&&"GET"==t.u&&2!=t.L&&t.j.Ca}function qt(t,e){var n=t.C,r=e.indexOf("\n",n);return-1==r?Ft:(n=Number(e.substring(n,r)),isNaN(n)?Vt:(r+=1)+n>e.length?Ft:(e=e.slice(r,r+n),t.C=r+n,e))}function $t(t){t.S=Date.now()+t.I,zt(t,t.I)}function zt(t,e){if(null!=t.B)throw Error("WatchDog timer not null");t.B=Dt(u(t.ba,t),e)}function Gt(t){t.B&&(i.clearTimeout(t.B),t.B=null)}function ne(t){0==t.j.G||t.J||vn(t.j,t)}function re(t){Gt(t);var e=t.M;e&&"function"==typeof e.ma&&e.ma(),t.M=null,ht(t.U),t.g&&(e=t.g,t.g=null,e.abort(),e.ma())}function ie(t,e){try{var n=t.j;if(0!=n.G&&(n.g==t||ue(n.h,t)))if(!t.K&&ue(n.h,t)&&3==n.G){try{var r=n.Da.g.parse(e)}catch(t){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){t:if(!n.u){if(n.g){if(!(n.g.F+3e3<t.F))break t;yn(n),an(n)}gn(n),St(18)}}else n.za=i[1],0<n.za-n.T&&37500>i[2]&&n.F&&0==n.v&&!n.C&&(n.C=Dt(u(n.Za,n),6e3));if(1>=ce(n.h)&&n.ca){try{n.ca()}catch(t){}n.ca=void 0}}else En(n,11)}else if((t.K||n.g==t)&&yn(n),!g(e))for(i=n.Da.g.parse(e),e=0;e<i.length;e++){let u=i[e];if(n.T=u[0],u=u[1],2==n.G)if("c"==u[0]){n.K=u[1],n.ia=u[2];const e=u[3];null!=e&&(n.la=e,n.j.info("VER="+n.la));const i=u[4];null!=i&&(n.Aa=i,n.j.info("SVER="+n.Aa));const h=u[5];null!=h&&"number"==typeof h&&0<h&&(r=1.5*h,n.L=r,n.j.info("backChannelRequestTimeoutMs_="+r)),r=n;const l=t.g;if(l){const t=l.g?l.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(t){var s=r.h;s.g||-1==t.indexOf("spdy")&&-1==t.indexOf("quic")&&-1==t.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(he(s,s.h),s.h=null))}if(r.D){const t=l.g?l.g.getResponseHeader("X-HTTP-Session-Id"):null;t&&(r.ya=t,Ee(r.I,r.D,t))}}n.G=3,n.l&&n.l.ua(),n.ba&&(n.R=Date.now()-t.F,n.j.info("Handshake RTT: "+n.R+"ms"));var o=t;if((r=n).qa=_n(r,r.J?r.ia:null,r.W),o.K){le(r.h,o);var a=o,c=r.L;c&&(a.I=c),a.B&&(Gt(a),$t(a)),r.g=o}else fn(r);0<n.i.length&&un(n)}else"stop"!=u[0]&&"close"!=u[0]||En(n,7);else 3==n.G&&("stop"==u[0]||"close"==u[0]?"stop"==u[0]?En(n,7):on(n):"noop"!=u[0]&&n.l&&n.l.ta(u),n.v=0)}Ct()}catch(t){}}Mt.prototype.ca=function(t){t=t.target;const e=this.M;e&&3==en(t)?e.j():this.Y(t)},Mt.prototype.Y=function(t){try{if(t==this.g)t:{const d=en(this.g);var e=this.g.Ba();if(this.g.Z(),!(3>d)&&(3!=d||this.g&&(this.h.h||this.g.oa()||nn(this.g)))){this.J||4!=d||7==e||Ct(),Gt(this);var n=this.g.Z();this.X=n;e:if(jt(this)){var r=nn(this.g);t="";var s=r.length,o=4==en(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){re(this),ne(this);var a="";break e}this.h.i=new i.TextDecoder}for(e=0;e<s;e++)this.h.h=!0,t+=this.h.i.decode(r[e],{stream:!(o&&e==s-1)});r.length=0,this.h.g+=t,this.C=0,a=this.h.g}else a=this.g.oa();if(this.o=200==n,function(t,e,n,r,i,s,o){t.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+"\n"+n+"\n"+s+" "+o}))}(this.i,this.u,this.A,this.l,this.R,d,n),this.o){if(this.T&&!this.K){e:{if(this.g){var c,u=this.g;if((c=u.g?u.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!g(c)){var h=c;break e}}h=null}if(!(n=h)){this.o=!1,this.s=3,St(12),re(this),ne(this);break t}kt(this.i,this.l,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,ie(this,n)}if(this.P){let t;for(n=!0;!this.J&&this.C<a.length;){if(t=qt(this,a),t==Ft){4==d&&(this.s=4,St(14),n=!1),kt(this.i,this.l,null,"[Incomplete Response]");break}if(t==Vt){this.s=4,St(15),kt(this.i,this.l,a,"[Invalid Chunk]"),n=!1;break}kt(this.i,this.l,t,null),ie(this,t)}if(jt(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=d||0!=a.length||this.h.h||(this.s=1,St(16),n=!1),this.o=this.o&&n,n){if(0<a.length&&!this.W){this.W=!0;var l=this.j;l.g==this&&l.ba&&!l.M&&(l.j.info("Great, no buffering proxy detected. Bytes received: "+a.length),pn(l),l.M=!0,St(11))}}else kt(this.i,this.l,a,"[Invalid Chunked Response]"),re(this),ne(this)}else kt(this.i,this.l,a,null),ie(this,a);4==d&&re(this),this.o&&!this.J&&(4==d?vn(this.j,this):(this.o=!1,$t(this)))}else(function(t){const e={};t=(t.g&&2<=en(t)&&t.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<t.length;r++){if(g(t[r]))continue;var n=_(t[r]);const i=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();const s=e[i]||[];e[i]=s,s.push(n)}!function(t,e){for(const n in t)e.call(void 0,t[n],n,t)}(e,(function(t){return t.join(", ")}))})(this.g),400==n&&0<a.indexOf("Unknown SID")?(this.s=3,St(12)):(this.s=0,St(13)),re(this),ne(this)}}}catch(t){}},Mt.prototype.cancel=function(){this.J=!0,re(this)},Mt.prototype.ba=function(){this.B=null;const t=Date.now();0<=t-this.S?(function(t,e){t.info((function(){return"TIMEOUT: "+e}))}(this.i,this.A),2!=this.L&&(Ct(),St(17)),re(this),this.s=2,ne(this)):zt(this,this.S-t)};var se=class{constructor(t,e){this.g=t,this.map=e}};function oe(t){this.l=t||10,t=i.PerformanceNavigationTiming?0<(t=i.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(i.chrome&&i.chrome.loadTimes&&i.chrome.loadTimes()&&i.chrome.loadTimes().wasFetchedViaSpdy),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function ae(t){return!!t.h||!!t.g&&t.g.size>=t.j}function ce(t){return t.h?1:t.g?t.g.size:0}function ue(t,e){return t.h?t.h==e:!!t.g&&t.g.has(e)}function he(t,e){t.g?t.g.add(e):t.h=e}function le(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function de(t){if(null!=t.h)return t.i.concat(t.h.D);if(null!=t.g&&0!==t.g.size){let e=t.i;for(const n of t.g.values())e=e.concat(n.D);return e}return d(t.i)}function fe(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(s(t)||"string"==typeof t)Array.prototype.forEach.call(t,e,void 0);else for(var n=function(t){if(t.na&&"function"==typeof t.na)return t.na();if(!t.V||"function"!=typeof t.V){if("undefined"!=typeof Map&&t instanceof Map)return Array.from(t.keys());if(!("undefined"!=typeof Set&&t instanceof Set)){if(s(t)||"string"==typeof t){var e=[];t=t.length;for(var n=0;n<t;n++)e.push(n);return e}e=[],n=0;for(const r in t)e[n++]=r;return e}}}(t),r=function(t){if(t.V&&"function"==typeof t.V)return t.V();if("undefined"!=typeof Map&&t instanceof Map||"undefined"!=typeof Set&&t instanceof Set)return Array.from(t.values());if("string"==typeof t)return t.split("");if(s(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t),i=r.length,o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}oe.prototype.cancel=function(){if(this.i=de(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const t of this.g.values())t.cancel();this.g.clear()}};var ge=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function pe(t){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,t instanceof pe){this.h=t.h,ye(this,t.j),this.o=t.o,this.g=t.g,ve(this,t.s),this.l=t.l;var e=t.i,n=new xe;n.i=e.i,e.g&&(n.g=new Map(e.g),n.h=e.h),we(this,n),this.m=t.m}else t&&(e=String(t).match(ge))?(this.h=!1,ye(this,e[1]||"",!0),this.o=_e(e[2]||""),this.g=_e(e[3]||"",!0),ve(this,e[4]),this.l=_e(e[5]||"",!0),we(this,e[6]||"",!0),this.m=_e(e[7]||"")):(this.h=!1,this.i=new xe(null,this.h))}function me(t){return new pe(t)}function ye(t,e,n){t.j=n?_e(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function ve(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.s=e}else t.s=null}function we(t,e,n){e instanceof xe?(t.i=e,function(t,e){e&&!t.j&&(Re(t),t.i=null,t.g.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(Le(this,e),Me(this,n,t))}),t)),t.j=e}(t.i,t.h)):(n||(e=Te(e,Ne)),t.i=new xe(e,t.h))}function Ee(t,e,n){t.i.set(e,n)}function be(t){return Ee(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function _e(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Te(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,Ce),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function Ce(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}pe.prototype.toString=function(){var t=[],e=this.j;e&&t.push(Te(e,Se,!0),":");var n=this.g;return(n||"file"==e)&&(t.push("//"),(e=this.o)&&t.push(Te(e,Se,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.s)&&t.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&t.push("/"),t.push(Te(n,"/"==n.charAt(0)?De:Ae,!0))),(n=this.i.toString())&&t.push("?",n),(n=this.m)&&t.push("#",Te(n,ke)),t.join("")};var Ie,Se=/[#\/\?@]/g,Ae=/[#\?:]/g,De=/[#\?]/g,Ne=/[#\?@]/g,ke=/#/g;function xe(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function Re(t){t.g||(t.g=new Map,t.h=0,t.i&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var s=t[n].substring(0,r);i=t[n].substring(r+1)}else s=t[n];e(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.i,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})))}function Le(t,e){Re(t),e=Pe(t,e),t.g.has(e)&&(t.i=null,t.h-=t.g.get(e).length,t.g.delete(e))}function Oe(t,e){return Re(t),e=Pe(t,e),t.g.has(e)}function Me(t,e,n){Le(t,e),0<n.length&&(t.i=null,t.g.set(Pe(t,e),d(n)),t.h+=n.length)}function Pe(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}function Ve(t,e,n,r,i){try{i&&(i.onload=null,i.onerror=null,i.onabort=null,i.ontimeout=null),r(n)}catch(t){}}function Fe(){this.g=new ft}function Ue(t,e,n){const r=n||"";try{fe(t,(function(t,n){let i=t;o(t)&&(i=lt(t)),e.push(r+n+"="+encodeURIComponent(i))}))}catch(t){throw e.push(r+"type="+encodeURIComponent("_badmap")),t}}function Be(t){this.l=t.Ub||null,this.j=t.eb||!1}function je(t,e){nt.call(this),this.D=t,this.o=e,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function qe(t){t.j.read().then(t.Pa.bind(t)).catch(t.ga.bind(t))}function $e(t){t.readyState=4,t.l=null,t.j=null,t.v=null,ze(t)}function ze(t){t.onreadystatechange&&t.onreadystatechange.call(t)}function Ge(t){let e="";return v(t,(function(t,n){e+=n,e+=":",e+=t,e+="\r\n"})),e}function He(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}r||(n=Ge(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):Ee(t,e,n))}function Ke(t){nt.call(this),this.headers=new Map,this.o=t||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(t=xe.prototype).add=function(t,e){Re(this),this.i=null,t=Pe(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this},t.forEach=function(t,e){Re(this),this.g.forEach((function(n,r){n.forEach((function(n){t.call(e,n,r,this)}),this)}),this)},t.na=function(){Re(this);const t=Array.from(this.g.values()),e=Array.from(this.g.keys()),n=[];for(let r=0;r<e.length;r++){const i=t[r];for(let t=0;t<i.length;t++)n.push(e[r])}return n},t.V=function(t){Re(this);let e=[];if("string"==typeof t)Oe(this,t)&&(e=e.concat(this.g.get(Pe(this,t))));else{t=Array.from(this.g.values());for(let n=0;n<t.length;n++)e=e.concat(t[n])}return e},t.set=function(t,e){return Re(this),this.i=null,Oe(this,t=Pe(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},t.get=function(t,e){return t&&0<(t=this.V(t)).length?String(t[0]):e},t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const t=[],e=Array.from(this.g.keys());for(var n=0;n<e.length;n++){var r=e[n];const s=encodeURIComponent(String(r)),o=this.V(r);for(r=0;r<o.length;r++){var i=s;""!==o[r]&&(i+="="+encodeURIComponent(String(o[r]))),t.push(i)}}return this.i=t.join("&")},l(Be,gt),Be.prototype.g=function(){return new je(this.l,this.j)},Be.prototype.i=(Ie={},function(){return Ie}),l(je,nt),(t=je.prototype).open=function(t,e){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=t,this.A=e,this.readyState=1,ze(this)},t.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.u,method:this.B,credentials:this.m,cache:void 0};t&&(e.body=t),(this.D||i).fetch(new Request(this.A,e)).then(this.Sa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,$e(this)),this.readyState=0},t.Sa=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,ze(this)),this.g&&(this.readyState=3,ze(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(void 0!==i.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;qe(this)}else t.text().then(this.Ra.bind(this),this.ga.bind(this))},t.Pa=function(t){if(this.g){if(this.o&&t.value)this.response.push(t.value);else if(!this.o){var e=t.value?t.value:new Uint8Array(0);(e=this.v.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?$e(this):ze(this),3==this.readyState&&qe(this)}},t.Ra=function(t){this.g&&(this.response=this.responseText=t,$e(this))},t.Qa=function(t){this.g&&(this.response=t,$e(this))},t.ga=function(){this.g&&$e(this)},t.setRequestHeader=function(t,e){this.u.append(t,e)},t.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const t=[],e=this.h.entries();for(var n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},Object.defineProperty(je.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}}),l(Ke,nt);var Qe=/^https?$/i,We=["POST","PUT"];function Xe(t,e){t.h=!1,t.g&&(t.j=!0,t.g.abort(),t.j=!1),t.l=e,t.m=5,Ye(t),Ze(t)}function Ye(t){t.A||(t.A=!0,rt(t,"complete"),rt(t,"error"))}function Je(t){if(t.h&&void 0!==r&&(!t.v[1]||4!=en(t)||2!=t.Z()))if(t.u&&4==en(t))st(t.Ea,0,t);else if(rt(t,"readystatechange"),4==en(t)){t.h=!1;try{const r=t.Z();t:switch(r){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break t;default:e=!1}var n;if(!(n=e)){var s;if(s=0===r){var o=String(t.D).match(ge)[1]||null;!o&&i.self&&i.self.location&&(o=i.self.location.protocol.slice(0,-1)),s=!Qe.test(o?o.toLowerCase():"")}n=s}if(n)rt(t,"complete"),rt(t,"success");else{t.m=6;try{var a=2<en(t)?t.g.statusText:""}catch(t){a=""}t.l=a+" ["+t.Z()+"]",Ye(t)}}finally{Ze(t)}}}function Ze(t,e){if(t.g){tn(t);const n=t.g,r=t.v[0]?()=>{}:null;t.g=null,t.v=null,e||rt(t,"ready");try{n.onreadystatechange=r}catch(t){}}}function tn(t){t.I&&(i.clearTimeout(t.I),t.I=null)}function en(t){return t.g?t.g.readyState:0}function nn(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.H){case"":case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(t){return null}}function rn(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function sn(t){this.Aa=0,this.i=[],this.j=new Nt,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=rn("failFast",!1,t),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=rn("baseRetryDelayMs",5e3,t),this.cb=rn("retryDelaySeedMs",1e4,t),this.Wa=rn("forwardChannelMaxRetries",2,t),this.wa=rn("forwardChannelRequestTimeoutMs",2e4,t),this.pa=t&&t.xmlHttpFactory||void 0,this.Xa=t&&t.Tb||void 0,this.Ca=t&&t.useFetchStreams||!1,this.L=void 0,this.J=t&&t.supportsCrossDomainXhr||!1,this.K="",this.h=new oe(t&&t.concurrentRequestLimit),this.Da=new Fe,this.P=t&&t.fastHandshake||!1,this.O=t&&t.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=t&&t.Rb||!1,t&&t.xa&&this.j.xa(),t&&t.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&t&&t.detectBufferingProxy||!1,this.ja=void 0,t&&t.longPollingTimeout&&0<t.longPollingTimeout&&(this.ja=t.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function on(t){if(cn(t),3==t.G){var e=t.U++,n=me(t.I);if(Ee(n,"SID",t.K),Ee(n,"RID",e),Ee(n,"TYPE","terminate"),ln(t,n),(e=new Mt(t,t.j,e)).L=2,e.v=be(me(n)),n=!1,i.navigator&&i.navigator.sendBeacon)try{n=i.navigator.sendBeacon(e.v.toString(),"")}catch(t){}!n&&i.Image&&((new Image).src=e.v,n=!0),n||(e.g=Tn(e.j,null),e.g.ea(e.v)),e.F=Date.now(),$t(e)}bn(t)}function an(t){t.g&&(pn(t),t.g.cancel(),t.g=null)}function cn(t){an(t),t.u&&(i.clearTimeout(t.u),t.u=null),yn(t),t.h.cancel(),t.s&&("number"==typeof t.s&&i.clearTimeout(t.s),t.s=null)}function un(t){if(!ae(t.h)&&!t.s){t.s=!0;var e=t.Ga;A||k(),D||(A(),D=!0),N.add(e,t),t.B=0}}function hn(t,e){var n;n=e?e.l:t.U++;const r=me(t.I);Ee(r,"SID",t.K),Ee(r,"RID",n),Ee(r,"AID",t.T),ln(t,r),t.m&&t.o&&He(r,t.m,t.o),n=new Mt(t,t.j,n,t.B+1),null===t.m&&(n.H=t.o),e&&(t.i=e.D.concat(t.i)),e=dn(t,n,1e3),n.I=Math.round(.5*t.wa)+Math.round(.5*t.wa*Math.random()),he(t.h,n),Ut(n,r,e)}function ln(t,e){t.H&&v(t.H,(function(t,n){Ee(e,n,t)})),t.l&&fe({},(function(t,n){Ee(e,n,t)}))}function dn(t,e,n){n=Math.min(t.i.length,n);var r=t.l?u(t.l.Na,t.l,t):null;t:{var i=t.i;let e=-1;for(;;){const t=["count="+n];-1==e?0<n?(e=i[0].g,t.push("ofs="+e)):e=0:t.push("ofs="+e);let s=!0;for(let o=0;o<n;o++){let n=i[o].g;const a=i[o].map;if(n-=e,0>n)e=Math.max(0,i[o].g-100),s=!1;else try{Ue(a,t,"req"+n+"_")}catch(t){r&&r(a)}}if(s){r=t.join("&");break t}}}return t=t.i.splice(0,n),e.D=t,r}function fn(t){if(!t.g&&!t.u){t.Y=1;var e=t.Fa;A||k(),D||(A(),D=!0),N.add(e,t),t.v=0}}function gn(t){return!(t.g||t.u||3<=t.v||(t.Y++,t.u=Dt(u(t.Fa,t),wn(t,t.v)),t.v++,0))}function pn(t){null!=t.A&&(i.clearTimeout(t.A),t.A=null)}function mn(t){t.g=new Mt(t,t.j,"rpc",t.Y),null===t.m&&(t.g.H=t.o),t.g.O=0;var e=me(t.qa);Ee(e,"RID","rpc"),Ee(e,"SID",t.K),Ee(e,"AID",t.T),Ee(e,"CI",t.F?"0":"1"),!t.F&&t.ja&&Ee(e,"TO",t.ja),Ee(e,"TYPE","xmlhttp"),ln(t,e),t.m&&t.o&&He(e,t.m,t.o),t.L&&(t.g.I=t.L);var n=t.g;t=t.ia,n.L=1,n.v=be(me(e)),n.m=null,n.P=!0,Bt(n,t)}function yn(t){null!=t.C&&(i.clearTimeout(t.C),t.C=null)}function vn(t,e){var n=null;if(t.g==e){yn(t),pn(t),t.g=null;var r=2}else{if(!ue(t.h,e))return;n=e.D,le(t.h,e),r=1}if(0!=t.G)if(e.o)if(1==r){n=e.m?e.m.length:0,e=Date.now()-e.F;var i=t.B;rt(r=_t(),new At(r,n)),un(t)}else fn(t);else if(3==(i=e.s)||0==i&&0<e.X||!(1==r&&function(t,e){return!(ce(t.h)>=t.h.j-(t.s?1:0)||(t.s?(t.i=e.D.concat(t.i),0):1==t.G||2==t.G||t.B>=(t.Va?0:t.Wa)||(t.s=Dt(u(t.Ga,t,e),wn(t,t.B)),t.B++,0)))}(t,e)||2==r&&gn(t)))switch(n&&0<n.length&&(e=t.h,e.i=e.i.concat(n)),i){case 1:En(t,5);break;case 4:En(t,10);break;case 3:En(t,6);break;default:En(t,2)}}function wn(t,e){let n=t.Ta+Math.floor(Math.random()*t.cb);return t.isActive()||(n*=2),n*e}function En(t,e){if(t.j.info("Error code "+e),2==e){var n=u(t.fb,t),r=t.Xa;const e=!r;r=new pe(r||"//www.google.com/images/cleardot.gif"),i.location&&"http"==i.location.protocol||ye(r,"https"),be(r),e?function(t,e){const n=new Nt;if(i.Image){const r=new Image;r.onload=h(Ve,n,"TestLoadImage: loaded",!0,e,r),r.onerror=h(Ve,n,"TestLoadImage: error",!1,e,r),r.onabort=h(Ve,n,"TestLoadImage: abort",!1,e,r),r.ontimeout=h(Ve,n,"TestLoadImage: timeout",!1,e,r),i.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=t}else e(!1)}(r.toString(),n):function(t,e){new Nt;const n=new AbortController,r=setTimeout((()=>{n.abort(),Ve(0,0,!1,e)}),1e4);fetch(t,{signal:n.signal}).then((t=>{clearTimeout(r),t.ok?Ve(0,0,!0,e):Ve(0,0,!1,e)})).catch((()=>{clearTimeout(r),Ve(0,0,!1,e)}))}(r.toString(),n)}else St(2);t.G=0,t.l&&t.l.sa(e),bn(t),cn(t)}function bn(t){if(t.G=0,t.ka=[],t.l){const e=de(t.h);0==e.length&&0==t.i.length||(f(t.ka,e),f(t.ka,t.i),t.h.i.length=0,d(t.i),t.i.length=0),t.l.ra()}}function _n(t,e,n){var r=n instanceof pe?me(n):new pe(n);if(""!=r.g)e&&(r.g=e+"."+r.g),ve(r,r.s);else{var s=i.location;r=s.protocol,e=e?e+"."+s.hostname:s.hostname,s=+s.port;var o=new pe(null);r&&ye(o,r),e&&(o.g=e),s&&ve(o,s),n&&(o.l=n),r=o}return n=t.D,e=t.ya,n&&e&&Ee(r,n,e),Ee(r,"VER",t.la),ln(t,r),r}function Tn(t,e,n){if(e&&!t.J)throw Error("Can't create secondary domain capable XhrIo object.");return(e=t.Ca&&!t.pa?new Ke(new Be({eb:n})):new Ke(t.pa)).Ha(t.J),e}function Cn(){}function In(){}function Sn(t,e){nt.call(this),this.g=new sn(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.o=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.va&&(t?t["X-WebChannel-Client-Profile"]=e.va:t={"X-WebChannel-Client-Profile":e.va}),this.g.S=t,(t=e&&e.Sb)&&!g(t)&&(this.g.m=t),this.v=e&&e.supportsCrossDomainXhr||!1,this.u=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!g(e)&&(this.g.D=e,null!==(t=this.h)&&e in t&&e in(t=this.h)&&delete t[e]),this.j=new Nn(this)}function An(t){vt.call(this),t.__headers__&&(this.headers=t.__headers__,this.statusCode=t.__status__,delete t.__headers__,delete t.__status__);var e=t.__sm__;if(e){t:{for(const n in e){t=n;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function Dn(){wt.call(this),this.status=1}function Nn(t){this.g=t}(t=Ke.prototype).Ha=function(t){this.J=t},t.ea=function(t,e,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+t);e=e?e.toUpperCase():"GET",this.D=t,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():xt.g(),this.v=this.o?pt(this.o):pt(xt),this.g.onreadystatechange=u(this.Ea,this);try{this.B=!0,this.g.open(e,String(t),!0),this.B=!1}catch(t){return void Xe(this,t)}if(t=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var s in r)n.set(s,r[s]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const t of r.keys())n.set(t,r.get(t))}r=Array.from(n.keys()).find((t=>"content-type"==t.toLowerCase())),s=i.FormData&&t instanceof i.FormData,!(0<=Array.prototype.indexOf.call(We,e,void 0))||r||s||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[t,e]of n)this.g.setRequestHeader(t,e);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{tn(this),this.u=!0,this.g.send(t),this.u=!1}catch(t){Xe(this,t)}},t.abort=function(t){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=t||7,rt(this,"complete"),rt(this,"abort"),Ze(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Ze(this,!0)),Ke.aa.N.call(this)},t.Ea=function(){this.s||(this.B||this.u||this.j?Je(this):this.bb())},t.bb=function(){Je(this)},t.isActive=function(){return!!this.g},t.Z=function(){try{return 2<en(this)?this.g.status:-1}catch(t){return-1}},t.oa=function(){try{return this.g?this.g.responseText:""}catch(t){return""}},t.Oa=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),dt(e)}},t.Ba=function(){return this.m},t.Ka=function(){return"string"==typeof this.l?this.l:String(this.l)},(t=sn.prototype).la=8,t.G=1,t.connect=function(t,e,n,r){St(0),this.W=t,this.H=e||{},n&&void 0!==r&&(this.H.OSID=n,this.H.OAID=r),this.F=this.X,this.I=_n(this,null,this.W),un(this)},t.Ga=function(t){if(this.s)if(this.s=null,1==this.G){if(!t){this.U=Math.floor(1e5*Math.random()),t=this.U++;const i=new Mt(this,this.j,t);let s=this.o;if(this.S&&(s?(s=w(s),b(s,this.S)):s=this.S),null!==this.m||this.O||(i.H=s,s=null),this.P)t:{for(var e=0,n=0;n<this.i.length;n++){var r=this.i[n];if(void 0===(r="__data__"in r.map&&"string"==typeof(r=r.map.__data__)?r.length:void 0))break;if(4096<(e+=r)){e=n;break t}if(4096===e||n===this.i.length-1){e=n+1;break t}}e=1e3}else e=1e3;e=dn(this,i,e),Ee(n=me(this.I),"RID",t),Ee(n,"CVER",22),this.D&&Ee(n,"X-HTTP-Session-Id",this.D),ln(this,n),s&&(this.O?e="headers="+encodeURIComponent(String(Ge(s)))+"&"+e:this.m&&He(n,this.m,s)),he(this.h,i),this.Ua&&Ee(n,"TYPE","init"),this.P?(Ee(n,"$req",e),Ee(n,"SID","null"),i.T=!0,Ut(i,n,null)):Ut(i,n,e),this.G=2}}else 3==this.G&&(t?hn(this,t):0==this.i.length||ae(this.h)||hn(this))},t.Fa=function(){if(this.u=null,mn(this),this.ba&&!(this.M||null==this.g||0>=this.R)){var t=2*this.R;this.j.info("BP detection timer enabled: "+t),this.A=Dt(u(this.ab,this),t)}},t.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,St(10),an(this),mn(this))},t.Za=function(){null!=this.C&&(this.C=null,an(this),gn(this),St(19))},t.fb=function(t){t?(this.j.info("Successfully pinged google.com"),St(2)):(this.j.info("Failed to ping google.com"),St(1))},t.isActive=function(){return!!this.l&&this.l.isActive(this)},(t=Cn.prototype).ua=function(){},t.ta=function(){},t.sa=function(){},t.ra=function(){},t.isActive=function(){return!0},t.Na=function(){},In.prototype.g=function(t,e){return new Sn(t,e)},l(Sn,nt),Sn.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Sn.prototype.close=function(){on(this.g)},Sn.prototype.o=function(t){var e=this.g;if("string"==typeof t){var n={};n.__data__=t,t=n}else this.u&&((n={}).__data__=lt(t),t=n);e.i.push(new se(e.Ya++,t)),3==e.G&&un(e)},Sn.prototype.N=function(){this.g.l=null,delete this.j,on(this.g),delete this.g,Sn.aa.N.call(this)},l(An,vt),l(Dn,wt),l(Nn,Cn),Nn.prototype.ua=function(){rt(this.g,"a")},Nn.prototype.ta=function(t){rt(this.g,new An(t))},Nn.prototype.sa=function(t){rt(this.g,new Dn)},Nn.prototype.ra=function(){rt(this.g,"b")},In.prototype.createWebChannel=In.prototype.g,Sn.prototype.send=Sn.prototype.o,Sn.prototype.open=Sn.prototype.m,Sn.prototype.close=Sn.prototype.close,Zt=ee.createWebChannelTransport=function(){return new In},Jt=ee.getStatEventTarget=function(){return _t()},Yt=ee.Event=Et,Xt=ee.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Rt.NO_ERROR=0,Rt.TIMEOUT=8,Rt.HTTP_ERROR=6,Wt=ee.ErrorCode=Rt,Lt.COMPLETE="complete",Qt=ee.EventType=Lt,mt.EventType=yt,yt.OPEN="a",yt.CLOSE="b",yt.ERROR="c",yt.MESSAGE="d",nt.prototype.listen=nt.prototype.K,Kt=ee.WebChannel=mt,ee.FetchXmlHttpFactory=Be,Ke.prototype.listenOnce=Ke.prototype.L,Ke.prototype.getLastError=Ke.prototype.Ka,Ke.prototype.getLastErrorCode=Ke.prototype.Ba,Ke.prototype.getStatus=Ke.prototype.Z,Ke.prototype.getResponseJson=Ke.prototype.Oa,Ke.prototype.getResponseText=Ke.prototype.oa,Ke.prototype.send=Ke.prototype.ea,Ke.prototype.setWithCredentials=Ke.prototype.Ha,Ht=ee.XhrIo=Ke}).apply(void 0!==te?te:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});const ne="@firebase/firestore",re="4.7.15";class ie{constructor(t){this.uid=t}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}ie.UNAUTHENTICATED=new ie(null),ie.GOOGLE_CREDENTIALS=new ie("google-credentials-uid"),ie.FIRST_PARTY=new ie("first-party-uid"),ie.MOCK_USER=new ie("mock-user");let se="11.8.0";const oe=new N("@firebase/firestore");function ae(){return oe.logLevel}function ce(t,...e){if(oe.logLevel<=C.DEBUG){const n=e.map(le);oe.debug(`Firestore (${se}): ${t}`,...n)}}function ue(t,...e){if(oe.logLevel<=C.ERROR){const n=e.map(le);oe.error(`Firestore (${se}): ${t}`,...n)}}function he(t,...e){if(oe.logLevel<=C.WARN){const n=e.map(le);oe.warn(`Firestore (${se}): ${t}`,...n)}}function le(t){if("string"==typeof t)return t;try{return function(t){return JSON.stringify(t)}(t)}catch(e){return t}}function de(t,e,n){let r="Unexpected state";"string"==typeof e?r=e:n=e,fe(t,r,n)}function fe(t,e,n){let r=`FIRESTORE (${se}) INTERNAL ASSERTION FAILED: ${e} (ID: ${t.toString(16)})`;if(void 0!==n)try{r+=" CONTEXT: "+JSON.stringify(n)}catch(t){r+=" CONTEXT: "+n}throw ue(r),new Error(r)}function ge(t,e,n,r){let i="Unexpected state";"string"==typeof n?i=n:r=n,t||fe(e,i,r)}function pe(t,e){return t}const me={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class ye extends f{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class ve{constructor(){this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}}class we{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class Ee{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable((()=>e(ie.UNAUTHENTICATED)))}shutdown(){}}class be{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable((()=>e(this.token.user)))}shutdown(){this.changeListener=null}}class _e{constructor(t){this.t=t,this.currentUser=ie.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){ge(void 0===this.o,42304);let n=this.i;const r=t=>this.i!==n?(n=this.i,e(t)):Promise.resolve();let i=new ve;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new ve,t.enqueueRetryable((()=>r(this.currentUser)))};const s=()=>{const e=i;t.enqueueRetryable((async()=>{await e.promise,await r(this.currentUser)}))},o=t=>{ce("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=t,this.o&&(this.auth.addAuthTokenListener(this.o),s())};this.t.onInit((t=>o(t))),setTimeout((()=>{if(!this.auth){const t=this.t.getImmediate({optional:!0});t?o(t):(ce("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new ve)}}),0),s()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then((e=>this.i!==t?(ce("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(ge("string"==typeof e.accessToken,31837,{l:e}),new we(e.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const t=this.auth&&this.auth.getUid();return ge(null===t||"string"==typeof t,2055,{h:t}),new ie(t)}}class Te{constructor(t,e,n){this.P=t,this.T=e,this.I=n,this.type="FirstParty",this.user=ie.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const t=this.R();return t&&this.A.set("Authorization",t),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class Ce{constructor(t,e,n){this.P=t,this.T=e,this.I=n}getToken(){return Promise.resolve(new Te(this.P,this.T,this.I))}start(t,e){t.enqueueRetryable((()=>e(ie.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Ie{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Se{constructor(t,e){var n;this.V=e,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,null!=(n=t)&&void 0!==n.settings&&t.settings.appCheckToken&&(this.p=t.settings.appCheckToken)}start(t,e){ge(void 0===this.o,3512);const n=t=>{null!=t.error&&ce("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${t.error.message}`);const n=t.token!==this.m;return this.m=t.token,ce("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?e(t.token):Promise.resolve()};this.o=e=>{t.enqueueRetryable((()=>n(e)))};const r=t=>{ce("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=t,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((t=>r(t))),setTimeout((()=>{if(!this.appCheck){const t=this.V.getImmediate({optional:!0});t?r(t):ce("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new Ie(this.p));const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then((t=>t?(ge("string"==typeof t.token,44558,{tokenResult:t}),this.m=t.token,new Ie(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function Ae(t){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(let e=0;e<t;e++)n[e]=Math.floor(256*Math.random());return n}function De(){return new TextEncoder}class Ne{static newId(){const t=62*Math.floor(256/62);let e="";for(;e.length<20;){const n=Ae(40);for(let r=0;r<n.length;++r)e.length<20&&n[r]<t&&(e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[r]%62))}return e}}function ke(t,e){return t<e?-1:t>e?1:0}function xe(t,e){let n=0;for(;n<t.length&&n<e.length;){const r=t.codePointAt(n),i=e.codePointAt(n);if(r!==i){if(r<128&&i<128)return ke(r,i);{const s=De(),o=Le(s.encode(Re(t,n)),s.encode(Re(e,n)));return 0!==o?o:ke(r,i)}}n+=r>65535?2:1}return ke(t.length,e.length)}function Re(t,e){return t.codePointAt(e)>65535?t.substring(e,e+2):t.substring(e,e+1)}function Le(t,e){for(let n=0;n<t.length&&n<e.length;++n)if(t[n]!==e[n])return ke(t[n],e[n]);return ke(t.length,e.length)}function Oe(t,e,n){return t.length===e.length&&t.every(((t,r)=>n(t,e[r])))}const Me=-62135596800,Pe=1e6;class Ve{static now(){return Ve.fromMillis(Date.now())}static fromDate(t){return Ve.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),n=Math.floor((t-1e3*e)*Pe);return new Ve(e,n)}constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new ye(me.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new ye(me.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<Me)throw new ye(me.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new ye(me.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Pe}_compareTo(t){return this.seconds===t.seconds?ke(this.nanoseconds,t.nanoseconds):ke(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds-Me;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class Fe{static fromTimestamp(t){return new Fe(t)}static min(){return new Fe(new Ve(0,0))}static max(){return new Fe(new Ve(253402300799,999999999))}constructor(t){this.timestamp=t}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const Ue="__name__";class Be{constructor(t,e,n){void 0===e?e=0:e>t.length&&de(637,{offset:e,range:t.length}),void 0===n?n=t.length-e:n>t.length-e&&de(1746,{length:n,range:t.length-e}),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return 0===Be.comparator(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof Be?t.forEach((t=>{e.push(t)})):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return 0===this.length}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const n=Math.min(t.length,e.length);for(let r=0;r<n;r++){const n=Be.compareSegments(t.get(r),e.get(r));if(0!==n)return n}return ke(t.length,e.length)}static compareSegments(t,e){const n=Be.isNumericId(t),r=Be.isNumericId(e);return n&&!r?-1:!n&&r?1:n&&r?Be.extractNumericId(t).compare(Be.extractNumericId(e)):xe(t,e)}static isNumericId(t){return t.startsWith("__id")&&t.endsWith("__")}static extractNumericId(t){return qt.fromString(t.substring(4,t.length-2))}}class je extends Be{construct(t,e,n){return new je(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){const e=[];for(const n of t){if(n.indexOf("//")>=0)throw new ye(me.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter((t=>t.length>0)))}return new je(e)}static emptyPath(){return new je([])}}const qe=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class $e extends Be{construct(t,e,n){return new $e(t,e,n)}static isValidIdentifier(t){return qe.test(t)}canonicalString(){return this.toArray().map((t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),$e.isValidIdentifier(t)||(t="`"+t+"`"),t))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===Ue}static keyField(){return new $e([Ue])}static fromServerFormat(t){const e=[];let n="",r=0;const i=()=>{if(0===n.length)throw new ye(me.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""};let s=!1;for(;r<t.length;){const e=t[r];if("\\"===e){if(r+1===t.length)throw new ye(me.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const e=t[r+1];if("\\"!==e&&"."!==e&&"`"!==e)throw new ye(me.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=e,r+=2}else"`"===e?(s=!s,r++):"."!==e||s?(n+=e,r++):(i(),r++)}if(i(),s)throw new ye(me.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new $e(e)}static emptyPath(){return new $e([])}}class ze{constructor(t){this.path=t}static fromPath(t){return new ze(je.fromString(t))}static fromName(t){return new ze(je.fromString(t).popFirst(5))}static empty(){return new ze(je.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return null!==t&&0===je.comparator(this.path,t.path)}toString(){return this.path.toString()}static comparator(t,e){return je.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new ze(new je(t.slice()))}}function Ge(t){return new He(t.readTime,t.key,-1)}class He{constructor(t,e,n){this.readTime=t,this.documentKey=e,this.largestBatchId=n}static min(){return new He(Fe.min(),ze.empty(),-1)}static max(){return new He(Fe.max(),ze.empty(),-1)}}function Ke(t,e){let n=t.readTime.compareTo(e.readTime);return 0!==n?n:(n=ze.comparator(t.documentKey,e.documentKey),0!==n?n:ke(t.largestBatchId,e.largestBatchId))}class Qe{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((t=>t()))}}async function We(t){if(t.code!==me.FAILED_PRECONDITION||"The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab."!==t.message)throw t;ce("LocalStore","Unexpectedly lost primary lease")}class Xe{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&de(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new Xe(((n,r)=>{this.nextCallback=e=>{this.wrapSuccess(t,e).next(n,r)},this.catchCallback=t=>{this.wrapFailure(e,t).next(n,r)}}))}toPromise(){return new Promise(((t,e)=>{this.next(t,e)}))}wrapUserFunction(t){try{const e=t();return e instanceof Xe?e:Xe.resolve(e)}catch(t){return Xe.reject(t)}}wrapSuccess(t,e){return t?this.wrapUserFunction((()=>t(e))):Xe.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction((()=>t(e))):Xe.reject(e)}static resolve(t){return new Xe(((e,n)=>{e(t)}))}static reject(t){return new Xe(((e,n)=>{n(t)}))}static waitFor(t){return new Xe(((e,n)=>{let r=0,i=0,s=!1;t.forEach((t=>{++r,t.next((()=>{++i,s&&i===r&&e()}),(t=>n(t)))})),s=!0,i===r&&e()}))}static or(t){let e=Xe.resolve(!1);for(const n of t)e=e.next((t=>t?Xe.resolve(t):n()));return e}static forEach(t,e){const n=[];return t.forEach(((t,r)=>{n.push(e.call(this,t,r))})),this.waitFor(n)}static mapArray(t,e){return new Xe(((n,r)=>{const i=t.length,s=new Array(i);let o=0;for(let a=0;a<i;a++){const c=a;e(t[c]).next((t=>{s[c]=t,++o,o===i&&n(s)}),(t=>r(t)))}}))}static doWhile(t,e){return new Xe(((n,r)=>{const i=()=>{!0===t()?e().next((()=>{i()}),r):n()};i()}))}}function Ye(t){return"IndexedDbTransactionError"===t.name}class Je{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=t=>this.ue(t),this.ce=t=>e.writeSequenceNumber(t))}ue(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.ce&&this.ce(t),t}}Je.le=-1;function Ze(t){return null==t}function tn(t){return 0===t&&1/t==-1/0}function en(t,e){let n=e;const r=t.length;for(let e=0;e<r;e++){const r=t.charAt(e);switch(r){case"\0":n+="";break;case"":n+="";break;default:n+=r}}return n}function nn(t){return t+""}const rn="owner",sn="mutationQueues",on="mutations",an="documentMutations",cn="remoteDocumentGlobal",un="targets",hn="targetDocuments",ln="targetGlobal",dn="collectionParents",fn="clientMetadata",gn="bundles",pn="namedQueries";function mn(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function yn(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function vn(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}class wn{constructor(t,e){this.comparator=t,this.root=e||bn.EMPTY}insert(t,e){return new wn(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,bn.BLACK,null,null))}remove(t){return new wn(this.comparator,this.root.remove(t,this.comparator).copy(null,null,bn.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal(((e,n)=>(t(e,n),!1)))}toString(){const t=[];return this.inorderTraversal(((e,n)=>(t.push(`${e}:${n}`),!1))),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new En(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new En(this.root,t,this.comparator,!1)}getReverseIterator(){return new En(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new En(this.root,t,this.comparator,!0)}}class En{constructor(t,e,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!t.isEmpty();)if(i=e?n(t.key,e):1,e&&r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class bn{constructor(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:bn.RED,this.left=null!=r?r:bn.EMPTY,this.right=null!=i?i:bn.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,r,i){return new bn(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let r=this;const i=n(t,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return bn.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,r=this;if(e(t,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===e(t,r.key)){if(r.right.isEmpty())return bn.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,bn.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,bn.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw de(43730,{key:this.key,value:this.value});if(this.right.isRed())throw de(14113,{key:this.key,value:this.value});const t=this.left.check();if(t!==this.right.check())throw de(27949);return t+(this.isRed()?0:1)}}bn.EMPTY=null,bn.RED=!0,bn.BLACK=!1,bn.EMPTY=new class{constructor(){this.size=0}get key(){throw de(57766)}get value(){throw de(16141)}get color(){throw de(16727)}get left(){throw de(29726)}get right(){throw de(36894)}copy(t,e,n,r,i){return this}insert(t,e,n){return new bn(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class _n{constructor(t){this.comparator=t,this.data=new wn(this.comparator)}has(t){return null!==this.data.get(t)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal(((e,n)=>(t(e),!1)))}forEachInRange(t,e){const n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}}forEachWhile(t,e){let n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new Tn(this.data.getIterator())}getIteratorFrom(t){return new Tn(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach((t=>{e=e.add(t)})),e}isEqual(t){if(!(t instanceof _n))return!1;if(this.size!==t.size)return!1;const e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){const t=e.getNext().key,r=n.getNext().key;if(0!==this.comparator(t,r))return!1}return!0}toArray(){const t=[];return this.forEach((e=>{t.push(e)})),t}toString(){const t=[];return this.forEach((e=>t.push(e))),"SortedSet("+t.toString()+")"}copy(t){const e=new _n(this.comparator);return e.data=t,e}}class Tn{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class Cn{constructor(t){this.fields=t,t.sort($e.comparator)}static empty(){return new Cn([])}unionWith(t){let e=new _n($e.comparator);for(const t of this.fields)e=e.add(t);for(const n of t)e=e.add(n);return new Cn(e.toArray())}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return Oe(this.fields,t.fields,((t,e)=>t.isEqual(e)))}}class In extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Sn{constructor(t){this.binaryString=t}static fromBase64String(t){const e=function(t){try{return atob(t)}catch(t){throw"undefined"!=typeof DOMException&&t instanceof DOMException?new In("Invalid base64 string: "+t):t}}(t);return new Sn(e)}static fromUint8Array(t){const e=function(t){let e="";for(let n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t);return new Sn(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return t=this.binaryString,btoa(t);var t}toUint8Array(){return function(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return ke(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}Sn.EMPTY_BYTE_STRING=new Sn("");const An=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Dn(t){if(ge(!!t,39018),"string"==typeof t){let e=0;const n=An.exec(t);if(ge(!!n,46558,{timestamp:t}),n[1]){let t=n[1];t=(t+"000000000").substr(0,9),e=Number(t)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Nn(t.seconds),nanos:Nn(t.nanos)}}function Nn(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function kn(t){return"string"==typeof t?Sn.fromBase64String(t):Sn.fromUint8Array(t)}const xn="server_timestamp",Rn="__type__",Ln="__previous_value__",On="__local_write_time__";function Mn(t){var e,n;return(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{})[Rn])||void 0===n?void 0:n.stringValue)===xn}function Pn(t){const e=t.mapValue.fields[Ln];return Mn(e)?Pn(e):e}function Vn(t){const e=Dn(t.mapValue.fields[On].timestampValue);return new Ve(e.seconds,e.nanos)}class Fn{constructor(t,e,n,r,i,s,o,a,c,u){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=c,this.isUsingEmulator=u}}const Un="(default)";class Bn{constructor(t,e){this.projectId=t,this.database=e||Un}static empty(){return new Bn("","")}get isDefaultDatabase(){return this.database===Un}isEqual(t){return t instanceof Bn&&t.projectId===this.projectId&&t.database===this.database}}const jn="__type__",qn="__max__",$n={fields:{__type__:{stringValue:qn}}},zn="__vector__",Gn="value";function Hn(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Mn(t)?4:ur(t)?9007199254740991:ar(t)?10:11:de(28295,{value:t})}function Kn(t,e){if(t===e)return!0;const n=Hn(t);if(n!==Hn(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Vn(t).isEqual(Vn(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;const n=Dn(t.timestampValue),r=Dn(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return kn(t.bytesValue).isEqual(kn(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return Nn(t.geoPointValue.latitude)===Nn(e.geoPointValue.latitude)&&Nn(t.geoPointValue.longitude)===Nn(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return Nn(t.integerValue)===Nn(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){const n=Nn(t.doubleValue),r=Nn(e.doubleValue);return n===r?tn(n)===tn(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return Oe(t.arrayValue.values||[],e.arrayValue.values||[],Kn);case 10:case 11:return function(t,e){const n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(mn(n)!==mn(r))return!1;for(const t in n)if(n.hasOwnProperty(t)&&(void 0===r[t]||!Kn(n[t],r[t])))return!1;return!0}(t,e);default:return de(52216,{left:t})}}function Qn(t,e){return void 0!==(t.values||[]).find((t=>Kn(t,e)))}function Wn(t,e){if(t===e)return 0;const n=Hn(t),r=Hn(e);if(n!==r)return ke(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return ke(t.booleanValue,e.booleanValue);case 2:return function(t,e){const n=Nn(t.integerValue||t.doubleValue),r=Nn(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return Xn(t.timestampValue,e.timestampValue);case 4:return Xn(Vn(t),Vn(e));case 5:return xe(t.stringValue,e.stringValue);case 6:return function(t,e){const n=kn(t),r=kn(e);return n.compareTo(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){const n=t.split("/"),r=e.split("/");for(let t=0;t<n.length&&t<r.length;t++){const e=ke(n[t],r[t]);if(0!==e)return e}return ke(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){const n=ke(Nn(t.latitude),Nn(e.latitude));return 0!==n?n:ke(Nn(t.longitude),Nn(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return Yn(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n,r,i,s;const o=t.fields||{},a=e.fields||{},c=null===(n=o[Gn])||void 0===n?void 0:n.arrayValue,u=null===(r=a[Gn])||void 0===r?void 0:r.arrayValue,h=ke((null===(i=null==c?void 0:c.values)||void 0===i?void 0:i.length)||0,(null===(s=null==u?void 0:u.values)||void 0===s?void 0:s.length)||0);return 0!==h?h:Yn(c,u)}(t.mapValue,e.mapValue);case 11:return function(t,e){if(t===$n&&e===$n)return 0;if(t===$n)return 1;if(e===$n)return-1;const n=t.fields||{},r=Object.keys(n),i=e.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let t=0;t<r.length&&t<s.length;++t){const e=xe(r[t],s[t]);if(0!==e)return e;const o=Wn(n[r[t]],i[s[t]]);if(0!==o)return o}return ke(r.length,s.length)}(t.mapValue,e.mapValue);default:throw de(23264,{Pe:n})}}function Xn(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return ke(t,e);const n=Dn(t),r=Dn(e),i=ke(n.seconds,r.seconds);return 0!==i?i:ke(n.nanos,r.nanos)}function Yn(t,e){const n=t.values||[],r=e.values||[];for(let t=0;t<n.length&&t<r.length;++t){const e=Wn(n[t],r[t]);if(e)return e}return ke(n.length,r.length)}function Jn(t){return Zn(t)}function Zn(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){const e=Dn(t);return`time(${e.seconds},${e.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(t){return kn(t).toBase64()}(t.bytesValue):"referenceValue"in t?function(t){return ze.fromName(t).toString()}(t.referenceValue):"geoPointValue"in t?function(t){return`geo(${t.latitude},${t.longitude})`}(t.geoPointValue):"arrayValue"in t?function(t){let e="[",n=!0;for(const r of t.values||[])n?n=!1:e+=",",e+=Zn(r);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){const e=Object.keys(t.fields||{}).sort();let n="{",r=!0;for(const i of e)r?r=!1:n+=",",n+=`${i}:${Zn(t.fields[i])}`;return n+"}"}(t.mapValue):de(61005,{value:t})}function tr(t){switch(Hn(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Pn(t);return e?16+tr(e):16;case 5:return 2*t.stringValue.length;case 6:return kn(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return function(t){return(t.values||[]).reduce(((t,e)=>t+tr(e)),0)}(t.arrayValue);case 10:case 11:return function(t){let e=0;return yn(t.fields,((t,n)=>{e+=t.length+tr(n)})),e}(t.mapValue);default:throw de(13486,{value:t})}}function er(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function nr(t){return!!t&&"integerValue"in t}function rr(t){return!!t&&"arrayValue"in t}function ir(t){return!!t&&"nullValue"in t}function sr(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function or(t){return!!t&&"mapValue"in t}function ar(t){var e,n;return(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{})[jn])||void 0===n?void 0:n.stringValue)===zn}function cr(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return yn(t.mapValue.fields,((t,n)=>e.mapValue.fields[t]=cr(n))),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=cr(t.arrayValue.values[n]);return e}return Object.assign({},t)}function ur(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue===qn}class hr{constructor(t){this.value=t}static empty(){return new hr({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!or(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=cr(e)}setAll(t){let e=$e.emptyPath(),n={},r=[];t.forEach(((t,i)=>{if(!e.isImmediateParentOf(i)){const t=this.getFieldsMap(e);this.applyChanges(t,n,r),n={},r=[],e=i.popLast()}t?n[i.lastSegment()]=cr(t):r.push(i.lastSegment())}));const i=this.getFieldsMap(e);this.applyChanges(i,n,r)}delete(t){const e=this.field(t.popLast());or(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return Kn(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let r=e.mapValue.fields[t.get(n)];or(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=r),e=r}return e.mapValue.fields}applyChanges(t,e,n){yn(e,((e,n)=>t[e]=n));for(const e of n)delete t[e]}clone(){return new hr(cr(this.value))}}function lr(t){const e=[];return yn(t.fields,((t,n)=>{const r=new $e([t]);if(or(n)){const t=lr(n.mapValue).fields;if(0===t.length)e.push(r);else for(const n of t)e.push(r.child(n))}else e.push(r)})),new Cn(e)}class dr{constructor(t,e,n,r,i,s,o){this.key=t,this.documentType=e,this.version=n,this.readTime=r,this.createTime=i,this.data=s,this.documentState=o}static newInvalidDocument(t){return new dr(t,0,Fe.min(),Fe.min(),Fe.min(),hr.empty(),0)}static newFoundDocument(t,e,n,r){return new dr(t,1,e,Fe.min(),n,r,0)}static newNoDocument(t,e){return new dr(t,2,e,Fe.min(),Fe.min(),hr.empty(),0)}static newUnknownDocument(t,e){return new dr(t,3,e,Fe.min(),Fe.min(),hr.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(Fe.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=hr.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=hr.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Fe.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(t){return t instanceof dr&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new dr(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class fr{constructor(t,e){this.position=t,this.inclusive=e}}function gr(t,e,n){let r=0;for(let i=0;i<t.position.length;i++){const s=e[i],o=t.position[i];if(r=s.field.isKeyField()?ze.comparator(ze.fromName(o.referenceValue),n.key):Wn(o,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function pr(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!Kn(t.position[n],e.position[n]))return!1;return!0}class mr{constructor(t,e="asc"){this.field=t,this.dir=e}}function yr(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}class vr{}class wr extends vr{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?"in"===e||"not-in"===e?this.createKeyFieldInFilter(t,e,n):new Sr(t,e,n):"array-contains"===e?new kr(t,n):"in"===e?new xr(t,n):"not-in"===e?new Rr(t,n):"array-contains-any"===e?new Lr(t,n):new wr(t,e,n)}static createKeyFieldInFilter(t,e,n){return"in"===e?new Ar(t,n):new Dr(t,n)}matches(t){const e=t.data.field(this.field);return"!="===this.op?null!==e&&void 0===e.nullValue&&this.matchesComparison(Wn(e,this.value)):null!==e&&Hn(this.value)===Hn(e)&&this.matchesComparison(Wn(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return de(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Er extends vr{constructor(t,e){super(),this.filters=t,this.op=e,this.Te=null}static create(t,e){return new Er(t,e)}matches(t){return br(this)?void 0===this.filters.find((e=>!e.matches(t))):void 0!==this.filters.find((e=>e.matches(t)))}getFlattenedFilters(){return null!==this.Te||(this.Te=this.filters.reduce(((t,e)=>t.concat(e.getFlattenedFilters())),[])),this.Te}getFilters(){return Object.assign([],this.filters)}}function br(t){return"and"===t.op}function _r(t){return function(t){for(const e of t.filters)if(e instanceof Er)return!1;return!0}(t)&&br(t)}function Tr(t){if(t instanceof wr)return t.field.canonicalString()+t.op.toString()+Jn(t.value);if(_r(t))return t.filters.map((t=>Tr(t))).join(",");{const e=t.filters.map((t=>Tr(t))).join(",");return`${t.op}(${e})`}}function Cr(t,e){return t instanceof wr?function(t,e){return e instanceof wr&&t.op===e.op&&t.field.isEqual(e.field)&&Kn(t.value,e.value)}(t,e):t instanceof Er?function(t,e){return e instanceof Er&&t.op===e.op&&t.filters.length===e.filters.length&&t.filters.reduce(((t,n,r)=>t&&Cr(n,e.filters[r])),!0)}(t,e):void de(19439)}function Ir(t){return t instanceof wr?function(t){return`${t.field.canonicalString()} ${t.op} ${Jn(t.value)}`}(t):t instanceof Er?function(t){return t.op.toString()+" {"+t.getFilters().map(Ir).join(" ,")+"}"}(t):"Filter"}class Sr extends wr{constructor(t,e,n){super(t,e,n),this.key=ze.fromName(n.referenceValue)}matches(t){const e=ze.comparator(t.key,this.key);return this.matchesComparison(e)}}class Ar extends wr{constructor(t,e){super(t,"in",e),this.keys=Nr(0,e)}matches(t){return this.keys.some((e=>e.isEqual(t.key)))}}class Dr extends wr{constructor(t,e){super(t,"not-in",e),this.keys=Nr(0,e)}matches(t){return!this.keys.some((e=>e.isEqual(t.key)))}}function Nr(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map((t=>ze.fromName(t.referenceValue)))}class kr extends wr{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return rr(e)&&Qn(e.arrayValue,this.value)}}class xr extends wr{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return null!==e&&Qn(this.value.arrayValue,e)}}class Rr extends wr{constructor(t,e){super(t,"not-in",e)}matches(t){if(Qn(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return null!==e&&void 0===e.nullValue&&!Qn(this.value.arrayValue,e)}}class Lr extends wr{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!rr(e)||!e.arrayValue.values)&&e.arrayValue.values.some((t=>Qn(this.value.arrayValue,t)))}}class Or{constructor(t,e=null,n=[],r=[],i=null,s=null,o=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=o,this.Ie=null}}function Mr(t,e=null,n=[],r=[],i=null,s=null,o=null){return new Or(t,e,n,r,i,s,o)}function Pr(t){const e=pe(t);if(null===e.Ie){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((t=>Tr(t))).join(","),t+="|ob:",t+=e.orderBy.map((t=>function(t){return t.field.canonicalString()+t.dir}(t))).join(","),Ze(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((t=>Jn(t))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((t=>Jn(t))).join(",")),e.Ie=t}return e.Ie}function Vr(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!yr(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!Cr(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!pr(t.startAt,e.startAt)&&pr(t.endAt,e.endAt)}function Fr(t){return ze.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}class Ur{constructor(t,e=null,n=[],r=[],i=null,s="F",o=null,a=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=o,this.endAt=a,this.Ee=null,this.de=null,this.Ae=null,this.startAt,this.endAt}}function Br(t){return new Ur(t)}function jr(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}function qr(t){return null!==t.collectionGroup}function $r(t){const e=pe(t);if(null===e.Ee){e.Ee=[];const t=new Set;for(const n of e.explicitOrderBy)e.Ee.push(n),t.add(n.field.canonicalString());const n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc",r=function(t){let e=new _n($e.comparator);return t.filters.forEach((t=>{t.getFlattenedFilters().forEach((t=>{t.isInequality()&&(e=e.add(t.field))}))})),e}(e);r.forEach((r=>{t.has(r.canonicalString())||r.isKeyField()||e.Ee.push(new mr(r,n))})),t.has($e.keyField().canonicalString())||e.Ee.push(new mr($e.keyField(),n))}return e.Ee}function zr(t){const e=pe(t);return e.de||(e.de=function(t,e){if("F"===t.limitType)return Mr(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map((t=>{const e="desc"===t.dir?"asc":"desc";return new mr(t.field,e)}));const n=t.endAt?new fr(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new fr(t.startAt.position,t.startAt.inclusive):null;return Mr(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}}(e,$r(t))),e.de}function Gr(t,e){const n=t.filters.concat([e]);return new Ur(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}function Hr(t,e,n){return new Ur(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Kr(t,e){return Vr(zr(t),zr(e))&&t.limitType===e.limitType}function Qr(t){return`${Pr(zr(t))}|lt:${t.limitType}`}function Wr(t){return`Query(target=${function(t){let e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=`, filters: [${t.filters.map((t=>Ir(t))).join(", ")}]`),Ze(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=`, orderBy: [${t.orderBy.map((t=>function(t){return`${t.field.canonicalString()} (${t.dir})`}(t))).join(", ")}]`),t.startAt&&(e+=", startAt: ",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((t=>Jn(t))).join(",")),t.endAt&&(e+=", endAt: ",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((t=>Jn(t))).join(",")),`Target(${e})`}(zr(t))}; limitType=${t.limitType})`}function Xr(t,e){return e.isFoundDocument()&&function(t,e){const n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):ze.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(const n of $r(t))if(!n.field.isKeyField()&&null===e.data.field(n.field))return!1;return!0}(t,e)&&function(t,e){for(const n of t.filters)if(!n.matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!function(t,e,n){const r=gr(t,e,n);return t.inclusive?r<=0:r<0}(t.startAt,$r(t),e)||t.endAt&&!function(t,e,n){const r=gr(t,e,n);return t.inclusive?r>=0:r>0}(t.endAt,$r(t),e))}(t,e)}function Yr(t){return(e,n)=>{let r=!1;for(const i of $r(t)){const t=Jr(i,e,n);if(0!==t)return t;r=r||i.field.isKeyField()}return 0}}function Jr(t,e,n){const r=t.field.isKeyField()?ze.comparator(e.key,n.key):function(t,e,n){const r=e.data.field(t),i=n.data.field(t);return null!==r&&null!==i?Wn(r,i):de(42886)}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return de(19790,{direction:t.dir})}}class Zr{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(const[e,r]of n)if(this.equalsFn(e,t))return r}has(t){return void 0!==this.get(t)}set(t,e){const n=this.mapKeyFn(t),r=this.inner[n];if(void 0===r)return this.inner[n]=[[t,e]],void this.innerSize++;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],t))return void(r[n]=[t,e]);r.push([t,e]),this.innerSize++}delete(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(t){yn(this.inner,((e,n)=>{for(const[e,r]of n)t(e,r)}))}isEmpty(){return vn(this.inner)}size(){return this.innerSize}}const ti=new wn(ze.comparator);function ei(){return ti}const ni=new wn(ze.comparator);function ri(...t){let e=ni;for(const n of t)e=e.insert(n.key,n);return e}function ii(t){let e=ni;return t.forEach(((t,n)=>e=e.insert(t,n.overlayedDocument))),e}function si(){return ai()}function oi(){return ai()}function ai(){return new Zr((t=>t.toString()),((t,e)=>t.isEqual(e)))}const ci=new wn(ze.comparator),ui=new _n(ze.comparator);function hi(...t){let e=ui;for(const n of t)e=e.add(n);return e}const li=new _n(ke);function di(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:tn(e)?"-0":e}}function fi(t){return{integerValue:""+t}}function gi(t,e){return function(t){return"number"==typeof t&&Number.isInteger(t)&&!tn(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}(e)?fi(e):di(t,e)}class pi{constructor(){this._=void 0}}function mi(t,e,n){return t instanceof wi?function(t,e){const n={fields:{[Rn]:{stringValue:xn},[On]:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&Mn(e)&&(e=Pn(e)),e&&(n.fields[Ln]=e),{mapValue:n}}(n,e):t instanceof Ei?bi(t,e):t instanceof _i?Ti(t,e):function(t,e){const n=vi(t,e),r=Ii(n)+Ii(t.Re);return nr(n)&&nr(t.Re)?fi(r):di(t.serializer,r)}(t,e)}function yi(t,e,n){return t instanceof Ei?bi(t,e):t instanceof _i?Ti(t,e):n}function vi(t,e){return t instanceof Ci?function(t){return nr(t)||function(t){return!!t&&"doubleValue"in t}(t)}(e)?e:{integerValue:0}:null}class wi extends pi{}class Ei extends pi{constructor(t){super(),this.elements=t}}function bi(t,e){const n=Si(e);for(const e of t.elements)n.some((t=>Kn(t,e)))||n.push(e);return{arrayValue:{values:n}}}class _i extends pi{constructor(t){super(),this.elements=t}}function Ti(t,e){let n=Si(e);for(const e of t.elements)n=n.filter((t=>!Kn(t,e)));return{arrayValue:{values:n}}}class Ci extends pi{constructor(t,e){super(),this.serializer=t,this.Re=e}}function Ii(t){return Nn(t.integerValue||t.doubleValue)}function Si(t){return rr(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class Ai{constructor(t,e){this.version=t,this.transformResults=e}}class Di{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new Di}static exists(t){return new Di(void 0,t)}static updateTime(t){return new Di(t)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function Ni(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}class ki{}function xi(t,e){if(!t.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return t.isNoDocument()?new ji(t.key,Di.none()):new Pi(t.key,t.data,Di.none());{const n=t.data,r=hr.empty();let i=new _n($e.comparator);for(let t of e.fields)if(!i.has(t)){let e=n.field(t);null===e&&t.length>1&&(t=t.popLast(),e=n.field(t)),null===e?r.delete(t):r.set(t,e),i=i.add(t)}return new Vi(t.key,r,new Cn(i.toArray()),Di.none())}}function Ri(t,e,n){t instanceof Pi?function(t,e,n){const r=t.value.clone(),i=Ui(t.fieldTransforms,e,n.transformResults);r.setAll(i),e.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(t,e,n):t instanceof Vi?function(t,e,n){if(!Ni(t.precondition,e))return void e.convertToUnknownDocument(n.version);const r=Ui(t.fieldTransforms,e,n.transformResults),i=e.data;i.setAll(Fi(t)),i.setAll(r),e.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function Li(t,e,n,r){return t instanceof Pi?function(t,e,n,r){if(!Ni(t.precondition,e))return n;const i=t.value.clone(),s=Bi(t.fieldTransforms,r,e);return i.setAll(s),e.convertToFoundDocument(e.version,i).setHasLocalMutations(),null}(t,e,n,r):t instanceof Vi?function(t,e,n,r){if(!Ni(t.precondition,e))return n;const i=Bi(t.fieldTransforms,r,e),s=e.data;return s.setAll(Fi(t)),s.setAll(i),e.convertToFoundDocument(e.version,s).setHasLocalMutations(),null===n?null:n.unionWith(t.fieldMask.fields).unionWith(t.fieldTransforms.map((t=>t.field)))}(t,e,n,r):function(t,e,n){return Ni(t.precondition,e)?(e.convertToNoDocument(e.version).setHasLocalMutations(),null):n}(t,e,n)}function Oi(t,e){let n=null;for(const r of t.fieldTransforms){const t=e.data.field(r.field),i=vi(r.transform,t||null);null!=i&&(null===n&&(n=hr.empty()),n.set(r.field,i))}return n||null}function Mi(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&Oe(t,e,((t,e)=>function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof Ei&&e instanceof Ei||t instanceof _i&&e instanceof _i?Oe(t.elements,e.elements,Kn):t instanceof Ci&&e instanceof Ci?Kn(t.Re,e.Re):t instanceof wi&&e instanceof wi}(t.transform,e.transform)}(t,e)))}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class Pi extends ki{constructor(t,e,n,r=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class Vi extends ki{constructor(t,e,n,r,i=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function Fi(t){const e=new Map;return t.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}})),e}function Ui(t,e,n){const r=new Map;ge(t.length===n.length,32656,{Ve:n.length,me:t.length});for(let i=0;i<n.length;i++){const s=t[i],o=s.transform,a=e.data.field(s.field);r.set(s.field,yi(o,a,n[i]))}return r}function Bi(t,e,n){const r=new Map;for(const i of t){const t=i.transform,s=n.data.field(i.field);r.set(i.field,mi(t,s,e))}return r}class ji extends ki{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class qi extends ki{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class $i{constructor(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(t,e){const n=e.mutationResults;for(let e=0;e<this.mutations.length;e++){const r=this.mutations[e];r.key.isEqual(t.key)&&Ri(r,t,n[e])}}applyToLocalView(t,e){for(const n of this.baseMutations)n.key.isEqual(t.key)&&(e=Li(n,t,e,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(t.key)&&(e=Li(n,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){const n=oi();return this.mutations.forEach((r=>{const i=t.get(r.key),s=i.overlayedDocument;let o=this.applyToLocalView(s,i.mutatedFields);o=e.has(r.key)?null:o;const a=xi(s,o);null!==a&&n.set(r.key,a),s.isValidDocument()||s.convertToNoDocument(Fe.min())})),n}keys(){return this.mutations.reduce(((t,e)=>t.add(e.key)),hi())}isEqual(t){return this.batchId===t.batchId&&Oe(this.mutations,t.mutations,((t,e)=>Mi(t,e)))&&Oe(this.baseMutations,t.baseMutations,((t,e)=>Mi(t,e)))}}class zi{constructor(t,e,n,r){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=r}static from(t,e,n){ge(t.mutations.length===n.length,58842,{fe:t.mutations.length,ge:n.length});let r=ci;const i=t.mutations;for(let t=0;t<i.length;t++)r=r.insert(i[t].key,n[t].version);return new zi(t,e,n,r)}}class Gi{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return null!==t&&this.mutation===t.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Hi{constructor(t,e){this.count=t,this.unchangedNames=e}}var Ki,Qi;function Wi(t){if(void 0===t)return ue("GRPC error has no .code"),me.UNKNOWN;switch(t){case Ki.OK:return me.OK;case Ki.CANCELLED:return me.CANCELLED;case Ki.UNKNOWN:return me.UNKNOWN;case Ki.DEADLINE_EXCEEDED:return me.DEADLINE_EXCEEDED;case Ki.RESOURCE_EXHAUSTED:return me.RESOURCE_EXHAUSTED;case Ki.INTERNAL:return me.INTERNAL;case Ki.UNAVAILABLE:return me.UNAVAILABLE;case Ki.UNAUTHENTICATED:return me.UNAUTHENTICATED;case Ki.INVALID_ARGUMENT:return me.INVALID_ARGUMENT;case Ki.NOT_FOUND:return me.NOT_FOUND;case Ki.ALREADY_EXISTS:return me.ALREADY_EXISTS;case Ki.PERMISSION_DENIED:return me.PERMISSION_DENIED;case Ki.FAILED_PRECONDITION:return me.FAILED_PRECONDITION;case Ki.ABORTED:return me.ABORTED;case Ki.OUT_OF_RANGE:return me.OUT_OF_RANGE;case Ki.UNIMPLEMENTED:return me.UNIMPLEMENTED;case Ki.DATA_LOSS:return me.DATA_LOSS;default:return de(39323,{code:t})}}(Qi=Ki||(Ki={}))[Qi.OK=0]="OK",Qi[Qi.CANCELLED=1]="CANCELLED",Qi[Qi.UNKNOWN=2]="UNKNOWN",Qi[Qi.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Qi[Qi.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Qi[Qi.NOT_FOUND=5]="NOT_FOUND",Qi[Qi.ALREADY_EXISTS=6]="ALREADY_EXISTS",Qi[Qi.PERMISSION_DENIED=7]="PERMISSION_DENIED",Qi[Qi.UNAUTHENTICATED=16]="UNAUTHENTICATED",Qi[Qi.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Qi[Qi.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Qi[Qi.ABORTED=10]="ABORTED",Qi[Qi.OUT_OF_RANGE=11]="OUT_OF_RANGE",Qi[Qi.UNIMPLEMENTED=12]="UNIMPLEMENTED",Qi[Qi.INTERNAL=13]="INTERNAL",Qi[Qi.UNAVAILABLE=14]="UNAVAILABLE",Qi[Qi.DATA_LOSS=15]="DATA_LOSS";const Xi=new qt([4294967295,4294967295],0);function Yi(t){const e=De().encode(t),n=new $t;return n.update(e),new Uint8Array(n.digest())}function Ji(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new qt([n,r],0),new qt([i,s],0)]}class Zi{constructor(t,e,n){if(this.bitmap=t,this.padding=e,this.hashCount=n,e<0||e>=8)throw new ts(`Invalid padding: ${e}`);if(n<0)throw new ts(`Invalid hash count: ${n}`);if(t.length>0&&0===this.hashCount)throw new ts(`Invalid hash count: ${n}`);if(0===t.length&&0!==e)throw new ts(`Invalid padding when bitmap length is 0: ${e}`);this.pe=8*t.length-e,this.ye=qt.fromNumber(this.pe)}we(t,e,n){let r=t.add(e.multiply(qt.fromNumber(n)));return 1===r.compare(Xi)&&(r=new qt([r.getBits(0),r.getBits(1)],0)),r.modulo(this.ye).toNumber()}Se(t){return!!(this.bitmap[Math.floor(t/8)]&1<<t%8)}mightContain(t){if(0===this.pe)return!1;const e=Yi(t),[n,r]=Ji(e);for(let t=0;t<this.hashCount;t++){const e=this.we(n,r,t);if(!this.Se(e))return!1}return!0}static create(t,e,n){const r=t%8==0?0:8-t%8,i=new Uint8Array(Math.ceil(t/8)),s=new Zi(i,r,e);return n.forEach((t=>s.insert(t))),s}insert(t){if(0===this.pe)return;const e=Yi(t),[n,r]=Ji(e);for(let t=0;t<this.hashCount;t++){const e=this.we(n,r,t);this.be(e)}}be(t){const e=Math.floor(t/8),n=t%8;this.bitmap[e]|=1<<n}}class ts extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class es{constructor(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(t,e,n){const r=new Map;return r.set(t,ns.createSynthesizedTargetChangeForCurrentChange(t,e,n)),new es(Fe.min(),r,new wn(ke),ei(),hi())}}class ns{constructor(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(t,e,n){return new ns(n,e,hi(),hi(),hi())}}class rs{constructor(t,e,n,r){this.De=t,this.removedTargetIds=e,this.key=n,this.ve=r}}class is{constructor(t,e){this.targetId=t,this.Ce=e}}class ss{constructor(t,e,n=Sn.EMPTY_BYTE_STRING,r=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r}}class os{constructor(){this.Fe=0,this.Me=us(),this.xe=Sn.EMPTY_BYTE_STRING,this.Oe=!1,this.Ne=!0}get current(){return this.Oe}get resumeToken(){return this.xe}get Be(){return 0!==this.Fe}get Le(){return this.Ne}ke(t){t.approximateByteSize()>0&&(this.Ne=!0,this.xe=t)}qe(){let t=hi(),e=hi(),n=hi();return this.Me.forEach(((r,i)=>{switch(i){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:de(38017,{changeType:i})}})),new ns(this.xe,this.Oe,t,e,n)}Qe(){this.Ne=!1,this.Me=us()}$e(t,e){this.Ne=!0,this.Me=this.Me.insert(t,e)}Ue(t){this.Ne=!0,this.Me=this.Me.remove(t)}Ke(){this.Fe+=1}We(){this.Fe-=1,ge(this.Fe>=0,3241,{Fe:this.Fe})}Ge(){this.Ne=!0,this.Oe=!0}}class as{constructor(t){this.ze=t,this.je=new Map,this.He=ei(),this.Je=cs(),this.Ye=cs(),this.Ze=new wn(ke)}Xe(t){for(const e of t.De)t.ve&&t.ve.isFoundDocument()?this.et(e,t.ve):this.tt(e,t.key,t.ve);for(const e of t.removedTargetIds)this.tt(e,t.key,t.ve)}nt(t){this.forEachTarget(t,(e=>{const n=this.rt(e);switch(t.state){case 0:this.it(e)&&n.ke(t.resumeToken);break;case 1:n.We(),n.Be||n.Qe(),n.ke(t.resumeToken);break;case 2:n.We(),n.Be||this.removeTarget(e);break;case 3:this.it(e)&&(n.Ge(),n.ke(t.resumeToken));break;case 4:this.it(e)&&(this.st(e),n.ke(t.resumeToken));break;default:de(56790,{state:t.state})}}))}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.je.forEach(((t,n)=>{this.it(n)&&e(n)}))}ot(t){const e=t.targetId,n=t.Ce.count,r=this._t(e);if(r){const i=r.target;if(Fr(i))if(0===n){const t=new ze(i.path);this.tt(e,t,dr.newNoDocument(t,Fe.min()))}else ge(1===n,20013,{expectedCount:n});else{const r=this.ut(e);if(r!==n){const n=this.ct(t),i=n?this.lt(n,t,r):1;if(0!==i){this.st(e);const t=2===i?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ze=this.Ze.insert(e,t)}}}}}ct(t){const e=t.Ce.unchangedNames;if(!e||!e.bits)return null;const{bits:{bitmap:n="",padding:r=0},hashCount:i=0}=e;let s,o;try{s=kn(n).toUint8Array()}catch(t){if(t instanceof In)return he("Decoding the base64 bloom filter in existence filter failed ("+t.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw t}try{o=new Zi(s,r,i)}catch(t){return he(t instanceof ts?"BloomFilter error: ":"Applying bloom filter failed: ",t),null}return 0===o.pe?null:o}lt(t,e,n){return e.Ce.count===n-this.Tt(t,e.targetId)?0:2}Tt(t,e){const n=this.ze.getRemoteKeysForTarget(e);let r=0;return n.forEach((n=>{const i=this.ze.Pt(),s=`projects/${i.projectId}/databases/${i.database}/documents/${n.path.canonicalString()}`;t.mightContain(s)||(this.tt(e,n,null),r++)})),r}It(t){const e=new Map;this.je.forEach(((n,r)=>{const i=this._t(r);if(i){if(n.current&&Fr(i.target)){const e=new ze(i.target.path);this.Et(e).has(r)||this.dt(r,e)||this.tt(r,e,dr.newNoDocument(e,t))}n.Le&&(e.set(r,n.qe()),n.Qe())}}));let n=hi();this.Ye.forEach(((t,e)=>{let r=!0;e.forEachWhile((t=>{const e=this._t(t);return!e||"TargetPurposeLimboResolution"===e.purpose||(r=!1,!1)})),r&&(n=n.add(t))})),this.He.forEach(((e,n)=>n.setReadTime(t)));const r=new es(t,e,this.Ze,this.He,n);return this.He=ei(),this.Je=cs(),this.Ye=cs(),this.Ze=new wn(ke),r}et(t,e){if(!this.it(t))return;const n=this.dt(t,e.key)?2:0;this.rt(t).$e(e.key,n),this.He=this.He.insert(e.key,e),this.Je=this.Je.insert(e.key,this.Et(e.key).add(t)),this.Ye=this.Ye.insert(e.key,this.At(e.key).add(t))}tt(t,e,n){if(!this.it(t))return;const r=this.rt(t);this.dt(t,e)?r.$e(e,1):r.Ue(e),this.Ye=this.Ye.insert(e,this.At(e).delete(t)),this.Ye=this.Ye.insert(e,this.At(e).add(t)),n&&(this.He=this.He.insert(e,n))}removeTarget(t){this.je.delete(t)}ut(t){const e=this.rt(t).qe();return this.ze.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}Ke(t){this.rt(t).Ke()}rt(t){let e=this.je.get(t);return e||(e=new os,this.je.set(t,e)),e}At(t){let e=this.Ye.get(t);return e||(e=new _n(ke),this.Ye=this.Ye.insert(t,e)),e}Et(t){let e=this.Je.get(t);return e||(e=new _n(ke),this.Je=this.Je.insert(t,e)),e}it(t){const e=null!==this._t(t);return e||ce("WatchChangeAggregator","Detected inactive target",t),e}_t(t){const e=this.je.get(t);return e&&e.Be?null:this.ze.Rt(t)}st(t){this.je.set(t,new os),this.ze.getRemoteKeysForTarget(t).forEach((e=>{this.tt(t,e,null)}))}dt(t,e){return this.ze.getRemoteKeysForTarget(t).has(e)}}function cs(){return new wn(ze.comparator)}function us(){return new wn(ze.comparator)}const hs={asc:"ASCENDING",desc:"DESCENDING"},ls={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},ds={and:"AND",or:"OR"};class fs{constructor(t,e){this.databaseId=t,this.useProto3Json=e}}function gs(t,e){return t.useProto3Json||Ze(e)?e:{value:e}}function ps(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function ms(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function ys(t,e){return ps(t,e.toTimestamp())}function vs(t){return ge(!!t,49232),Fe.fromTimestamp(function(t){const e=Dn(t);return new Ve(e.seconds,e.nanos)}(t))}function ws(t,e){return Es(t,e).canonicalString()}function Es(t,e){const n=function(t){return new je(["projects",t.projectId,"databases",t.database])}(t).child("documents");return void 0===e?n:n.child(e)}function bs(t){const e=je.fromString(t);return ge(Us(e),10190,{key:e.toString()}),e}function _s(t,e){return ws(t.databaseId,e.path)}function Ts(t,e){const n=bs(e);if(n.get(1)!==t.databaseId.projectId)throw new ye(me.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new ye(me.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new ze(Ss(n))}function Cs(t,e){return ws(t.databaseId,e)}function Is(t){return new je(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function Ss(t){return ge(t.length>4&&"documents"===t.get(4),29091,{key:t.toString()}),t.popFirst(5)}function As(t,e,n){return{name:_s(t,e),fields:n.value.mapValue.fields}}function Ds(t,e){return{documents:[Cs(t,e.path)]}}function Ns(t,e){const n={structuredQuery:{}},r=e.path;let i;null!==e.collectionGroup?(i=r,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=Cs(t,i);const s=function(t){if(0!==t.length)return Vs(Er.create(t,"and"))}(e.filters);s&&(n.structuredQuery.where=s);const o=function(t){if(0!==t.length)return t.map((t=>function(t){return{field:Ms(t.field),direction:Rs(t.dir)}}(t)))}(e.orderBy);o&&(n.structuredQuery.orderBy=o);const a=gs(t,e.limit);return null!==a&&(n.structuredQuery.limit=a),e.startAt&&(n.structuredQuery.startAt=function(t){return{before:t.inclusive,values:t.position}}(e.startAt)),e.endAt&&(n.structuredQuery.endAt=function(t){return{before:!t.inclusive,values:t.position}}(e.endAt)),{gt:n,parent:i}}function ks(t){let e=function(t){const e=bs(t);return 4===e.length?je.emptyPath():Ss(e)}(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){ge(1===r,65062);const t=n.from[0];t.allDescendants?i=t.collectionId:e=e.child(t.collectionId)}let s=[];n.where&&(s=function(t){const e=xs(t);return e instanceof Er&&_r(e)?e.getFilters():[e]}(n.where));let o=[];n.orderBy&&(o=function(t){return t.map((t=>function(t){return new mr(Ps(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t)))}(n.orderBy));let a=null;n.limit&&(a=function(t){let e;return e="object"==typeof t?t.value:t,Ze(e)?null:e}(n.limit));let c=null;n.startAt&&(c=function(t){const e=!!t.before,n=t.values||[];return new fr(n,e)}(n.startAt));let u=null;return n.endAt&&(u=function(t){const e=!t.before,n=t.values||[];return new fr(n,e)}(n.endAt)),function(t,e,n,r,i,s,o,a){return new Ur(t,e,n,r,i,s,o,a)}(e,i,o,s,a,"F",c,u)}function xs(t){return void 0!==t.unaryFilter?function(t){switch(t.unaryFilter.op){case"IS_NAN":const e=Ps(t.unaryFilter.field);return wr.create(e,"==",{doubleValue:NaN});case"IS_NULL":const n=Ps(t.unaryFilter.field);return wr.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=Ps(t.unaryFilter.field);return wr.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=Ps(t.unaryFilter.field);return wr.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return de(61313);default:return de(60726)}}(t):void 0!==t.fieldFilter?function(t){return wr.create(Ps(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return de(58110);default:return de(50506)}}(t.fieldFilter.op),t.fieldFilter.value)}(t):void 0!==t.compositeFilter?function(t){return Er.create(t.compositeFilter.filters.map((t=>xs(t))),function(t){switch(t){case"AND":return"and";case"OR":return"or";default:return de(1026)}}(t.compositeFilter.op))}(t):de(30097,{filter:t})}function Rs(t){return hs[t]}function Ls(t){return ls[t]}function Os(t){return ds[t]}function Ms(t){return{fieldPath:t.canonicalString()}}function Ps(t){return $e.fromServerFormat(t.fieldPath)}function Vs(t){return t instanceof wr?function(t){if("=="===t.op){if(sr(t.value))return{unaryFilter:{field:Ms(t.field),op:"IS_NAN"}};if(ir(t.value))return{unaryFilter:{field:Ms(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(sr(t.value))return{unaryFilter:{field:Ms(t.field),op:"IS_NOT_NAN"}};if(ir(t.value))return{unaryFilter:{field:Ms(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ms(t.field),op:Ls(t.op),value:t.value}}}(t):t instanceof Er?function(t){const e=t.getFilters().map((t=>Vs(t)));return 1===e.length?e[0]:{compositeFilter:{op:Os(t.op),filters:e}}}(t):de(54877,{filter:t})}function Fs(t){const e=[];return t.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function Us(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}class Bs{constructor(t,e,n,r,i=Fe.min(),s=Fe.min(),o=Sn.EMPTY_BYTE_STRING,a=null){this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(t){return new Bs(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new Bs(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new Bs(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new Bs(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}class js{constructor(t){this.wt=t}}function qs(t){const e=ks({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?Hr(e,e.limit,"L"):e}class $s{constructor(){}vt(t,e){this.Ct(t,e),e.Ft()}Ct(t,e){if("nullValue"in t)this.Mt(e,5);else if("booleanValue"in t)this.Mt(e,10),e.xt(t.booleanValue?1:0);else if("integerValue"in t)this.Mt(e,15),e.xt(Nn(t.integerValue));else if("doubleValue"in t){const n=Nn(t.doubleValue);isNaN(n)?this.Mt(e,13):(this.Mt(e,15),tn(n)?e.xt(0):e.xt(n))}else if("timestampValue"in t){let n=t.timestampValue;this.Mt(e,20),"string"==typeof n&&(n=Dn(n)),e.Ot(`${n.seconds||""}`),e.xt(n.nanos||0)}else if("stringValue"in t)this.Nt(t.stringValue,e),this.Bt(e);else if("bytesValue"in t)this.Mt(e,30),e.Lt(kn(t.bytesValue)),this.Bt(e);else if("referenceValue"in t)this.kt(t.referenceValue,e);else if("geoPointValue"in t){const n=t.geoPointValue;this.Mt(e,45),e.xt(n.latitude||0),e.xt(n.longitude||0)}else"mapValue"in t?ur(t)?this.Mt(e,Number.MAX_SAFE_INTEGER):ar(t)?this.qt(t.mapValue,e):(this.Qt(t.mapValue,e),this.Bt(e)):"arrayValue"in t?(this.$t(t.arrayValue,e),this.Bt(e)):de(19022,{Ut:t})}Nt(t,e){this.Mt(e,25),this.Kt(t,e)}Kt(t,e){e.Ot(t)}Qt(t,e){const n=t.fields||{};this.Mt(e,55);for(const t of Object.keys(n))this.Nt(t,e),this.Ct(n[t],e)}qt(t,e){var n,r;const i=t.fields||{};this.Mt(e,53);const s=Gn,o=(null===(r=null===(n=i[s].arrayValue)||void 0===n?void 0:n.values)||void 0===r?void 0:r.length)||0;this.Mt(e,15),e.xt(Nn(o)),this.Nt(s,e),this.Ct(i[s],e)}$t(t,e){const n=t.values||[];this.Mt(e,50);for(const t of n)this.Ct(t,e)}kt(t,e){this.Mt(e,37),ze.fromName(t).path.forEach((t=>{this.Mt(e,60),this.Kt(t,e)}))}Mt(t,e){t.xt(e)}Bt(t){t.xt(2)}}$s.Wt=new $s;class zs{constructor(){this.Cn=new Gs}addToCollectionParentIndex(t,e){return this.Cn.add(e),Xe.resolve()}getCollectionParents(t,e){return Xe.resolve(this.Cn.getEntries(e))}addFieldIndex(t,e){return Xe.resolve()}deleteFieldIndex(t,e){return Xe.resolve()}deleteAllFieldIndexes(t){return Xe.resolve()}createTargetIndexes(t,e){return Xe.resolve()}getDocumentsMatchingTarget(t,e){return Xe.resolve(null)}getIndexType(t,e){return Xe.resolve(0)}getFieldIndexes(t,e){return Xe.resolve([])}getNextCollectionGroupToUpdate(t){return Xe.resolve(null)}getMinOffset(t,e){return Xe.resolve(He.min())}getMinOffsetFromCollectionGroup(t,e){return Xe.resolve(He.min())}updateCollectionGroup(t,e,n){return Xe.resolve()}updateIndexEntries(t,e){return Xe.resolve()}}class Gs{constructor(){this.index={}}add(t){const e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new _n(je.comparator),i=!r.has(n);return this.index[e]=r.add(n),i}has(t){const e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)}getEntries(t){return(this.index[t]||new _n(je.comparator)).toArray()}}new Uint8Array(0);const Hs={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Ks=41943040;class Qs{static withCacheSize(t){return new Qs(t,Qs.DEFAULT_COLLECTION_PERCENTILE,Qs.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}}Qs.DEFAULT_COLLECTION_PERCENTILE=10,Qs.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Qs.DEFAULT=new Qs(Ks,Qs.DEFAULT_COLLECTION_PERCENTILE,Qs.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Qs.DISABLED=new Qs(-1,0,0);class Ws{constructor(t){this.ur=t}next(){return this.ur+=2,this.ur}static cr(){return new Ws(0)}static lr(){return new Ws(-1)}}const Xs="LruGarbageCollector";function Ys([t,e],[n,r]){const i=ke(t,n);return 0===i?ke(e,r):i}class Js{constructor(t){this.Er=t,this.buffer=new _n(Ys),this.dr=0}Ar(){return++this.dr}Rr(t){const e=[t,this.Ar()];if(this.buffer.size<this.Er)this.buffer=this.buffer.add(e);else{const t=this.buffer.last();Ys(e,t)<0&&(this.buffer=this.buffer.delete(t).add(e))}}get maxValue(){return this.buffer.last()[0]}}class Zs{constructor(t,e,n){this.garbageCollector=t,this.asyncQueue=e,this.localStore=n,this.Vr=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.mr(6e4)}stop(){this.Vr&&(this.Vr.cancel(),this.Vr=null)}get started(){return null!==this.Vr}mr(t){ce(Xs,`Garbage collection scheduled in ${t}ms`),this.Vr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,(async()=>{this.Vr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){Ye(t)?ce(Xs,"Ignoring IndexedDB error during garbage collection: ",t):await We(t)}await this.mr(3e5)}))}}class to{constructor(t,e){this.gr=t,this.params=e}calculateTargetCount(t,e){return this.gr.pr(t).next((t=>Math.floor(e/100*t)))}nthSequenceNumber(t,e){if(0===e)return Xe.resolve(Je.le);const n=new Js(e);return this.gr.forEachTarget(t,(t=>n.Rr(t.sequenceNumber))).next((()=>this.gr.yr(t,(t=>n.Rr(t))))).next((()=>n.maxValue))}removeTargets(t,e,n){return this.gr.removeTargets(t,e,n)}removeOrphanedDocuments(t,e){return this.gr.removeOrphanedDocuments(t,e)}collect(t,e){return-1===this.params.cacheSizeCollectionThreshold?(ce("LruGarbageCollector","Garbage collection skipped; disabled"),Xe.resolve(Hs)):this.getCacheSize(t).next((n=>n<this.params.cacheSizeCollectionThreshold?(ce("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Hs):this.wr(t,e)))}getCacheSize(t){return this.gr.getCacheSize(t)}wr(t,e){let n,r,i,s,o,a,c;const u=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next((e=>(e>this.params.maximumSequenceNumbersToCollect?(ce("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${e}`),r=this.params.maximumSequenceNumbersToCollect):r=e,s=Date.now(),this.nthSequenceNumber(t,r)))).next((r=>(n=r,o=Date.now(),this.removeTargets(t,n,e)))).next((e=>(i=e,a=Date.now(),this.removeOrphanedDocuments(t,n)))).next((t=>(c=Date.now(),ae()<=C.DEBUG&&ce("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${s-u}ms\n\tDetermined least recently used ${r} in `+(o-s)+"ms\n"+`\tRemoved ${i} targets in `+(a-o)+"ms\n"+`\tRemoved ${t} documents in `+(c-a)+"ms\n"+`Total Duration: ${c-u}ms`),Xe.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:t}))))}}class eo{constructor(){this.changes=new Zr((t=>t.toString()),((t,e)=>t.isEqual(e))),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,dr.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();const n=this.changes.get(e);return void 0!==n?Xe.resolve(n):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}class no{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}}class ro{constructor(t,e,n,r){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=n,this.indexManager=r}getDocument(t,e){let n=null;return this.documentOverlayCache.getOverlay(t,e).next((r=>(n=r,this.remoteDocumentCache.getEntry(t,e)))).next((t=>(null!==n&&Li(n.mutation,t,Cn.empty(),Ve.now()),t)))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.getLocalViewOfDocuments(t,e,hi()).next((()=>e))))}getLocalViewOfDocuments(t,e,n=hi()){const r=si();return this.populateOverlays(t,r,e).next((()=>this.computeViews(t,e,r,n).next((t=>{let e=ri();return t.forEach(((t,n)=>{e=e.insert(t,n.overlayedDocument)})),e}))))}getOverlayedDocuments(t,e){const n=si();return this.populateOverlays(t,n,e).next((()=>this.computeViews(t,e,n,hi())))}populateOverlays(t,e,n){const r=[];return n.forEach((t=>{e.has(t)||r.push(t)})),this.documentOverlayCache.getOverlays(t,r).next((t=>{t.forEach(((t,n)=>{e.set(t,n)}))}))}computeViews(t,e,n,r){let i=ei();const s=ai(),o=ai();return e.forEach(((t,e)=>{const o=n.get(e.key);r.has(e.key)&&(void 0===o||o.mutation instanceof Vi)?i=i.insert(e.key,e):void 0!==o?(s.set(e.key,o.mutation.getFieldMask()),Li(o.mutation,e,o.mutation.getFieldMask(),Ve.now())):s.set(e.key,Cn.empty())})),this.recalculateAndSaveOverlays(t,i).next((t=>(t.forEach(((t,e)=>s.set(t,e))),e.forEach(((t,e)=>{var n;return o.set(t,new no(e,null!==(n=s.get(t))&&void 0!==n?n:null))})),o)))}recalculateAndSaveOverlays(t,e){const n=ai();let r=new wn(((t,e)=>t-e)),i=hi();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next((t=>{for(const i of t)i.keys().forEach((t=>{const s=e.get(t);if(null===s)return;let o=n.get(t)||Cn.empty();o=i.applyToLocalView(s,o),n.set(t,o);const a=(r.get(i.batchId)||hi()).add(t);r=r.insert(i.batchId,a)}))})).next((()=>{const s=[],o=r.getReverseIterator();for(;o.hasNext();){const r=o.getNext(),a=r.key,c=r.value,u=oi();c.forEach((t=>{if(!i.has(t)){const r=xi(e.get(t),n.get(t));null!==r&&u.set(t,r),i=i.add(t)}})),s.push(this.documentOverlayCache.saveOverlays(t,a,u))}return Xe.waitFor(s)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.recalculateAndSaveOverlays(t,e)))}getDocumentsMatchingQuery(t,e,n,r){return function(t){return ze.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):qr(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,n,r):this.getDocumentsMatchingCollectionQuery(t,e,n,r)}getNextDocuments(t,e,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,n,r).next((i=>{const s=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,n.largestBatchId,r-i.size):Xe.resolve(si());let o=-1,a=i;return s.next((e=>Xe.forEach(e,((e,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),i.get(e)?Xe.resolve():this.remoteDocumentCache.getEntry(t,e).next((t=>{a=a.insert(e,t)}))))).next((()=>this.populateOverlays(t,e,i))).next((()=>this.computeViews(t,a,e,hi()))).next((t=>({batchId:o,changes:ii(t)})))))}))}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new ze(e)).next((t=>{let e=ri();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e}))}getDocumentsMatchingCollectionGroupQuery(t,e,n,r){const i=e.collectionGroup;let s=ri();return this.indexManager.getCollectionParents(t,i).next((o=>Xe.forEach(o,(o=>{const a=function(t,e){return new Ur(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,o.child(i));return this.getDocumentsMatchingCollectionQuery(t,a,n,r).next((t=>{t.forEach(((t,e)=>{s=s.insert(t,e)}))}))})).next((()=>s))))}getDocumentsMatchingCollectionQuery(t,e,n,r){let i;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,n.largestBatchId).next((s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,n,i,r)))).next((t=>{i.forEach(((e,n)=>{const r=n.getKey();null===t.get(r)&&(t=t.insert(r,dr.newInvalidDocument(r)))}));let n=ri();return t.forEach(((t,r)=>{const s=i.get(t);void 0!==s&&Li(s.mutation,r,Cn.empty(),Ve.now()),Xr(e,r)&&(n=n.insert(t,r))})),n}))}}class io{constructor(t){this.serializer=t,this.kr=new Map,this.qr=new Map}getBundleMetadata(t,e){return Xe.resolve(this.kr.get(e))}saveBundleMetadata(t,e){return this.kr.set(e.id,function(t){return{id:t.id,version:t.version,createTime:vs(t.createTime)}}(e)),Xe.resolve()}getNamedQuery(t,e){return Xe.resolve(this.qr.get(e))}saveNamedQuery(t,e){return this.qr.set(e.name,function(t){return{name:t.name,query:qs(t.bundledQuery),readTime:vs(t.readTime)}}(e)),Xe.resolve()}}class so{constructor(){this.overlays=new wn(ze.comparator),this.Qr=new Map}getOverlay(t,e){return Xe.resolve(this.overlays.get(e))}getOverlays(t,e){const n=si();return Xe.forEach(e,(e=>this.getOverlay(t,e).next((t=>{null!==t&&n.set(e,t)})))).next((()=>n))}saveOverlays(t,e,n){return n.forEach(((n,r)=>{this.bt(t,e,r)})),Xe.resolve()}removeOverlaysForBatchId(t,e,n){const r=this.Qr.get(n);return void 0!==r&&(r.forEach((t=>this.overlays=this.overlays.remove(t))),this.Qr.delete(n)),Xe.resolve()}getOverlaysForCollection(t,e,n){const r=si(),i=e.length+1,s=new ze(e.child("")),o=this.overlays.getIteratorFrom(s);for(;o.hasNext();){const t=o.getNext().value,s=t.getKey();if(!e.isPrefixOf(s.path))break;s.path.length===i&&t.largestBatchId>n&&r.set(t.getKey(),t)}return Xe.resolve(r)}getOverlaysForCollectionGroup(t,e,n,r){let i=new wn(((t,e)=>t-e));const s=this.overlays.getIterator();for(;s.hasNext();){const t=s.getNext().value;if(t.getKey().getCollectionGroup()===e&&t.largestBatchId>n){let e=i.get(t.largestBatchId);null===e&&(e=si(),i=i.insert(t.largestBatchId,e)),e.set(t.getKey(),t)}}const o=si(),a=i.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach(((t,e)=>o.set(t,e))),!(o.size()>=r)););return Xe.resolve(o)}bt(t,e,n){const r=this.overlays.get(n.key);if(null!==r){const t=this.Qr.get(r.largestBatchId).delete(n.key);this.Qr.set(r.largestBatchId,t)}this.overlays=this.overlays.insert(n.key,new Gi(e,n));let i=this.Qr.get(e);void 0===i&&(i=hi(),this.Qr.set(e,i)),this.Qr.set(e,i.add(n.key))}}class oo{constructor(){this.sessionToken=Sn.EMPTY_BYTE_STRING}getSessionToken(t){return Xe.resolve(this.sessionToken)}setSessionToken(t,e){return this.sessionToken=e,Xe.resolve()}}class ao{constructor(){this.$r=new _n(co.Ur),this.Kr=new _n(co.Wr)}isEmpty(){return this.$r.isEmpty()}addReference(t,e){const n=new co(t,e);this.$r=this.$r.add(n),this.Kr=this.Kr.add(n)}Gr(t,e){t.forEach((t=>this.addReference(t,e)))}removeReference(t,e){this.zr(new co(t,e))}jr(t,e){t.forEach((t=>this.removeReference(t,e)))}Hr(t){const e=new ze(new je([])),n=new co(e,t),r=new co(e,t+1),i=[];return this.Kr.forEachInRange([n,r],(t=>{this.zr(t),i.push(t.key)})),i}Jr(){this.$r.forEach((t=>this.zr(t)))}zr(t){this.$r=this.$r.delete(t),this.Kr=this.Kr.delete(t)}Yr(t){const e=new ze(new je([])),n=new co(e,t),r=new co(e,t+1);let i=hi();return this.Kr.forEachInRange([n,r],(t=>{i=i.add(t.key)})),i}containsKey(t){const e=new co(t,0),n=this.$r.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)}}class co{constructor(t,e){this.key=t,this.Zr=e}static Ur(t,e){return ze.comparator(t.key,e.key)||ke(t.Zr,e.Zr)}static Wr(t,e){return ke(t.Zr,e.Zr)||ze.comparator(t.key,e.key)}}class uo{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.nr=1,this.Xr=new _n(co.Ur)}checkEmpty(t){return Xe.resolve(0===this.mutationQueue.length)}addMutationBatch(t,e,n,r){const i=this.nr;this.nr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const s=new $i(i,e,n,r);this.mutationQueue.push(s);for(const e of r)this.Xr=this.Xr.add(new co(e.key,i)),this.indexManager.addToCollectionParentIndex(t,e.key.path.popLast());return Xe.resolve(s)}lookupMutationBatch(t,e){return Xe.resolve(this.ei(e))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,r=this.ti(n),i=r<0?0:r;return Xe.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return Xe.resolve(0===this.mutationQueue.length?-1:this.nr-1)}getAllMutationBatches(t){return Xe.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const n=new co(e,0),r=new co(e,Number.POSITIVE_INFINITY),i=[];return this.Xr.forEachInRange([n,r],(t=>{const e=this.ei(t.Zr);i.push(e)})),Xe.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new _n(ke);return e.forEach((t=>{const e=new co(t,0),r=new co(t,Number.POSITIVE_INFINITY);this.Xr.forEachInRange([e,r],(t=>{n=n.add(t.Zr)}))})),Xe.resolve(this.ni(n))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,r=n.length+1;let i=n;ze.isDocumentKey(i)||(i=i.child(""));const s=new co(new ze(i),0);let o=new _n(ke);return this.Xr.forEachWhile((t=>{const e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(o=o.add(t.Zr)),!0)}),s),Xe.resolve(this.ni(o))}ni(t){const e=[];return t.forEach((t=>{const n=this.ei(t);null!==n&&e.push(n)})),e}removeMutationBatch(t,e){ge(0===this.ri(e.batchId,"removed"),55003),this.mutationQueue.shift();let n=this.Xr;return Xe.forEach(e.mutations,(r=>{const i=new co(r.key,e.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(t,r.key)})).next((()=>{this.Xr=n}))}sr(t){}containsKey(t,e){const n=new co(e,0),r=this.Xr.firstAfterOrEqual(n);return Xe.resolve(e.isEqual(r&&r.key))}performConsistencyCheck(t){return this.mutationQueue.length,Xe.resolve()}ri(t,e){return this.ti(t)}ti(t){return 0===this.mutationQueue.length?0:t-this.mutationQueue[0].batchId}ei(t){const e=this.ti(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}}class ho{constructor(t){this.ii=t,this.docs=new wn(ze.comparator),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){const n=e.key,r=this.docs.get(n),i=r?r.size:0,s=this.ii(e);return this.docs=this.docs.insert(n,{document:e.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(t,n.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const n=this.docs.get(e);return Xe.resolve(n?n.document.mutableCopy():dr.newInvalidDocument(e))}getEntries(t,e){let n=ei();return e.forEach((t=>{const e=this.docs.get(t);n=n.insert(t,e?e.document.mutableCopy():dr.newInvalidDocument(t))})),Xe.resolve(n)}getDocumentsMatchingQuery(t,e,n,r){let i=ei();const s=e.path,o=new ze(s.child("__id-9223372036854775808__")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:t,value:{document:o}}=a.getNext();if(!s.isPrefixOf(t.path))break;t.path.length>s.length+1||Ke(Ge(o),n)<=0||(r.has(o.key)||Xr(e,o))&&(i=i.insert(o.key,o.mutableCopy()))}return Xe.resolve(i)}getAllFromCollectionGroup(t,e,n,r){de(9500)}si(t,e){return Xe.forEach(this.docs,(t=>e(t)))}newChangeBuffer(t){return new lo(this)}getSize(t){return Xe.resolve(this.size)}}class lo extends eo{constructor(t){super(),this.Br=t}applyChanges(t){const e=[];return this.changes.forEach(((n,r)=>{r.isValidDocument()?e.push(this.Br.addEntry(t,r)):this.Br.removeEntry(n)})),Xe.waitFor(e)}getFromCache(t,e){return this.Br.getEntry(t,e)}getAllFromCache(t,e){return this.Br.getEntries(t,e)}}class fo{constructor(t){this.persistence=t,this.oi=new Zr((t=>Pr(t)),Vr),this.lastRemoteSnapshotVersion=Fe.min(),this.highestTargetId=0,this._i=0,this.ai=new ao,this.targetCount=0,this.ui=Ws.cr()}forEachTarget(t,e){return this.oi.forEach(((t,n)=>e(n))),Xe.resolve()}getLastRemoteSnapshotVersion(t){return Xe.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return Xe.resolve(this._i)}allocateTargetId(t){return this.highestTargetId=this.ui.next(),Xe.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this._i&&(this._i=e),Xe.resolve()}Tr(t){this.oi.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.ui=new Ws(e),this.highestTargetId=e),t.sequenceNumber>this._i&&(this._i=t.sequenceNumber)}addTargetData(t,e){return this.Tr(e),this.targetCount+=1,Xe.resolve()}updateTargetData(t,e){return this.Tr(e),Xe.resolve()}removeTargetData(t,e){return this.oi.delete(e.target),this.ai.Hr(e.targetId),this.targetCount-=1,Xe.resolve()}removeTargets(t,e,n){let r=0;const i=[];return this.oi.forEach(((s,o)=>{o.sequenceNumber<=e&&null===n.get(o.targetId)&&(this.oi.delete(s),i.push(this.removeMatchingKeysForTargetId(t,o.targetId)),r++)})),Xe.waitFor(i).next((()=>r))}getTargetCount(t){return Xe.resolve(this.targetCount)}getTargetData(t,e){const n=this.oi.get(e)||null;return Xe.resolve(n)}addMatchingKeys(t,e,n){return this.ai.Gr(e,n),Xe.resolve()}removeMatchingKeys(t,e,n){this.ai.jr(e,n);const r=this.persistence.referenceDelegate,i=[];return r&&e.forEach((e=>{i.push(r.markPotentiallyOrphaned(t,e))})),Xe.waitFor(i)}removeMatchingKeysForTargetId(t,e){return this.ai.Hr(e),Xe.resolve()}getMatchingKeysForTargetId(t,e){const n=this.ai.Yr(e);return Xe.resolve(n)}containsKey(t,e){return Xe.resolve(this.ai.containsKey(e))}}class go{constructor(t,e){this.ci={},this.overlays={},this.li=new Je(0),this.hi=!1,this.hi=!0,this.Pi=new oo,this.referenceDelegate=t(this),this.Ti=new fo(this),this.indexManager=new zs,this.remoteDocumentCache=function(t){return new ho(t)}((t=>this.referenceDelegate.Ii(t))),this.serializer=new js(e),this.Ei=new io(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.hi=!1,Promise.resolve()}get started(){return this.hi}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new so,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let n=this.ci[t.toKey()];return n||(n=new uo(e,this.referenceDelegate),this.ci[t.toKey()]=n),n}getGlobalsCache(){return this.Pi}getTargetCache(){return this.Ti}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ei}runTransaction(t,e,n){ce("MemoryPersistence","Starting transaction:",t);const r=new po(this.li.next());return this.referenceDelegate.di(),n(r).next((t=>this.referenceDelegate.Ai(r).next((()=>t)))).toPromise().then((t=>(r.raiseOnCommittedEvent(),t)))}Ri(t,e){return Xe.or(Object.values(this.ci).map((n=>()=>n.containsKey(t,e))))}}class po extends Qe{constructor(t){super(),this.currentSequenceNumber=t}}class mo{constructor(t){this.persistence=t,this.Vi=new ao,this.mi=null}static fi(t){return new mo(t)}get gi(){if(this.mi)return this.mi;throw de(60996)}addReference(t,e,n){return this.Vi.addReference(n,e),this.gi.delete(n.toString()),Xe.resolve()}removeReference(t,e,n){return this.Vi.removeReference(n,e),this.gi.add(n.toString()),Xe.resolve()}markPotentiallyOrphaned(t,e){return this.gi.add(e.toString()),Xe.resolve()}removeTarget(t,e){this.Vi.Hr(e.targetId).forEach((t=>this.gi.add(t.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next((t=>{t.forEach((t=>this.gi.add(t.toString())))})).next((()=>n.removeTargetData(t,e)))}di(){this.mi=new Set}Ai(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Xe.forEach(this.gi,(n=>{const r=ze.fromPath(n);return this.pi(t,r).next((t=>{t||e.removeEntry(r,Fe.min())}))})).next((()=>(this.mi=null,e.apply(t))))}updateLimboDocument(t,e){return this.pi(t,e).next((t=>{t?this.gi.delete(e.toString()):this.gi.add(e.toString())}))}Ii(t){return 0}pi(t,e){return Xe.or([()=>Xe.resolve(this.Vi.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Ri(t,e)])}}class yo{constructor(t,e){this.persistence=t,this.yi=new Zr((t=>function(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=nn(e)),e=en(t.get(n),e);return nn(e)}(t.path)),((t,e)=>t.isEqual(e))),this.garbageCollector=function(t,e){return new to(t,e)}(this,e)}static fi(t,e){return new yo(t,e)}di(){}Ai(t){return Xe.resolve()}forEachTarget(t,e){return this.persistence.getTargetCache().forEachTarget(t,e)}pr(t){const e=this.Sr(t);return this.persistence.getTargetCache().getTargetCount(t).next((t=>e.next((e=>t+e))))}Sr(t){let e=0;return this.yr(t,(t=>{e++})).next((()=>e))}yr(t,e){return Xe.forEach(this.yi,((n,r)=>this.Dr(t,n,r).next((t=>t?Xe.resolve():e(r)))))}removeTargets(t,e,n){return this.persistence.getTargetCache().removeTargets(t,e,n)}removeOrphanedDocuments(t,e){let n=0;const r=this.persistence.getRemoteDocumentCache(),i=r.newChangeBuffer();return r.si(t,(r=>this.Dr(t,r,e).next((t=>{t||(n++,i.removeEntry(r,Fe.min()))})))).next((()=>i.apply(t))).next((()=>n))}markPotentiallyOrphaned(t,e){return this.yi.set(e,t.currentSequenceNumber),Xe.resolve()}removeTarget(t,e){const n=e.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(t,n)}addReference(t,e,n){return this.yi.set(n,t.currentSequenceNumber),Xe.resolve()}removeReference(t,e,n){return this.yi.set(n,t.currentSequenceNumber),Xe.resolve()}updateLimboDocument(t,e){return this.yi.set(e,t.currentSequenceNumber),Xe.resolve()}Ii(t){let e=t.key.toString().length;return t.isFoundDocument()&&(e+=tr(t.data.value)),e}Dr(t,e,n){return Xe.or([()=>this.persistence.Ri(t,e),()=>this.persistence.getTargetCache().containsKey(t,e),()=>{const t=this.yi.get(e);return Xe.resolve(void 0!==t&&t>n)}])}getCacheSize(t){return this.persistence.getRemoteDocumentCache().getSize(t)}}class vo{constructor(t,e,n,r){this.targetId=t,this.fromCache=e,this.ds=n,this.As=r}static Rs(t,e){let n=hi(),r=hi();for(const t of e.docChanges)switch(t.type){case 0:n=n.add(t.doc.key);break;case 1:r=r.add(t.doc.key)}return new vo(t,e.fromCache,n,r)}}class wo{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}}class Eo{constructor(){this.Vs=!1,this.fs=!1,this.gs=100,this.ps=d()?8:function(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}("undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:"")>0?6:4}initialize(t,e){this.ys=t,this.indexManager=e,this.Vs=!0}getDocumentsMatchingQuery(t,e,n,r){const i={result:null};return this.ws(t,e).next((t=>{i.result=t})).next((()=>{if(!i.result)return this.Ss(t,e,r,n).next((t=>{i.result=t}))})).next((()=>{if(i.result)return;const n=new wo;return this.bs(t,e,n).next((r=>{if(i.result=r,this.fs)return this.Ds(t,e,n,r.size)}))})).next((()=>i.result))}Ds(t,e,n,r){return n.documentReadCount<this.gs?(ae()<=C.DEBUG&&ce("QueryEngine","SDK will not create cache indexes for query:",Wr(e),"since it only creates cache indexes for collection contains","more than or equal to",this.gs,"documents"),Xe.resolve()):(ae()<=C.DEBUG&&ce("QueryEngine","Query:",Wr(e),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.ps*r?(ae()<=C.DEBUG&&ce("QueryEngine","The SDK decides to create cache indexes for query:",Wr(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,zr(e))):Xe.resolve())}ws(t,e){if(jr(e))return Xe.resolve(null);let n=zr(e);return this.indexManager.getIndexType(t,n).next((r=>0===r?null:(null!==e.limit&&1===r&&(e=Hr(e,null,"F"),n=zr(e)),this.indexManager.getDocumentsMatchingTarget(t,n).next((r=>{const i=hi(...r);return this.ys.getDocuments(t,i).next((r=>this.indexManager.getMinOffset(t,n).next((n=>{const s=this.vs(e,r);return this.Cs(e,s,i,n.readTime)?this.ws(t,Hr(e,null,"F")):this.Fs(t,s,e,n)}))))})))))}Ss(t,e,n,r){return jr(e)||r.isEqual(Fe.min())?Xe.resolve(null):this.ys.getDocuments(t,n).next((i=>{const s=this.vs(e,i);return this.Cs(e,s,n,r)?Xe.resolve(null):(ae()<=C.DEBUG&&ce("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),Wr(e)),this.Fs(t,s,e,function(t,e){const n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,i=Fe.fromTimestamp(1e9===r?new Ve(n+1,0):new Ve(n,r));return new He(i,ze.empty(),e)}(r,-1)).next((t=>t)))}))}vs(t,e){let n=new _n(Yr(t));return e.forEach(((e,r)=>{Xr(t,r)&&(n=n.add(r))})),n}Cs(t,e,n,r){if(null===t.limit)return!1;if(n.size!==e.size)return!0;const i="F"===t.limitType?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}bs(t,e,n){return ae()<=C.DEBUG&&ce("QueryEngine","Using full collection scan to execute query:",Wr(e)),this.ys.getDocumentsMatchingQuery(t,e,He.min(),n)}Fs(t,e,n,r){return this.ys.getDocumentsMatchingQuery(t,n,r).next((t=>(e.forEach((e=>{t=t.insert(e.key,e)})),t)))}}const bo="LocalStore";class _o{constructor(t,e,n,r){this.persistence=t,this.Ms=e,this.serializer=r,this.xs=new wn(ke),this.Os=new Zr((t=>Pr(t)),Vr),this.Ns=new Map,this.Bs=t.getRemoteDocumentCache(),this.Ti=t.getTargetCache(),this.Ei=t.getBundleCache(),this.Ls(n)}Ls(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new ro(this.Bs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Bs.setIndexManager(this.indexManager),this.Ms.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(e=>t.collect(e,this.xs)))}}async function To(t,e){const n=pe(t);return await n.persistence.runTransaction("Handle user change","readonly",(t=>{let r;return n.mutationQueue.getAllMutationBatches(t).next((i=>(r=i,n.Ls(e),n.mutationQueue.getAllMutationBatches(t)))).next((e=>{const i=[],s=[];let o=hi();for(const t of r){i.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}for(const t of e){s.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}return n.localDocuments.getDocuments(t,o).next((t=>({ks:t,removedBatchIds:i,addedBatchIds:s})))}))}))}function Co(t){const e=pe(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Ti.getLastRemoteSnapshotVersion(t)))}function Io(t,e){const n=pe(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(t=>(void 0===e&&(e=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(t,e))))}async function So(t,e,n){const r=pe(t),i=r.xs.get(e),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,(t=>r.persistence.referenceDelegate.removeTarget(t,i)))}catch(t){if(!Ye(t))throw t;ce(bo,`Failed to update sequence numbers for target ${e}: ${t}`)}r.xs=r.xs.remove(e),r.Os.delete(i.target)}function Ao(t,e,n){const r=pe(t);let i=Fe.min(),s=hi();return r.persistence.runTransaction("Execute query","readwrite",(t=>function(t,e,n){const r=pe(t),i=r.Os.get(n);return void 0!==i?Xe.resolve(r.xs.get(i)):r.Ti.getTargetData(e,n)}(r,t,zr(e)).next((e=>{if(e)return i=e.lastLimboFreeSnapshotVersion,r.Ti.getMatchingKeysForTargetId(t,e.targetId).next((t=>{s=t}))})).next((()=>r.Ms.getDocumentsMatchingQuery(t,e,n?i:Fe.min(),n?s:hi()))).next((t=>(function(t,e,n){let r=t.Ns.get(e)||Fe.min();n.forEach(((t,e)=>{e.readTime.compareTo(r)>0&&(r=e.readTime)})),t.Ns.set(e,r)}(r,function(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}(e),t),{documents:t,$s:s})))))}class Do{constructor(){this.activeTargetIds=li}js(t){this.activeTargetIds=this.activeTargetIds.add(t)}Hs(t){this.activeTargetIds=this.activeTargetIds.delete(t)}zs(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class No{constructor(){this.xo=new Do,this.Oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t,e=!0){return e&&this.xo.js(t),this.Oo[t]||"not-current"}updateQueryState(t,e,n){this.Oo[t]=e}removeLocalQueryTarget(t){this.xo.Hs(t)}isLocalQueryTarget(t){return this.xo.activeTargetIds.has(t)}clearQueryState(t){delete this.Oo[t]}getAllActiveQueryTargets(){return this.xo.activeTargetIds}isActiveQueryTarget(t){return this.xo.activeTargetIds.has(t)}start(){return this.xo=new Do,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}class ko{No(t){}shutdown(){}}const xo="ConnectivityMonitor";class Ro{constructor(){this.Bo=()=>this.Lo(),this.ko=()=>this.qo(),this.Qo=[],this.$o()}No(t){this.Qo.push(t)}shutdown(){window.removeEventListener("online",this.Bo),window.removeEventListener("offline",this.ko)}$o(){window.addEventListener("online",this.Bo),window.addEventListener("offline",this.ko)}Lo(){ce(xo,"Network connectivity changed: AVAILABLE");for(const t of this.Qo)t(0)}qo(){ce(xo,"Network connectivity changed: UNAVAILABLE");for(const t of this.Qo)t(1)}static C(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Lo=null;function Oo(){return null===Lo?Lo=268435456+Math.round(2147483648*Math.random()):Lo++,"0x"+Lo.toString(16)}const Mo="RestConnection",Po={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Vo{get Uo(){return!1}constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.Ko=e+"://"+t.host,this.Wo=`projects/${n}/databases/${r}`,this.Go=this.databaseId.database===Un?`project_id=${n}`:`project_id=${n}&database_id=${r}`}zo(t,e,n,r,i){const s=Oo(),o=this.jo(t,e.toUriEncodedString());ce(Mo,`Sending RPC '${t}' ${s}:`,o,n);const a={"google-cloud-resource-prefix":this.Wo,"x-goog-request-params":this.Go};this.Ho(a,r,i);const{host:u}=new URL(o),h=c(u);return this.Jo(t,o,a,n,h).then((e=>(ce(Mo,`Received RPC '${t}' ${s}: `,e),e)),(e=>{throw he(Mo,`RPC '${t}' ${s} failed with error: `,e,"url: ",o,"request:",n),e}))}Yo(t,e,n,r,i,s){return this.zo(t,e,n,r,i)}Ho(t,e,n){t["X-Goog-Api-Client"]="gl-js/ fire/"+se,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach(((e,n)=>t[n]=e)),n&&n.headers.forEach(((e,n)=>t[n]=e))}jo(t,e){const n=Po[t];return`${this.Ko}/v1/${e}:${n}`}terminate(){}}class Fo{constructor(t){this.Zo=t.Zo,this.Xo=t.Xo}e_(t){this.t_=t}n_(t){this.r_=t}i_(t){this.s_=t}onMessage(t){this.o_=t}close(){this.Xo()}send(t){this.Zo(t)}__(){this.t_()}a_(){this.r_()}u_(t){this.s_(t)}c_(t){this.o_(t)}}const Uo="WebChannelConnection";class Bo extends Vo{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}Jo(t,e,n,r,i){const s=Oo();return new Promise(((i,o)=>{const a=new Ht;a.setWithCredentials(!0),a.listenOnce(Qt.COMPLETE,(()=>{try{switch(a.getLastErrorCode()){case Wt.NO_ERROR:const e=a.getResponseJson();ce(Uo,`XHR for RPC '${t}' ${s} received:`,JSON.stringify(e)),i(e);break;case Wt.TIMEOUT:ce(Uo,`RPC '${t}' ${s} timed out`),o(new ye(me.DEADLINE_EXCEEDED,"Request time out"));break;case Wt.HTTP_ERROR:const n=a.getStatus();if(ce(Uo,`RPC '${t}' ${s} failed with status:`,n,"response text:",a.getResponseText()),n>0){let t=a.getResponseJson();Array.isArray(t)&&(t=t[0]);const e=null==t?void 0:t.error;if(e&&e.status&&e.message){const t=function(t){const e=t.toLowerCase().replace(/_/g,"-");return Object.values(me).indexOf(e)>=0?e:me.UNKNOWN}(e.status);o(new ye(t,e.message))}else o(new ye(me.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new ye(me.UNAVAILABLE,"Connection failed."));break;default:de(9055,{l_:t,streamId:s,h_:a.getLastErrorCode(),P_:a.getLastError()})}}finally{ce(Uo,`RPC '${t}' ${s} completed.`)}}));const c=JSON.stringify(r);ce(Uo,`RPC '${t}' ${s} sending request:`,r),a.send(e,"POST",c,n,15)}))}T_(t,e,n){const r=Oo(),i=[this.Ko,"/","google.firestore.v1.Firestore","/",t,"/channel"],s=Zt(),o=Jt(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(a.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(a.useFetchStreams=!0),this.Ho(a.initMessageHeaders,e,n),a.encodeInitMessageHeaders=!0;const u=i.join("");ce(Uo,`Creating RPC '${t}' stream ${r}: ${u}`,a);const h=s.createWebChannel(u,a);let l=!1,d=!1;const f=new Fo({Zo:e=>{d?ce(Uo,`Not sending because RPC '${t}' stream ${r} is closed:`,e):(l||(ce(Uo,`Opening RPC '${t}' stream ${r} transport.`),h.open(),l=!0),ce(Uo,`RPC '${t}' stream ${r} sending:`,e),h.send(e))},Xo:()=>h.close()}),g=(t,e,n)=>{t.listen(e,(t=>{try{n(t)}catch(t){setTimeout((()=>{throw t}),0)}}))};return g(h,Kt.EventType.OPEN,(()=>{d||(ce(Uo,`RPC '${t}' stream ${r} transport opened.`),f.__())})),g(h,Kt.EventType.CLOSE,(()=>{d||(d=!0,ce(Uo,`RPC '${t}' stream ${r} transport closed`),f.u_())})),g(h,Kt.EventType.ERROR,(e=>{d||(d=!0,he(Uo,`RPC '${t}' stream ${r} transport errored. Name:`,e.name,"Message:",e.message),f.u_(new ye(me.UNAVAILABLE,"The operation could not be completed")))})),g(h,Kt.EventType.MESSAGE,(e=>{var n;if(!d){const i=e.data[0];ge(!!i,16349);const s=i,o=(null==s?void 0:s.error)||(null===(n=s[0])||void 0===n?void 0:n.error);if(o){ce(Uo,`RPC '${t}' stream ${r} received error:`,o);const e=o.status;let n=function(t){const e=Ki[t];if(void 0!==e)return Wi(e)}(e),i=o.message;void 0===n&&(n=me.INTERNAL,i="Unknown error status: "+e+" with message "+o.message),d=!0,f.u_(new ye(n,i)),h.close()}else ce(Uo,`RPC '${t}' stream ${r} received:`,i),f.c_(i)}})),g(o,Yt.STAT_EVENT,(e=>{e.stat===Xt.PROXY?ce(Uo,`RPC '${t}' stream ${r} detected buffering proxy`):e.stat===Xt.NOPROXY&&ce(Uo,`RPC '${t}' stream ${r} detected no buffering proxy`)})),setTimeout((()=>{f.a_()}),0),f}}function jo(){return"undefined"!=typeof document?document:null}function qo(t){return new fs(t,!0)}class $o{constructor(t,e,n=1e3,r=1.5,i=6e4){this.xi=t,this.timerId=e,this.I_=n,this.E_=r,this.d_=i,this.A_=0,this.R_=null,this.V_=Date.now(),this.reset()}reset(){this.A_=0}m_(){this.A_=this.d_}f_(t){this.cancel();const e=Math.floor(this.A_+this.g_()),n=Math.max(0,Date.now()-this.V_),r=Math.max(0,e-n);r>0&&ce("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.A_} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.R_=this.xi.enqueueAfterDelay(this.timerId,r,(()=>(this.V_=Date.now(),t()))),this.A_*=this.E_,this.A_<this.I_&&(this.A_=this.I_),this.A_>this.d_&&(this.A_=this.d_)}p_(){null!==this.R_&&(this.R_.skipDelay(),this.R_=null)}cancel(){null!==this.R_&&(this.R_.cancel(),this.R_=null)}g_(){return(Math.random()-.5)*this.A_}}const zo="PersistentStream";class Go{constructor(t,e,n,r,i,s,o,a){this.xi=t,this.y_=n,this.w_=r,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.S_=0,this.b_=null,this.D_=null,this.stream=null,this.v_=0,this.C_=new $o(t,e)}F_(){return 1===this.state||5===this.state||this.M_()}M_(){return 2===this.state||3===this.state}start(){this.v_=0,4!==this.state?this.auth():this.x_()}async stop(){this.F_()&&await this.close(0)}O_(){this.state=0,this.C_.reset()}N_(){this.M_()&&null===this.b_&&(this.b_=this.xi.enqueueAfterDelay(this.y_,6e4,(()=>this.B_())))}L_(t){this.k_(),this.stream.send(t)}async B_(){if(this.M_())return this.close(0)}k_(){this.b_&&(this.b_.cancel(),this.b_=null)}q_(){this.D_&&(this.D_.cancel(),this.D_=null)}async close(t,e){this.k_(),this.q_(),this.C_.cancel(),this.S_++,4!==t?this.C_.reset():e&&e.code===me.RESOURCE_EXHAUSTED?(ue(e.toString()),ue("Using maximum backoff delay to prevent overloading the backend."),this.C_.m_()):e&&e.code===me.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.Q_(),this.stream.close(),this.stream=null),this.state=t,await this.listener.i_(e)}Q_(){}auth(){this.state=1;const t=this.U_(this.S_),e=this.S_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([t,n])=>{this.S_===e&&this.K_(t,n)}),(e=>{t((()=>{const t=new ye(me.UNKNOWN,"Fetching auth token failed: "+e.message);return this.W_(t)}))}))}K_(t,e){const n=this.U_(this.S_);this.stream=this.G_(t,e),this.stream.e_((()=>{n((()=>this.listener.e_()))})),this.stream.n_((()=>{n((()=>(this.state=2,this.D_=this.xi.enqueueAfterDelay(this.w_,1e4,(()=>(this.M_()&&(this.state=3),Promise.resolve()))),this.listener.n_())))})),this.stream.i_((t=>{n((()=>this.W_(t)))})),this.stream.onMessage((t=>{n((()=>1==++this.v_?this.z_(t):this.onNext(t)))}))}x_(){this.state=5,this.C_.f_((async()=>{this.state=0,this.start()}))}W_(t){return ce(zo,`close with error: ${t}`),this.stream=null,this.close(4,t)}U_(t){return e=>{this.xi.enqueueAndForget((()=>this.S_===t?e():(ce(zo,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class Ho extends Go{constructor(t,e,n,r,i,s){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,n,r,s),this.serializer=i}G_(t,e){return this.connection.T_("Listen",t,e)}z_(t){return this.onNext(t)}onNext(t){this.C_.reset();const e=function(t,e){let n;if("targetChange"in e){e.targetChange;const r=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:de(39313,{state:t})}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=function(t,e){return t.useProto3Json?(ge(void 0===e||"string"==typeof e,58123),Sn.fromBase64String(e||"")):(ge(void 0===e||e instanceof Buffer||e instanceof Uint8Array,16193),Sn.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(t){const e=void 0===t.code?me.UNKNOWN:Wi(t.code);return new ye(e,t.message||"")}(o);n=new ss(r,i,s,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const i=Ts(t,r.document.name),s=vs(r.document.updateTime),o=r.document.createTime?vs(r.document.createTime):Fe.min(),a=new hr({mapValue:{fields:r.document.fields}}),c=dr.newFoundDocument(i,s,o,a),u=r.targetIds||[],h=r.removedTargetIds||[];n=new rs(u,h,c.key,c)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const i=Ts(t,r.document),s=r.readTime?vs(r.readTime):Fe.min(),o=dr.newNoDocument(i,s),a=r.removedTargetIds||[];n=new rs([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const i=Ts(t,r.document),s=r.removedTargetIds||[];n=new rs([],s,i,null)}else{if(!("filter"in e))return de(11601,{Vt:e});{e.filter;const t=e.filter;t.targetId;const{count:r=0,unchangedNames:i}=t,s=new Hi(r,i),o=t.targetId;n=new is(o,s)}}return n}(this.serializer,t),n=function(t){if(!("targetChange"in t))return Fe.min();const e=t.targetChange;return e.targetIds&&e.targetIds.length?Fe.min():e.readTime?vs(e.readTime):Fe.min()}(t);return this.listener.j_(e,n)}H_(t){const e={};e.database=Is(this.serializer),e.addTarget=function(t,e){let n;const r=e.target;if(n=Fr(r)?{documents:Ds(t,r)}:{query:Ns(t,r).gt},n.targetId=e.targetId,e.resumeToken.approximateByteSize()>0){n.resumeToken=ms(t,e.resumeToken);const r=gs(t,e.expectedCount);null!==r&&(n.expectedCount=r)}else if(e.snapshotVersion.compareTo(Fe.min())>0){n.readTime=ps(t,e.snapshotVersion.toTimestamp());const r=gs(t,e.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,t);const n=function(t,e){const n=function(t){switch(t){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return de(28987,{purpose:t})}}(e.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,t);n&&(e.labels=n),this.L_(e)}J_(t){const e={};e.database=Is(this.serializer),e.removeTarget=t,this.L_(e)}}class Ko extends Go{constructor(t,e,n,r,i,s){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,n,r,s),this.serializer=i}get Y_(){return this.v_>0}start(){this.lastStreamToken=void 0,super.start()}Q_(){this.Y_&&this.Z_([])}G_(t,e){return this.connection.T_("Write",t,e)}z_(t){return ge(!!t.streamToken,31322),this.lastStreamToken=t.streamToken,ge(!t.writeResults||0===t.writeResults.length,55816),this.listener.X_()}onNext(t){ge(!!t.streamToken,12678),this.lastStreamToken=t.streamToken,this.C_.reset();const e=function(t,e){return t&&t.length>0?(ge(void 0!==e,14353),t.map((t=>function(t,e){let n=t.updateTime?vs(t.updateTime):vs(e);return n.isEqual(Fe.min())&&(n=vs(e)),new Ai(n,t.transformResults||[])}(t,e)))):[]}(t.writeResults,t.commitTime),n=vs(t.commitTime);return this.listener.ea(n,e)}ta(){const t={};t.database=Is(this.serializer),this.L_(t)}Z_(t){const e={streamToken:this.lastStreamToken,writes:t.map((t=>function(t,e){let n;if(e instanceof Pi)n={update:As(t,e.key,e.value)};else if(e instanceof ji)n={delete:_s(t,e.key)};else if(e instanceof Vi)n={update:As(t,e.key,e.data),updateMask:Fs(e.fieldMask)};else{if(!(e instanceof qi))return de(16599,{ft:e.type});n={verify:_s(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map((t=>function(t,e){const n=e.transform;if(n instanceof wi)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Ei)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof _i)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof Ci)return{fieldPath:e.field.canonicalString(),increment:n.Re};throw de(20930,{transform:e.transform})}(0,t)))),e.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:ys(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:de(27497)}(t,e.precondition)),n}(this.serializer,t)))};this.L_(e)}}class Qo{}class Wo extends Qo{constructor(t,e,n,r){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=n,this.serializer=r,this.na=!1}ra(){if(this.na)throw new ye(me.FAILED_PRECONDITION,"The client has already been terminated.")}zo(t,e,n,r){return this.ra(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,s])=>this.connection.zo(t,Es(e,n),r,i,s))).catch((t=>{throw"FirebaseError"===t.name?(t.code===me.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new ye(me.UNKNOWN,t.toString())}))}Yo(t,e,n,r,i){return this.ra(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([s,o])=>this.connection.Yo(t,Es(e,n),r,s,o,i))).catch((t=>{throw"FirebaseError"===t.name?(t.code===me.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new ye(me.UNKNOWN,t.toString())}))}terminate(){this.na=!0,this.connection.terminate()}}class Xo{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.ia=0,this.sa=null,this.oa=!0}_a(){0===this.ia&&(this.aa("Unknown"),this.sa=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.sa=null,this.ua("Backend didn't respond within 10 seconds."),this.aa("Offline"),Promise.resolve()))))}ca(t){"Online"===this.state?this.aa("Unknown"):(this.ia++,this.ia>=1&&(this.la(),this.ua(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.aa("Offline")))}set(t){this.la(),this.ia=0,"Online"===t&&(this.oa=!1),this.aa(t)}aa(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}ua(t){const e=`Could not reach Cloud Firestore backend. ${t}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.oa?(ue(e),this.oa=!1):ce("OnlineStateTracker",e)}la(){null!==this.sa&&(this.sa.cancel(),this.sa=null)}}const Yo="RemoteStore";class Jo{constructor(t,e,n,r,i){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.ha=[],this.Pa=new Map,this.Ta=new Set,this.Ia=[],this.Ea=i,this.Ea.No((t=>{n.enqueueAndForget((async()=>{aa(this)&&(ce(Yo,"Restarting streams for network reachability change."),await async function(t){const e=pe(t);e.Ta.add(4),await ta(e),e.da.set("Unknown"),e.Ta.delete(4),await Zo(e)}(this))}))})),this.da=new Xo(n,r)}}async function Zo(t){if(aa(t))for(const e of t.Ia)await e(!0)}async function ta(t){for(const e of t.Ia)await e(!1)}function ea(t,e){const n=pe(t);n.Pa.has(e.targetId)||(n.Pa.set(e.targetId,e),oa(n)?sa(n):Ia(n).M_()&&ra(n,e))}function na(t,e){const n=pe(t),r=Ia(n);n.Pa.delete(e),r.M_()&&ia(n,e),0===n.Pa.size&&(r.M_()?r.N_():aa(n)&&n.da.set("Unknown"))}function ra(t,e){if(t.Aa.Ke(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Fe.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}Ia(t).H_(e)}function ia(t,e){t.Aa.Ke(e),Ia(t).J_(e)}function sa(t){t.Aa=new as({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),Rt:e=>t.Pa.get(e)||null,Pt:()=>t.datastore.serializer.databaseId}),Ia(t).start(),t.da._a()}function oa(t){return aa(t)&&!Ia(t).F_()&&t.Pa.size>0}function aa(t){return 0===pe(t).Ta.size}function ca(t){t.Aa=void 0}async function ua(t){t.da.set("Online")}async function ha(t){t.Pa.forEach(((e,n)=>{ra(t,e)}))}async function la(t,e){ca(t),oa(t)?(t.da.ca(e),sa(t)):t.da.set("Unknown")}async function da(t,e,n){if(t.da.set("Online"),e instanceof ss&&2===e.state&&e.cause)try{await async function(t,e){const n=e.cause;for(const r of e.targetIds)t.Pa.has(r)&&(await t.remoteSyncer.rejectListen(r,n),t.Pa.delete(r),t.Aa.removeTarget(r))}(t,e)}catch(n){ce(Yo,"Failed to remove targets %s: %s ",e.targetIds.join(","),n),await fa(t,n)}else if(e instanceof rs?t.Aa.Xe(e):e instanceof is?t.Aa.ot(e):t.Aa.nt(e),!n.isEqual(Fe.min()))try{const e=await Co(t.localStore);n.compareTo(e)>=0&&await function(t,e){const n=t.Aa.It(e);return n.targetChanges.forEach(((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const i=t.Pa.get(r);i&&t.Pa.set(r,i.withResumeToken(n.resumeToken,e))}})),n.targetMismatches.forEach(((e,n)=>{const r=t.Pa.get(e);if(!r)return;t.Pa.set(e,r.withResumeToken(Sn.EMPTY_BYTE_STRING,r.snapshotVersion)),ia(t,e);const i=new Bs(r.target,e,n,r.sequenceNumber);ra(t,i)})),t.remoteSyncer.applyRemoteEvent(n)}(t,n)}catch(e){ce(Yo,"Failed to raise snapshot:",e),await fa(t,e)}}async function fa(t,e,n){if(!Ye(e))throw e;t.Ta.add(1),await ta(t),t.da.set("Offline"),n||(n=()=>Co(t.localStore)),t.asyncQueue.enqueueRetryable((async()=>{ce(Yo,"Retrying IndexedDB access"),await n(),t.Ta.delete(1),await Zo(t)}))}function ga(t,e){return e().catch((n=>fa(t,n,e)))}async function pa(t){const e=pe(t),n=Sa(e);let r=e.ha.length>0?e.ha[e.ha.length-1].batchId:-1;for(;ma(e);)try{const t=await Io(e.localStore,r);if(null===t){0===e.ha.length&&n.N_();break}r=t.batchId,ya(e,t)}catch(t){await fa(e,t)}va(e)&&wa(e)}function ma(t){return aa(t)&&t.ha.length<10}function ya(t,e){t.ha.push(e);const n=Sa(t);n.M_()&&n.Y_&&n.Z_(e.mutations)}function va(t){return aa(t)&&!Sa(t).F_()&&t.ha.length>0}function wa(t){Sa(t).start()}async function Ea(t){Sa(t).ta()}async function ba(t){const e=Sa(t);for(const n of t.ha)e.Z_(n.mutations)}async function _a(t,e,n){const r=t.ha.shift(),i=zi.from(r,e,n);await ga(t,(()=>t.remoteSyncer.applySuccessfulWrite(i))),await pa(t)}async function Ta(t,e){e&&Sa(t).Y_&&await async function(t,e){if(function(t){return function(t){switch(t){case me.OK:return de(64938);case me.CANCELLED:case me.UNKNOWN:case me.DEADLINE_EXCEEDED:case me.RESOURCE_EXHAUSTED:case me.INTERNAL:case me.UNAVAILABLE:case me.UNAUTHENTICATED:return!1;case me.INVALID_ARGUMENT:case me.NOT_FOUND:case me.ALREADY_EXISTS:case me.PERMISSION_DENIED:case me.FAILED_PRECONDITION:case me.ABORTED:case me.OUT_OF_RANGE:case me.UNIMPLEMENTED:case me.DATA_LOSS:return!0;default:return de(15467,{code:t})}}(t)&&t!==me.ABORTED}(e.code)){const n=t.ha.shift();Sa(t).O_(),await ga(t,(()=>t.remoteSyncer.rejectFailedWrite(n.batchId,e))),await pa(t)}}(t,e),va(t)&&wa(t)}async function Ca(t,e){const n=pe(t);n.asyncQueue.verifyOperationInProgress(),ce(Yo,"RemoteStore received new credentials");const r=aa(n);n.Ta.add(3),await ta(n),r&&n.da.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.Ta.delete(3),await Zo(n)}function Ia(t){return t.Ra||(t.Ra=function(t,e,n){const r=pe(t);return r.ra(),new Ho(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(t.datastore,t.asyncQueue,{e_:ua.bind(null,t),n_:ha.bind(null,t),i_:la.bind(null,t),j_:da.bind(null,t)}),t.Ia.push((async e=>{e?(t.Ra.O_(),oa(t)?sa(t):t.da.set("Unknown")):(await t.Ra.stop(),ca(t))}))),t.Ra}function Sa(t){return t.Va||(t.Va=function(t,e,n){const r=pe(t);return r.ra(),new Ko(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(t.datastore,t.asyncQueue,{e_:()=>Promise.resolve(),n_:Ea.bind(null,t),i_:Ta.bind(null,t),X_:ba.bind(null,t),ea:_a.bind(null,t)}),t.Ia.push((async e=>{e?(t.Va.O_(),await pa(t)):(await t.Va.stop(),t.ha.length>0&&(ce(Yo,`Stopping write stream with ${t.ha.length} pending writes`),t.ha=[]))}))),t.Va}class Aa{constructor(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new ve,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((t=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(t,e,n,r,i){const s=Date.now()+n,o=new Aa(t,e,s,r,i);return o.start(n),o}start(t){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new ye(me.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((t=>this.deferred.resolve(t)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Da(t,e){if(ue("AsyncQueue",`${e}: ${t}`),Ye(t))return new ye(me.UNAVAILABLE,`${e}: ${t}`);throw t}class Na{static emptySet(t){return new Na(t.comparator)}constructor(t){this.comparator=t?(e,n)=>t(e,n)||ze.comparator(e.key,n.key):(t,e)=>ze.comparator(t.key,e.key),this.keyedMap=ri(),this.sortedSet=new wn(this.comparator)}has(t){return null!=this.keyedMap.get(t)}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal(((e,n)=>(t(e),!1)))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof Na))return!1;if(this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();for(;e.hasNext();){const t=e.getNext().key,r=n.getNext().key;if(!t.isEqual(r))return!1}return!0}toString(){const t=[];return this.forEach((e=>{t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(t,e){const n=new Na;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}}class ka{constructor(){this.ma=new wn(ze.comparator)}track(t){const e=t.doc.key,n=this.ma.get(e);n?0!==t.type&&3===n.type?this.ma=this.ma.insert(e,t):3===t.type&&1!==n.type?this.ma=this.ma.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.ma=this.ma.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.ma=this.ma.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.ma=this.ma.remove(e):1===t.type&&2===n.type?this.ma=this.ma.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.ma=this.ma.insert(e,{type:2,doc:t.doc}):de(63341,{Vt:t,fa:n}):this.ma=this.ma.insert(e,t)}ga(){const t=[];return this.ma.inorderTraversal(((e,n)=>{t.push(n)})),t}}class xa{constructor(t,e,n,r,i,s,o,a,c){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=c}static fromInitialDocuments(t,e,n,r,i){const s=[];return e.forEach((t=>{s.push({type:0,doc:t})})),new xa(t,e,Na.emptySet(e),s,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&Kr(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let t=0;t<e.length;t++)if(e[t].type!==n[t].type||!e[t].doc.isEqual(n[t].doc))return!1;return!0}}class Ra{constructor(){this.pa=void 0,this.ya=[]}wa(){return this.ya.some((t=>t.Sa()))}}class La{constructor(){this.queries=Oa(),this.onlineState="Unknown",this.ba=new Set}terminate(){!function(t,e){const n=pe(t),r=n.queries;n.queries=Oa(),r.forEach(((t,n)=>{for(const t of n.ya)t.onError(e)}))}(this,new ye(me.ABORTED,"Firestore shutting down"))}}function Oa(){return new Zr((t=>Qr(t)),Kr)}function Ma(t,e){const n=pe(t);let r=!1;for(const t of e){const e=t.query,i=n.queries.get(e);if(i){for(const e of i.ya)e.va(t)&&(r=!0);i.pa=t}}r&&Va(n)}function Pa(t,e,n){const r=pe(t),i=r.queries.get(e);if(i)for(const t of i.ya)t.onError(n);r.queries.delete(e)}function Va(t){t.ba.forEach((t=>{t.next()}))}var Fa,Ua;(Ua=Fa||(Fa={})).Ca="default",Ua.Cache="cache";class Ba{constructor(t,e,n){this.query=t,this.Fa=e,this.Ma=!1,this.xa=null,this.onlineState="Unknown",this.options=n||{}}va(t){if(!this.options.includeMetadataChanges){const e=[];for(const n of t.docChanges)3!==n.type&&e.push(n);t=new xa(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.Ma?this.Oa(t)&&(this.Fa.next(t),e=!0):this.Na(t,this.onlineState)&&(this.Ba(t),e=!0),this.xa=t,e}onError(t){this.Fa.error(t)}Da(t){this.onlineState=t;let e=!1;return this.xa&&!this.Ma&&this.Na(this.xa,t)&&(this.Ba(this.xa),e=!0),e}Na(t,e){if(!t.fromCache)return!0;if(!this.Sa())return!0;const n="Offline"!==e;return(!this.options.La||!n)&&(!t.docs.isEmpty()||t.hasCachedResults||"Offline"===e)}Oa(t){if(t.docChanges.length>0)return!0;const e=this.xa&&this.xa.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges}Ba(t){t=xa.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.Ma=!0,this.Fa.next(t)}Sa(){return this.options.source!==Fa.Cache}}class ja{constructor(t){this.key=t}}class qa{constructor(t){this.key=t}}class $a{constructor(t,e){this.query=t,this.Ga=e,this.za=null,this.hasCachedResults=!1,this.current=!1,this.ja=hi(),this.mutatedKeys=hi(),this.Ha=Yr(t),this.Ja=new Na(this.Ha)}get Ya(){return this.Ga}Za(t,e){const n=e?e.Xa:new ka,r=e?e.Ja:this.Ja;let i=e?e.mutatedKeys:this.mutatedKeys,s=r,o=!1;const a="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,c="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(t.inorderTraversal(((t,e)=>{const u=r.get(t),h=Xr(this.query,e)?e:null,l=!!u&&this.mutatedKeys.has(u.key),d=!!h&&(h.hasLocalMutations||this.mutatedKeys.has(h.key)&&h.hasCommittedMutations);let f=!1;u&&h?u.data.isEqual(h.data)?l!==d&&(n.track({type:3,doc:h}),f=!0):this.eu(u,h)||(n.track({type:2,doc:h}),f=!0,(a&&this.Ha(h,a)>0||c&&this.Ha(h,c)<0)&&(o=!0)):!u&&h?(n.track({type:0,doc:h}),f=!0):u&&!h&&(n.track({type:1,doc:u}),f=!0,(a||c)&&(o=!0)),f&&(h?(s=s.add(h),i=d?i.add(t):i.delete(t)):(s=s.delete(t),i=i.delete(t)))})),null!==this.query.limit)for(;s.size>this.query.limit;){const t="F"===this.query.limitType?s.last():s.first();s=s.delete(t.key),i=i.delete(t.key),n.track({type:1,doc:t})}return{Ja:s,Xa:n,Cs:o,mutatedKeys:i}}eu(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,n,r){const i=this.Ja;this.Ja=t.Ja,this.mutatedKeys=t.mutatedKeys;const s=t.Xa.ga();s.sort(((t,e)=>function(t,e){const n=t=>{switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return de(20277,{Vt:t})}};return n(t)-n(e)}(t.type,e.type)||this.Ha(t.doc,e.doc))),this.tu(n),r=null!=r&&r;const o=e&&!r?this.nu():[],a=0===this.ja.size&&this.current&&!r?1:0,c=a!==this.za;return this.za=a,0!==s.length||c?{snapshot:new xa(this.query,t.Ja,i,s,t.mutatedKeys,0===a,c,!1,!!n&&n.resumeToken.approximateByteSize()>0),ru:o}:{ru:o}}Da(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({Ja:this.Ja,Xa:new ka,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{ru:[]}}iu(t){return!this.Ga.has(t)&&!!this.Ja.has(t)&&!this.Ja.get(t).hasLocalMutations}tu(t){t&&(t.addedDocuments.forEach((t=>this.Ga=this.Ga.add(t))),t.modifiedDocuments.forEach((t=>{})),t.removedDocuments.forEach((t=>this.Ga=this.Ga.delete(t))),this.current=t.current)}nu(){if(!this.current)return[];const t=this.ja;this.ja=hi(),this.Ja.forEach((t=>{this.iu(t.key)&&(this.ja=this.ja.add(t.key))}));const e=[];return t.forEach((t=>{this.ja.has(t)||e.push(new qa(t))})),this.ja.forEach((n=>{t.has(n)||e.push(new ja(n))})),e}su(t){this.Ga=t.$s,this.ja=hi();const e=this.Za(t.documents);return this.applyChanges(e,!0)}ou(){return xa.fromInitialDocuments(this.query,this.Ja,this.mutatedKeys,0===this.za,this.hasCachedResults)}}const za="SyncEngine";class Ga{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}}class Ha{constructor(t){this.key=t,this._u=!1}}class Ka{constructor(t,e,n,r,i,s){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.au={},this.uu=new Zr((t=>Qr(t)),Kr),this.cu=new Map,this.lu=new Set,this.hu=new wn(ze.comparator),this.Pu=new Map,this.Tu=new ao,this.Iu={},this.Eu=new Map,this.du=Ws.lr(),this.onlineState="Unknown",this.Au=void 0}get isPrimaryClient(){return!0===this.Au}}async function Qa(t,e,n=!0){const r=gc(t);let i;const s=r.uu.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.ou()):i=await Xa(r,e,n,!0),i}async function Wa(t,e){const n=gc(t);await Xa(n,e,!0,!1)}async function Xa(t,e,n,r){const i=await function(t,e){const n=pe(t);return n.persistence.runTransaction("Allocate target","readwrite",(t=>{let r;return n.Ti.getTargetData(t,e).next((i=>i?(r=i,Xe.resolve(r)):n.Ti.allocateTargetId(t).next((i=>(r=new Bs(e,i,"TargetPurposeListen",t.currentSequenceNumber),n.Ti.addTargetData(t,r).next((()=>r)))))))})).then((t=>{const r=n.xs.get(t.targetId);return(null===r||t.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.xs=n.xs.insert(t.targetId,t),n.Os.set(e,t.targetId)),t}))}(t.localStore,zr(e)),s=i.targetId,o=t.sharedClientState.addLocalQueryTarget(s,n);let a;return r&&(a=await async function(t,e,n,r,i){t.Ru=(e,n,r)=>async function(t,e,n,r){let i=e.view.Za(n);i.Cs&&(i=await Ao(t.localStore,e.query,!1).then((({documents:t})=>e.view.Za(t,i))));const s=r&&r.targetChanges.get(e.targetId),o=r&&null!=r.targetMismatches.get(e.targetId),a=e.view.applyChanges(i,t.isPrimaryClient,s,o);return cc(t,e.targetId,a.ru),a.snapshot}(t,e,n,r);const s=await Ao(t.localStore,e,!0),o=new $a(e,s.$s),a=o.Za(s.documents),c=ns.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==t.onlineState,i),u=o.applyChanges(a,t.isPrimaryClient,c);cc(t,n,u.ru);const h=new Ga(e,n,o);return t.uu.set(e,h),t.cu.has(n)?t.cu.get(n).push(e):t.cu.set(n,[e]),u.snapshot}(t,e,s,"current"===o,i.resumeToken)),t.isPrimaryClient&&n&&ea(t.remoteStore,i),a}async function Ya(t,e,n){const r=pe(t),i=r.uu.get(e),s=r.cu.get(i.targetId);if(s.length>1)return r.cu.set(i.targetId,s.filter((t=>!Kr(t,e)))),void r.uu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||await So(r.localStore,i.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(i.targetId),n&&na(r.remoteStore,i.targetId),oc(r,i.targetId)})).catch(We)):(oc(r,i.targetId),await So(r.localStore,i.targetId,!0))}async function Ja(t,e){const n=pe(t),r=n.uu.get(e),i=n.cu.get(r.targetId);n.isPrimaryClient&&1===i.length&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),na(n.remoteStore,r.targetId))}async function Za(t,e){const n=pe(t);try{const t=await function(t,e){const n=pe(t),r=e.snapshotVersion;let i=n.xs;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(t=>{const s=n.Bs.newChangeBuffer({trackRemovals:!0});i=n.xs;const o=[];e.targetChanges.forEach(((s,a)=>{const c=i.get(a);if(!c)return;o.push(n.Ti.removeMatchingKeys(t,s.removedDocuments,a).next((()=>n.Ti.addMatchingKeys(t,s.addedDocuments,a))));let u=c.withSequenceNumber(t.currentSequenceNumber);null!==e.targetMismatches.get(a)?u=u.withResumeToken(Sn.EMPTY_BYTE_STRING,Fe.min()).withLastLimboFreeSnapshotVersion(Fe.min()):s.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(s.resumeToken,r)),i=i.insert(a,u),function(t,e,n){return 0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(c,u,s)&&o.push(n.Ti.updateTargetData(t,u))}));let a=ei(),c=hi();if(e.documentUpdates.forEach((r=>{e.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(t,r))})),o.push(function(t,e,n){let r=hi(),i=hi();return n.forEach((t=>r=r.add(t))),e.getEntries(t,r).next((t=>{let r=ei();return n.forEach(((n,s)=>{const o=t.get(n);s.isFoundDocument()!==o.isFoundDocument()&&(i=i.add(n)),s.isNoDocument()&&s.version.isEqual(Fe.min())?(e.removeEntry(n,s.readTime),r=r.insert(n,s)):!o.isValidDocument()||s.version.compareTo(o.version)>0||0===s.version.compareTo(o.version)&&o.hasPendingWrites?(e.addEntry(s),r=r.insert(n,s)):ce(bo,"Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",s.version)})),{qs:r,Qs:i}}))}(t,s,e.documentUpdates).next((t=>{a=t.qs,c=t.Qs}))),!r.isEqual(Fe.min())){const e=n.Ti.getLastRemoteSnapshotVersion(t).next((e=>n.Ti.setTargetsMetadata(t,t.currentSequenceNumber,r)));o.push(e)}return Xe.waitFor(o).next((()=>s.apply(t))).next((()=>n.localDocuments.getLocalViewOfDocuments(t,a,c))).next((()=>a))})).then((t=>(n.xs=i,t)))}(n.localStore,e);e.targetChanges.forEach(((t,e)=>{const r=n.Pu.get(e);r&&(ge(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1,22616),t.addedDocuments.size>0?r._u=!0:t.modifiedDocuments.size>0?ge(r._u,14607):t.removedDocuments.size>0&&(ge(r._u,42227),r._u=!1))})),await lc(n,t,e)}catch(t){await We(t)}}function tc(t,e,n){const r=pe(t);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const t=[];r.uu.forEach(((n,r)=>{const i=r.view.Da(e);i.snapshot&&t.push(i.snapshot)})),function(t,e){const n=pe(t);n.onlineState=e;let r=!1;n.queries.forEach(((t,n)=>{for(const t of n.ya)t.Da(e)&&(r=!0)})),r&&Va(n)}(r.eventManager,e),t.length&&r.au.j_(t),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function ec(t,e,n){const r=pe(t);r.sharedClientState.updateQueryState(e,"rejected",n);const i=r.Pu.get(e),s=i&&i.key;if(s){let t=new wn(ze.comparator);t=t.insert(s,dr.newNoDocument(s,Fe.min()));const n=hi().add(s),i=new es(Fe.min(),new Map,new wn(ke),t,n);await Za(r,i),r.hu=r.hu.remove(s),r.Pu.delete(e),hc(r)}else await So(r.localStore,e,!1).then((()=>oc(r,e,n))).catch(We)}async function nc(t,e){const n=pe(t),r=e.batch.batchId;try{const t=await function(t,e){const n=pe(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(t=>{const r=e.batch.keys(),i=n.Bs.newChangeBuffer({trackRemovals:!0});return function(t,e,n,r){const i=n.batch,s=i.keys();let o=Xe.resolve();return s.forEach((t=>{o=o.next((()=>r.getEntry(e,t))).next((e=>{const s=n.docVersions.get(t);ge(null!==s,48541),e.version.compareTo(s)<0&&(i.applyToRemoteDocument(e,n),e.isValidDocument()&&(e.setReadTime(n.commitVersion),r.addEntry(e)))}))})),o.next((()=>t.mutationQueue.removeMutationBatch(e,i)))}(n,t,e,i).next((()=>i.apply(t))).next((()=>n.mutationQueue.performConsistencyCheck(t))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(t,r,e.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,function(t){let e=hi();for(let n=0;n<t.mutationResults.length;++n)t.mutationResults[n].transformResults.length>0&&(e=e.add(t.batch.mutations[n].key));return e}(e)))).next((()=>n.localDocuments.getDocuments(t,r)))}))}(n.localStore,e);sc(n,r,null),ic(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await lc(n,t)}catch(t){await We(t)}}async function rc(t,e,n){const r=pe(t);try{const t=await function(t,e){const n=pe(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",(t=>{let r;return n.mutationQueue.lookupMutationBatch(t,e).next((e=>(ge(null!==e,37113),r=e.keys(),n.mutationQueue.removeMutationBatch(t,e)))).next((()=>n.mutationQueue.performConsistencyCheck(t))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(t,r,e))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,r))).next((()=>n.localDocuments.getDocuments(t,r)))}))}(r.localStore,e);sc(r,e,n),ic(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),await lc(r,t)}catch(n){await We(n)}}function ic(t,e){(t.Eu.get(e)||[]).forEach((t=>{t.resolve()})),t.Eu.delete(e)}function sc(t,e,n){const r=pe(t);let i=r.Iu[r.currentUser.toKey()];if(i){const t=i.get(e);t&&(n?t.reject(n):t.resolve(),i=i.remove(e)),r.Iu[r.currentUser.toKey()]=i}}function oc(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.cu.get(e))t.uu.delete(r),n&&t.au.Vu(r,n);t.cu.delete(e),t.isPrimaryClient&&t.Tu.Hr(e).forEach((e=>{t.Tu.containsKey(e)||ac(t,e)}))}function ac(t,e){t.lu.delete(e.path.canonicalString());const n=t.hu.get(e);null!==n&&(na(t.remoteStore,n),t.hu=t.hu.remove(e),t.Pu.delete(n),hc(t))}function cc(t,e,n){for(const r of n)r instanceof ja?(t.Tu.addReference(r.key,e),uc(t,r)):r instanceof qa?(ce(za,"Document no longer in limbo: "+r.key),t.Tu.removeReference(r.key,e),t.Tu.containsKey(r.key)||ac(t,r.key)):de(19791,{mu:r})}function uc(t,e){const n=e.key,r=n.path.canonicalString();t.hu.get(n)||t.lu.has(r)||(ce(za,"New document in limbo: "+n),t.lu.add(r),hc(t))}function hc(t){for(;t.lu.size>0&&t.hu.size<t.maxConcurrentLimboResolutions;){const e=t.lu.values().next().value;t.lu.delete(e);const n=new ze(je.fromString(e)),r=t.du.next();t.Pu.set(r,new Ha(n)),t.hu=t.hu.insert(n,r),ea(t.remoteStore,new Bs(zr(Br(n.path)),r,"TargetPurposeLimboResolution",Je.le))}}async function lc(t,e,n){const r=pe(t),i=[],s=[],o=[];r.uu.isEmpty()||(r.uu.forEach(((t,a)=>{o.push(r.Ru(a,e,n).then((t=>{var e;if((t||n)&&r.isPrimaryClient){const i=t?!t.fromCache:null===(e=null==n?void 0:n.targetChanges.get(a.targetId))||void 0===e?void 0:e.current;r.sharedClientState.updateQueryState(a.targetId,i?"current":"not-current")}if(t){i.push(t);const e=vo.Rs(a.targetId,t);s.push(e)}})))})),await Promise.all(o),r.au.j_(i),await async function(t,e){const n=pe(t);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(t=>Xe.forEach(e,(e=>Xe.forEach(e.ds,(r=>n.persistence.referenceDelegate.addReference(t,e.targetId,r))).next((()=>Xe.forEach(e.As,(r=>n.persistence.referenceDelegate.removeReference(t,e.targetId,r)))))))))}catch(t){if(!Ye(t))throw t;ce(bo,"Failed to update sequence numbers: "+t)}for(const t of e){const e=t.targetId;if(!t.fromCache){const t=n.xs.get(e),r=t.snapshotVersion,i=t.withLastLimboFreeSnapshotVersion(r);n.xs=n.xs.insert(e,i)}}}(r.localStore,s))}async function dc(t,e){const n=pe(t);if(!n.currentUser.isEqual(e)){ce(za,"User change. New user:",e.toKey());const t=await To(n.localStore,e);n.currentUser=e,function(t){t.Eu.forEach((t=>{t.forEach((t=>{t.reject(new ye(me.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),t.Eu.clear()}(n),n.sharedClientState.handleUserChange(e,t.removedBatchIds,t.addedBatchIds),await lc(n,t.ks)}}function fc(t,e){const n=pe(t),r=n.Pu.get(e);if(r&&r._u)return hi().add(r.key);{let t=hi();const r=n.cu.get(e);if(!r)return t;for(const e of r){const r=n.uu.get(e);t=t.unionWith(r.view.Ya)}return t}}function gc(t){const e=pe(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=Za.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=fc.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=ec.bind(null,e),e.au.j_=Ma.bind(null,e.eventManager),e.au.Vu=Pa.bind(null,e.eventManager),e}function pc(t){const e=pe(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=nc.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=rc.bind(null,e),e}class mc{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(t){this.serializer=qo(t.databaseInfo.databaseId),this.sharedClientState=this.pu(t),this.persistence=this.yu(t),await this.persistence.start(),this.localStore=this.wu(t),this.gcScheduler=this.Su(t,this.localStore),this.indexBackfillerScheduler=this.bu(t,this.localStore)}Su(t,e){return null}bu(t,e){return null}wu(t){return function(t,e,n,r){return new _o(t,e,n,r)}(this.persistence,new Eo,t.initialUser,this.serializer)}yu(t){return new go(mo.fi,this.serializer)}pu(t){return new No}async terminate(){var t,e;null===(t=this.gcScheduler)||void 0===t||t.stop(),null===(e=this.indexBackfillerScheduler)||void 0===e||e.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}mc.provider={build:()=>new mc};class yc extends mc{constructor(t){super(),this.cacheSizeBytes=t}Su(t,e){ge(this.persistence.referenceDelegate instanceof yo,46915);const n=this.persistence.referenceDelegate.garbageCollector;return new Zs(n,t.asyncQueue,e)}yu(t){const e=void 0!==this.cacheSizeBytes?Qs.withCacheSize(this.cacheSizeBytes):Qs.DEFAULT;return new go((t=>yo.fi(t,e)),this.serializer)}}class vc{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=t=>tc(this.syncEngine,t,1),this.remoteStore.remoteSyncer.handleCredentialChange=dc.bind(null,this.syncEngine),await async function(t,e){const n=pe(t);e?(n.Ta.delete(2),await Zo(n)):e||(n.Ta.add(2),await ta(n),n.da.set("Unknown"))}(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return new La}createDatastore(t){const e=qo(t.databaseInfo.databaseId),n=function(t){return new Bo(t)}(t.databaseInfo);return function(t,e,n,r){return new Wo(t,e,n,r)}(t.authCredentials,t.appCheckCredentials,n,e)}createRemoteStore(t){return function(t,e,n,r,i){return new Jo(t,e,n,r,i)}(this.localStore,this.datastore,t.asyncQueue,(t=>tc(this.syncEngine,t,0)),Ro.C()?new Ro:new ko)}createSyncEngine(t,e){return function(t,e,n,r,i,s,o){const a=new Ka(t,e,n,r,i,s);return o&&(a.Au=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}async terminate(){var t,e;await async function(t){const e=pe(t);ce(Yo,"RemoteStore shutting down."),e.Ta.add(5),await ta(e),e.Ea.shutdown(),e.da.set("Unknown")}(this.remoteStore),null===(t=this.datastore)||void 0===t||t.terminate(),null===(e=this.eventManager)||void 0===e||e.terminate()}}vc.provider={build:()=>new vc};class wc{constructor(t){this.observer=t,this.muted=!1}next(t){this.muted||this.observer.next&&this.vu(this.observer.next,t)}error(t){this.muted||(this.observer.error?this.vu(this.observer.error,t):ue("Uncaught Error in snapshot listener:",t.toString()))}Cu(){this.muted=!0}vu(t,e){setTimeout((()=>{this.muted||t(e)}),0)}}const Ec="FirestoreClient";class bc{constructor(t,e,n,r,i){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=n,this.databaseInfo=r,this.user=ie.UNAUTHENTICATED,this.clientId=Ne.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(n,(async t=>{ce(Ec,"Received user=",t.uid),await this.authCredentialListener(t),this.user=t})),this.appCheckCredentials.start(n,(t=>(ce(Ec,"Received new app check token=",t),this.appCheckCredentialListener(t,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}terminate(){this.asyncQueue.enterRestrictedMode();const t=new ve;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){const n=Da(e,"Failed to shutdown persistence");t.reject(n)}})),t.promise}}async function _c(t,e){t.asyncQueue.verifyOperationInProgress(),ce(Ec,"Initializing OfflineComponentProvider");const n=t.configuration;await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener((async t=>{r.isEqual(t)||(await To(e.localStore,t),r=t)})),e.persistence.setDatabaseDeletedListener((()=>t.terminate())),t._offlineComponents=e}async function Tc(t,e){t.asyncQueue.verifyOperationInProgress();const n=await async function(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){ce(Ec,"Using user provided OfflineComponentProvider");try{await _c(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!function(t){return"FirebaseError"===t.name?t.code===me.FAILED_PRECONDITION||t.code===me.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}(n))throw n;he("Error using user provided cache. Falling back to memory cache: "+n),await _c(t,new mc)}}else ce(Ec,"Using default OfflineComponentProvider"),await _c(t,new yc(void 0));return t._offlineComponents}(t);ce(Ec,"Initializing OnlineComponentProvider"),await e.initialize(n,t.configuration),t.setCredentialChangeListener((t=>Ca(e.remoteStore,t))),t.setAppCheckTokenChangeListener(((t,n)=>Ca(e.remoteStore,n))),t._onlineComponents=e}async function Cc(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(ce(Ec,"Using user provided OnlineComponentProvider"),await Tc(t,t._uninitializedComponentsProvider._online)):(ce(Ec,"Using default OnlineComponentProvider"),await Tc(t,new vc))),t._onlineComponents}async function Ic(t){const e=await Cc(t),n=e.eventManager;return n.onListen=Qa.bind(null,e.syncEngine),n.onUnlisten=Ya.bind(null,e.syncEngine),n.onFirstRemoteStoreListen=Wa.bind(null,e.syncEngine),n.onLastRemoteStoreUnlisten=Ja.bind(null,e.syncEngine),n}function Sc(t,e,n={}){const r=new ve;return t.asyncQueue.enqueueAndForget((async()=>function(t,e,n,r,i){const s=new wc({next:n=>{s.Cu(),e.enqueueAndForget((()=>async function(t,e){const n=pe(t),r=e.query;let i=3;const s=n.queries.get(r);if(s){const t=s.ya.indexOf(e);t>=0&&(s.ya.splice(t,1),0===s.ya.length?i=e.Sa()?0:1:!s.wa()&&e.Sa()&&(i=2))}switch(i){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}(t,o))),n.fromCache&&"server"===r.source?i.reject(new ye(me.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:t=>i.reject(t)}),o=new Ba(n,s,{includeMetadataChanges:!0,La:!0});return async function(t,e){const n=pe(t);let r=3;const i=e.query;let s=n.queries.get(i);s?!s.wa()&&e.Sa()&&(r=2):(s=new Ra,r=e.Sa()?0:1);try{switch(r){case 0:s.pa=await n.onListen(i,!0);break;case 1:s.pa=await n.onListen(i,!1);break;case 2:await n.onFirstRemoteStoreListen(i)}}catch(t){const n=Da(t,`Initialization of query '${Wr(e.query)}' failed`);return void e.onError(n)}n.queries.set(i,s),s.ya.push(e),e.Da(n.onlineState),s.pa&&e.va(s.pa)&&Va(n)}(t,o)}(await Ic(t),t.asyncQueue,e,n,r))),r.promise}function Ac(t){const e={};return void 0!==t.timeoutSeconds&&(e.timeoutSeconds=t.timeoutSeconds),e}const Dc=new Map;function Nc(t,e,n){if(!n)throw new ye(me.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function kc(t){if(!ze.isDocumentKey(t))throw new ye(me.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function xc(t){if(ze.isDocumentKey(t))throw new ye(me.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function Rc(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";{const e=function(t){return t.constructor?t.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return"function"==typeof t?"a function":de(12329,{type:typeof t})}function Lc(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new ye(me.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Rc(t);throw new ye(me.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}const Oc="firestore.googleapis.com",Mc=!0;class Pc{constructor(t){var e,n;if(void 0===t.host){if(void 0!==t.ssl)throw new ye(me.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Oc,this.ssl=Mc}else this.host=t.host,this.ssl=null!==(e=t.ssl)&&void 0!==e?e:Mc;if(this.isUsingEmulator=void 0!==t.emulatorOptions,this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,void 0===t.cacheSizeBytes)this.cacheSizeBytes=Ks;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new ye(me.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}(function(t,e,n,r){if(!0===e&&!0===r)throw new ye(me.INVALID_ARGUMENT,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")})(0,t.experimentalForceLongPolling,0,t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===t.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Ac(null!==(n=t.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(t){if(void 0!==t.timeoutSeconds){if(isNaN(t.timeoutSeconds))throw new ye(me.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (must not be NaN)`);if(t.timeoutSeconds<5)throw new ye(me.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (minimum allowed value is 5)`);if(t.timeoutSeconds>30)throw new ye(me.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(t,e){return t.timeoutSeconds===e.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class Vc{constructor(t,e,n,r){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Pc({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new ye(me.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(t){if(this._settingsFrozen)throw new ye(me.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Pc(t),this._emulatorOptions=t.emulatorOptions||{},void 0!==t.credentials&&(this._authCredentials=function(t){if(!t)return new Ee;switch(t.type){case"firstParty":return new Ce(t.sessionIndex||"0",t.iamToken||null,t.authTokenFactory||null);case"provider":return t.client;default:throw new ye(me.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,l("Firestore",this._settings.isUsingEmulator),this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const e=Dc.get(t);e&&(ce("ComponentProvider","Removing Datastore"),Dc.delete(t),e.terminate())}(this),Promise.resolve()}}class Fc{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new Fc(this.firestore,t,this._query)}}class Uc{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Bc(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new Uc(this.firestore,t,this._key)}}class Bc extends Fc{constructor(t,e,n){super(t,e,Br(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new Uc(this.firestore,null,new ze(t))}withConverter(t){return new Bc(this.firestore,t,this._path)}}const jc="AsyncQueue";class qc{constructor(t=Promise.resolve()){this.zu=[],this.ju=!1,this.Hu=[],this.Ju=null,this.Yu=!1,this.Zu=!1,this.Xu=[],this.C_=new $o(this,"async_queue_retry"),this.ec=()=>{const t=jo();t&&ce(jc,"Visibility state changed to "+t.visibilityState),this.C_.p_()},this.tc=t;const e=jo();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.ec)}get isShuttingDown(){return this.ju}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.nc(),this.rc(t)}enterRestrictedMode(t){if(!this.ju){this.ju=!0,this.Zu=t||!1;const e=jo();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this.ec)}}enqueue(t){if(this.nc(),this.ju)return new Promise((()=>{}));const e=new ve;return this.rc((()=>this.ju&&this.Zu?Promise.resolve():(t().then(e.resolve,e.reject),e.promise))).then((()=>e.promise))}enqueueRetryable(t){this.enqueueAndForget((()=>(this.zu.push(t),this.sc())))}async sc(){if(0!==this.zu.length){try{await this.zu[0](),this.zu.shift(),this.C_.reset()}catch(t){if(!Ye(t))throw t;ce(jc,"Operation failed with retryable error: "+t)}this.zu.length>0&&this.C_.f_((()=>this.sc()))}}rc(t){const e=this.tc.then((()=>(this.Yu=!0,t().catch((t=>{throw this.Ju=t,this.Yu=!1,ue("INTERNAL UNHANDLED ERROR: ",$c(t)),t})).then((t=>(this.Yu=!1,t))))));return this.tc=e,e}enqueueAfterDelay(t,e,n){this.nc(),this.Xu.indexOf(t)>-1&&(e=0);const r=Aa.createAndSchedule(this,t,e,n,(t=>this.oc(t)));return this.Hu.push(r),r}nc(){this.Ju&&de(47125,{_c:$c(this.Ju)})}verifyOperationInProgress(){}async ac(){let t;do{t=this.tc,await t}while(t!==this.tc)}uc(t){for(const e of this.Hu)if(e.timerId===t)return!0;return!1}cc(t){return this.ac().then((()=>{this.Hu.sort(((t,e)=>t.targetTimeMs-e.targetTimeMs));for(const e of this.Hu)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.ac()}))}lc(t){this.Xu.push(t)}oc(t){const e=this.Hu.indexOf(t);this.Hu.splice(e,1)}}function $c(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}class zc extends Vc{constructor(t,e,n,r){super(t,e,n,r),this.type="firestore",this._queue=new qc,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const t=this._firestoreClient.terminate();this._queue=new qc(t),this._firestoreClient=void 0,await t}}}function Gc(t){if(t._terminated)throw new ye(me.FAILED_PRECONDITION,"The client has already been terminated.");return t._firestoreClient||function(t){var e,n,r;const i=t._freezeSettings(),s=function(t,e,n,r){return new Fn(t,e,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,Ac(r.experimentalLongPollingOptions),r.useFetchStreams,r.isUsingEmulator)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,i);t._componentsProvider||(null===(n=i.localCache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(r=i.localCache)||void 0===r?void 0:r._onlineComponentProvider)&&(t._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),t._firestoreClient=new bc(t._authCredentials,t._appCheckCredentials,t._queue,s,t._componentsProvider&&function(t){const e=null==t?void 0:t._online.build();return{_offline:null==t?void 0:t._offline.build(e),_online:e}}(t._componentsProvider))}(t),t._firestoreClient}class Hc{constructor(t){this._byteString=t}static fromBase64String(t){try{return new Hc(Sn.fromBase64String(t))}catch(t){throw new ye(me.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(t){return new Hc(Sn.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}class Kc{constructor(...t){for(let e=0;e<t.length;++e)if(0===t[e].length)throw new ye(me.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new $e(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}class Qc{constructor(t){this._methodName=t}}class Wc{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new ye(me.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new ye(me.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return ke(this._lat,t._lat)||ke(this._long,t._long)}}class Xc{constructor(t){this._values=(t||[]).map((t=>t))}toArray(){return this._values.map((t=>t))}isEqual(t){return function(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}(this._values,t._values)}}const Yc=/^__.*__$/;class Jc{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return null!==this.fieldMask?new Vi(t,this.data,this.fieldMask,e,this.fieldTransforms):new Pi(t,this.data,e,this.fieldTransforms)}}function Zc(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw de(40011,{hc:t})}}class tu{constructor(t,e,n,r,i,s){this.settings=t,this.databaseId=e,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Pc(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get hc(){return this.settings.hc}Tc(t){return new tu(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Ic(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Tc({path:n,Ec:!1});return r.dc(t),r}Ac(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Tc({path:n,Ec:!1});return r.Pc(),r}Rc(t){return this.Tc({path:void 0,Ec:!0})}Vc(t){return lu(t,this.settings.methodName,this.settings.mc||!1,this.path,this.settings.fc)}contains(t){return void 0!==this.fieldMask.find((e=>t.isPrefixOf(e)))||void 0!==this.fieldTransforms.find((e=>t.isPrefixOf(e.field)))}Pc(){if(this.path)for(let t=0;t<this.path.length;t++)this.dc(this.path.get(t))}dc(t){if(0===t.length)throw this.Vc("Document fields must not be empty");if(Zc(this.hc)&&Yc.test(t))throw this.Vc('Document fields cannot begin and end with "__"')}}class eu{constructor(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=n||qo(t)}gc(t,e,n,r=!1){return new tu({hc:t,methodName:e,fc:n,path:$e.emptyPath(),Ec:!1,mc:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function nu(t){const e=t._freezeSettings(),n=qo(t._databaseId);return new eu(t._databaseId,!!e.ignoreUndefinedProperties,n)}function ru(t,e,n,r,i,s={}){const o=t.gc(s.merge||s.mergeFields?2:0,e,n,i);au("Data must be an object, but it was:",o,r);const a=su(r,o);let c,u;if(s.merge)c=new Cn(o.fieldMask),u=o.fieldTransforms;else if(s.mergeFields){const t=[];for(const r of s.mergeFields){const i=cu(e,r,n);if(!o.contains(i))throw new ye(me.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);du(t,i)||t.push(i)}c=new Cn(t),u=o.fieldTransforms.filter((t=>c.covers(t.field)))}else c=null,u=o.fieldTransforms;return new Jc(new hr(a),c,u)}function iu(t,e){if(ou(t=v(t)))return au("Unsupported field value:",e,t),su(t,e);if(t instanceof Qc)return function(t,e){if(!Zc(e.hc))throw e.Vc(`${t._methodName}() can only be used with update() and set()`);if(!e.path)throw e.Vc(`${t._methodName}() is not currently supported inside arrays`);const n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.Ec&&4!==e.hc)throw e.Vc("Nested arrays are not supported");return function(t,e){const n=[];let r=0;for(const i of t){let t=iu(i,e.Rc(r));null==t&&(t={nullValue:"NULL_VALUE"}),n.push(t),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=v(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return gi(e.serializer,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const n=Ve.fromDate(t);return{timestampValue:ps(e.serializer,n)}}if(t instanceof Ve){const n=new Ve(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:ps(e.serializer,n)}}if(t instanceof Wc)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Hc)return{bytesValue:ms(e.serializer,t._byteString)};if(t instanceof Uc){const n=e.databaseId,r=t.firestore._databaseId;if(!r.isEqual(n))throw e.Vc(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:ws(t.firestore._databaseId||e.databaseId,t._key.path)}}if(t instanceof Xc)return function(t,e){return{mapValue:{fields:{[jn]:{stringValue:zn},[Gn]:{arrayValue:{values:t.toArray().map((t=>{if("number"!=typeof t)throw e.Vc("VectorValues must only contain numeric values.");return di(e.serializer,t)}))}}}}}}(t,e);throw e.Vc(`Unsupported field value: ${Rc(t)}`)}(t,e)}function su(t,e){const n={};return vn(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):yn(t,((t,r)=>{const i=iu(r,e.Ic(t));null!=i&&(n[t]=i)})),{mapValue:{fields:n}}}function ou(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Ve||t instanceof Wc||t instanceof Hc||t instanceof Uc||t instanceof Qc||t instanceof Xc)}function au(t,e,n){if(!ou(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){const r=Rc(n);throw"an object"===r?e.Vc(t+" a custom object"):e.Vc(t+" "+r)}}function cu(t,e,n){if((e=v(e))instanceof Kc)return e._internalPath;if("string"==typeof e)return hu(t,e);throw lu("Field path arguments must be of type string or ",t,!1,void 0,n)}const uu=new RegExp("[~\\*/\\[\\]]");function hu(t,e,n){if(e.search(uu)>=0)throw lu(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new Kc(...e.split("."))._internalPath}catch(r){throw lu(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function lu(t,e,n,r,i){const s=r&&!r.isEmpty(),o=void 0!==i;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${r}`),o&&(c+=` in document ${i}`),c+=")"),new ye(me.INVALID_ARGUMENT,a+t+c)}function du(t,e){return t.some((t=>t.isEqual(e)))}class fu{constructor(t,e,n,r,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Uc(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const t=new gu(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const e=this._document.data.field(pu("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}}}class gu extends fu{data(){return super.data()}}function pu(t,e){return"string"==typeof e?hu(t,e):e instanceof Kc?e._internalPath:e._delegate._internalPath}class mu{}class yu extends mu{}class vu extends yu{constructor(t,e,n){super(),this._field=t,this._op=e,this._value=n,this.type="where"}static _create(t,e,n){return new vu(t,e,n)}_apply(t){const e=this._parse(t);return _u(t._query,e),new Fc(t.firestore,t.converter,Gr(t._query,e))}_parse(t){const e=nu(t.firestore),n=function(t,e,n,r,i,s,o){let a;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new ye(me.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){bu(o,s);const e=[];for(const n of o)e.push(Eu(r,t,n));a={arrayValue:{values:e}}}else a=Eu(r,t,o)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||bu(o,s),a=function(t,e,n,r=!1){return iu(n,t.gc(r?4:3,e))}(n,"where",o,"in"===s||"not-in"===s);return wr.create(i,s,a)}(t._query,0,e,t.firestore._databaseId,this._field,this._op,this._value);return n}}class wu extends mu{constructor(t,e){super(),this.type=t,this._queryConstraints=e}static _create(t,e){return new wu(t,e)}_parse(t){const e=this._queryConstraints.map((e=>e._parse(t))).filter((t=>t.getFilters().length>0));return 1===e.length?e[0]:Er.create(e,this._getOperator())}_apply(t){const e=this._parse(t);return 0===e.getFilters().length?t:(function(t,e){let n=t;const r=e.getFlattenedFilters();for(const t of r)_u(n,t),n=Gr(n,t)}(t._query,e),new Fc(t.firestore,t.converter,Gr(t._query,e)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}function Eu(t,e,n){if("string"==typeof(n=v(n))){if(""===n)throw new ye(me.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!qr(e)&&-1!==n.indexOf("/"))throw new ye(me.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=e.path.child(je.fromString(n));if(!ze.isDocumentKey(r))throw new ye(me.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return er(t,new ze(r))}if(n instanceof Uc)return er(t,n._key);throw new ye(me.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Rc(n)}.`)}function bu(t,e){if(!Array.isArray(t)||0===t.length)throw new ye(me.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function _u(t,e){const n=function(t,e){for(const n of t)for(const t of n.getFlattenedFilters())if(e.indexOf(t.op)>=0)return t.op;return null}(t.filters,function(t){switch(t){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==n)throw n===e.op?new ye(me.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new ye(me.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}class Tu{convertValue(t,e="none"){switch(Hn(t)){case 0:return null;case 1:return t.booleanValue;case 2:return Nn(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(kn(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 11:return this.convertObject(t.mapValue,e);case 10:return this.convertVectorValue(t.mapValue);default:throw de(62114,{value:t})}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){const n={};return yn(t,((t,r)=>{n[t]=this.convertValue(r,e)})),n}convertVectorValue(t){var e,n,r;const i=null===(r=null===(n=null===(e=t.fields)||void 0===e?void 0:e[Gn].arrayValue)||void 0===n?void 0:n.values)||void 0===r?void 0:r.map((t=>Nn(t.doubleValue)));return new Xc(i)}convertGeoPoint(t){return new Wc(Nn(t.latitude),Nn(t.longitude))}convertArray(t,e){return(t.values||[]).map((t=>this.convertValue(t,e)))}convertServerTimestamp(t,e){switch(e){case"previous":const n=Pn(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(Vn(t));default:return null}}convertTimestamp(t){const e=Dn(t);return new Ve(e.seconds,e.nanos)}convertDocumentKey(t,e){const n=je.fromString(t);ge(Us(n),9688,{name:t});const r=new Bn(n.get(1),n.get(3)),i=new ze(n.popFirst(5));return r.isEqual(e)||ue(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),i}}class Cu{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class Iu extends fu{constructor(t,e,n,r,i,s){super(t,e,n,r,s),this._firestore=t,this._firestoreImpl=t,this.metadata=i}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const e=new Su(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){const n=this._document.data.field(pu("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}}class Su extends Iu{data(t={}){return super.data(t)}}class Au{constructor(t,e,n,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new Cu(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const t=[];return this.forEach((e=>t.push(e))),t}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(t,e){this._snapshot.docs.forEach((n=>{t.call(e,new Su(this._firestore,this._userDataWriter,n.key,n,new Cu(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new ye(me.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){let e=0;return t._snapshot.docChanges.map((n=>{const r=new Su(t._firestore,t._userDataWriter,n.doc.key,n.doc,new Cu(t._snapshot.mutatedKeys.has(n.doc.key),t._snapshot.fromCache),t.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:e++}}))}{let n=t._snapshot.oldDocs;return t._snapshot.docChanges.filter((t=>e||3!==t.type)).map((e=>{const r=new Su(t._firestore,t._userDataWriter,e.doc.key,e.doc,new Cu(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter);let i=-1,s=-1;return 0!==e.type&&(i=n.indexOf(e.doc.key),n=n.delete(e.doc.key)),1!==e.type&&(n=n.add(e.doc),s=n.indexOf(e.doc.key)),{type:Du(e.type),doc:r,oldIndex:i,newIndex:s}}))}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}}function Du(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return de(61501,{type:t})}}class Nu extends Tu{constructor(t){super(),this.firestore=t}convertBytes(t){return new Hc(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new Uc(this.firestore,null,e)}}function ku(t,e){const n=Lc(t.firestore,zc),r=function(t,e,...n){if(t=v(t),1===arguments.length&&(e=Ne.newId()),Nc("doc","path",e),t instanceof Vc){const r=je.fromString(e,...n);return kc(r),new Uc(t,null,new ze(r))}{if(!(t instanceof Uc||t instanceof Bc))throw new ye(me.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(je.fromString(e,...n));return kc(r),new Uc(t.firestore,t instanceof Bc?t.converter:null,new ze(r))}}(t),i=function(t,e,n){let r;return r=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,r}(t.converter,e);return function(t,e){return function(t,e){const n=new ve;return t.asyncQueue.enqueueAndForget((async()=>async function(t,e,n){const r=pc(t);try{const t=await function(t,e){const n=pe(t),r=Ve.now(),i=e.reduce(((t,e)=>t.add(e.key)),hi());let s,o;return n.persistence.runTransaction("Locally write mutations","readwrite",(t=>{let a=ei(),c=hi();return n.Bs.getEntries(t,i).next((t=>{a=t,a.forEach(((t,e)=>{e.isValidDocument()||(c=c.add(t))}))})).next((()=>n.localDocuments.getOverlayedDocuments(t,a))).next((i=>{s=i;const o=[];for(const t of e){const e=Oi(t,s.get(t.key).overlayedDocument);null!=e&&o.push(new Vi(t.key,e,lr(e.value.mapValue),Di.exists(!0)))}return n.mutationQueue.addMutationBatch(t,r,o,e)})).next((e=>{o=e;const r=e.applyToLocalDocumentSet(s,c);return n.documentOverlayCache.saveOverlays(t,e.batchId,r)}))})).then((()=>({batchId:o.batchId,changes:ii(s)})))}(r.localStore,e);r.sharedClientState.addPendingMutation(t.batchId),function(t,e,n){let r=t.Iu[t.currentUser.toKey()];r||(r=new wn(ke)),r=r.insert(e,n),t.Iu[t.currentUser.toKey()]=r}(r,t.batchId,n),await lc(r,t.changes),await pa(r.remoteStore)}catch(t){const e=Da(t,"Failed to persist write");n.reject(e)}}(await function(t){return Cc(t).then((t=>t.syncEngine))}(t),e,n))),n.promise}(Gc(t),e)}(n,[ru(nu(t.firestore),"addDoc",r._key,i,null!==t.converter,{}).toMutation(r._key,Di.exists(!1))]).then((()=>r))}new WeakMap,function(t,e=!0){se="11.8.0",Dt(new w("firestore",((t,{instanceIdentifier:n,options:r})=>{const i=t.getProvider("app").getImmediate(),s=new zc(new _e(t.getProvider("auth-internal")),new Se(i,t.getProvider("app-check-internal")),function(t,e){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new ye(me.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Bn(t.options.projectId,e)}(i,n),i);return r=Object.assign({useFetchStreams:e},r),s._setSettings(r),s}),"PUBLIC").setMultipleInstances(!0)),Rt(ne,re,t),Rt(ne,re,"esm2017")}();const xu=function(t,e,...n){if(t=v(t),Nc("collection","path",e),t instanceof Vc){const r=je.fromString(e,...n);return xc(r),new Bc(t,null,r)}{if(!(t instanceof Uc||t instanceof Bc))throw new ye(me.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(je.fromString(e,...n));return xc(r),new Bc(t.firestore,null,r)}}(function(t){const e="object"==typeof t?t:function(t=_t){const e=Ct.get(t);if(!e&&t===_t&&o())return xt();if(!e)throw Nt.create("no-app",{appName:t});return e}(),n="string"==typeof t?t:Un,r=function(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}(e,"firestore").getImmediate({identifier:n});if(!r._initialized){const t=(t=>{const e=(t=>{var e,n;return null===(n=null===(e=s())||void 0===e?void 0:e.emulatorHosts)||void 0===n?void 0:n[t]})(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return"["===e[0]?[e.substring(1,n-1),r]:[e.substring(0,n),r]})("firestore");t&&function(t,e,n,r={}){var s;t=Lc(t,Vc);const o=c(e),a=t._getSettings(),u=Object.assign(Object.assign({},a),{emulatorOptions:t._getEmulatorOptions()}),h=`${e}:${n}`;a.host!==Oc&&a.host!==h&&he("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const d=Object.assign(Object.assign({},a),{host:h,ssl:o,emulatorOptions:r});if(!m(d,u)&&(t._setSettings(d),o&&(async function(t){(await fetch(t,{credentials:"include"})).ok}(`https://${h}`),l("Firestore",!0)),r.mockUserToken)){let e,n;if("string"==typeof r.mockUserToken)e=r.mockUserToken,n=ie.MOCK_USER;else{e=function(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=e||"demo-project",r=t.iat||0,s=t.sub||t.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},t);return[i(JSON.stringify({alg:"none",type:"JWT"})),i(JSON.stringify(o)),""].join(".")}(r.mockUserToken,null===(s=t._app)||void 0===s?void 0:s.options.projectId);const o=r.mockUserToken.sub||r.mockUserToken.user_id;if(!o)throw new ye(me.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new ie(o)}t._authCredentials=new be(new we(e,n))}}(r,...t)}return r}(xt({apiKey:"AIzaSyDPcx5w2WAPwrH962M-Bku5n8rcUiBd7jk",authDomain:"r-interview-a414c.firebaseapp.com",projectId:"r-interview-a414c",storageBucket:"r-interview-a414c.firebasestorage.app",messagingSenderId:"884791632168",appId:"1:884791632168:web:1f81168ff7a0e7e80c301d",measurementId:"G-CT17BLY72M"})),"html_content"),Ru=window.location.href,Lu=document.body.innerText,Ou=document.documentElement.outerHTML;console.log("Page URL: ",Ru),console.log("Page Text: ",Lu),console.log("Page HTML: ",Ou),(async()=>{try{const t=function(t,e,...n){let r=[];e instanceof mu&&r.push(e),r=r.concat(n),function(t){const e=t.filter((t=>t instanceof wu)).length,n=t.filter((t=>t instanceof vu)).length;if(e>1||e>0&&n>0)throw new ye(me.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const e of r)t=e._apply(t);return t}(xu,function(t,e,n){const r=pu("where","page");return vu._create(r,"==",n)}(0,0,Ru));if(!(await function(t){t=Lc(t,Fc);const e=Lc(t.firestore,zc),n=Gc(e),r=new Nu(e);return function(t){if("L"===t.limitType&&0===t.explicitOrderBy.length)throw new ye(me.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}(t._query),Sc(n,t._query).then((n=>new Au(e,r,t,n)))}(t)).empty)return void console.log("Page URL already exists in Firestore");{const t=await ku(xu,{page:Ru,content_txt:Lu,content_html:Ou});console.log("Document written with ID: ",t.id)}}catch(t){console.error("Error adding or checking document: ",t)}})()})();
//# sourceMappingURL=webscraper.js.map